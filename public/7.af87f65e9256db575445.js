(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{T8Xv:function(t,e,i){"use strict";i.r(e),i.d(e,"PublicModule",function(){return ct});var c=i("SVse"),n=i("s7LF"),s=i("iInd"),o=i("PSD3"),r=i.n(o),a=i("8Y7J"),b=i("Gyf/"),l=i("OD9V"),d=i("zHaW"),u=i("jMqV"),m=i("Q2Ze"),p=i("e6WT"),h=i("ZTz/"),S=i("UhP/");function f(t,e){1&t&&(a.Sb(0,"h5",29),a.Sb(1,"span",30),a.Bc(2," Cargando... "),a.Rb(),a.Rb())}function g(t,e){if(1&t&&(a.Sb(0,"div"),a.Sb(1,"p",31),a.Bc(2," \xa1Bienvenido! Usted esta por sacar un turno para ser atendido en "),a.Rb(),a.Sb(3,"div",32),a.Sb(4,"p",33),a.Bc(5),a.Rb(),a.Sb(6,"p",34),a.Bc(7),a.Rb(),a.Rb(),a.Rb()),2&t){const t=a.dc(2);a.Ab(5),a.Dc(" ",t.publicService.company.tx_company_name," "),a.Ab(2),a.Fc(" ",t.publicService.company.tx_address_street," ",t.publicService.company.tx_address_number," ",t.publicService.company.cd_city," ")}}function k(t,e){if(1&t&&(a.Sb(0,"mat-option",35),a.Bc(1),a.Rb()),2&t){const t=e.$implicit;a.jc("value",t._id),a.Ab(1),a.Dc(" ",t.tx_section,"")}}function v(t,e){if(1&t){const t=a.Tb();a.Sb(0,"div"),a.Ac(1,f,3,0,"h5",9),a.Ac(2,g,8,4,"div",1),a.Sb(3,"div",10),a.Sb(4,"div",11),a.Sb(5,"div",12),a.Sb(6,"div"),a.Nb(7,"span",13),a.Nb(8,"span",14),a.Rb(),a.Sb(9,"div"),a.Nb(10,"span",15),a.Nb(11,"span",16),a.Rb(),a.Rb(),a.Sb(12,"div",17),a.Sb(13,"p",18),a.Bc(14,"Prioritario"),a.Rb(),a.Sb(15,"mat-slide-toggle",19),a.Zb("ngModelChange",function(e){return a.sc(t),a.dc().blPriority=e}),a.Rb(),a.Rb(),a.Rb(),a.Rb(),a.Sb(16,"form",20,21),a.Sb(18,"mat-form-field",22),a.Sb(19,"mat-label"),a.Bc(20,"Cantidad de Personas"),a.Rb(),a.Nb(21,"input",23),a.Rb(),a.Sb(22,"mat-form-field",22),a.Sb(23,"mat-label"),a.Bc(24,"Sector"),a.Rb(),a.Sb(25,"mat-select",24),a.Ac(26,k,2,2,"mat-option",25),a.Rb(),a.Rb(),a.Sb(27,"div",26),a.Sb(28,"button",27),a.Zb("click",function(){return a.sc(t),a.dc().salir()}),a.Bc(29," Salir "),a.Rb(),a.Sb(30,"button",28),a.Zb("click",function(){return a.sc(t),a.dc().createTicket()}),a.Bc(31," Solicitar "),a.Rb(),a.Rb(),a.Rb(),a.Rb()}if(2&t){const t=a.dc();a.Ab(1),a.jc("ngIf",t.loading),a.Ab(1),a.jc("ngIf",!t.loading),a.Ab(13),a.jc("ngModel",t.blPriority),a.Ab(1),a.jc("formGroup",t.ticketForm),a.Ab(10),a.jc("ngForOf",t.sections)}}let y=(()=>{class t{constructor(t,e,i,c){this.wsService=t,this.publicService=e,this.router=i,this.snack=c,this.loading=!1,this.sections=[],this.blPriority=!1}ngOnInit(){if(this.ticketForm=new n.g({nmPersons:new n.e("",[n.u.required]),idSection:new n.e("",[n.u.required])}),this.publicService.ticket)this.snack.open("Usted ya tiene un turno!",null,{duration:2e3}),this.router.navigate(["/public/myticket"]);else if(this.publicService.company){let t=this.publicService.company._id;this.wsService.emit("enterCompany",t),this.publicService.readSections(t).subscribe(t=>{this.sections=t.sections})}else this.snack.open("Por favor ingrese una empresa primero.",null,{duration:2e3}),this.router.navigate(["/public"])}createTicket(){localStorage.getItem("user")?r.a.fire({icon:"error",title:"Tiene una sesi\xf3n de usuario activa",text:"Usted est\xe1 en una p\xe1gina de acceso al p\xfablico pero tiene una sesi\xf3n de usuario activa. Para obtener un turno debe cerrar la sesi\xf3n de usuario o abrir una pesta\xf1a en modo inc\xf3gnito."}):(this.loading=!0,this.publicService.createTicket(this.wsService.idSocket,this.blPriority,this.ticketForm.value.nmPersons,this.ticketForm.value.idSection).subscribe(t=>{t.ok&&(localStorage.setItem("ticket",JSON.stringify(t.ticket)),this.publicService.ticket=t.ticket,this.loading=!1,this.router.navigate(["/public/myticket"]))}))}salir(){this.publicService.clearPublicSession(),this.router.navigate(["/home"])}}return t.\u0275fac=function(e){return new(e||t)(a.Mb(b.a),a.Mb(l.a),a.Mb(s.b),a.Mb(d.a))},t.\u0275cmp=a.Gb({type:t,selectors:[["app-tickets"]],decls:14,vars:1,consts:[[1,"saturno-card","shadow-box","animated","fadeIn"],[4,"ngIf"],[1,"saturno-footer"],[1,"row"],[1,"col"],["routerLink","/public/search",1,"footer-icon-menu"],[1,"mdi","mdi-magnify","xl"],["routerLink","/public/screen",1,"footer-icon-menu"],[1,"mdi","mdi-monitor-dashboard","xl"],["class","card-title",4,"ngIf"],[1,"container"],[1,"row","rounded","border","border-success","mb-3"],[1,"col","bg-success","text-white","p-2"],[1,"mdi","mdi-human-wheelchair","m-2",2,"font-size","xx-large"],[1,"mdi","mdi-human-pregnant","m-2",2,"font-size","xx-large"],[1,"mdi","mdi-baby-carriage","m-2",2,"font-size","xx-large"],[1,"mdi","mdi-human-cane","m-2",2,"font-size","xx-large"],[1,"col","m-3"],[1,"text-uppercase","mx-2","font-weight-bold"],[3,"ngModel","ngModelChange"],["autocomplete","off","ngNativeValidate","",2,"color","brown",3,"formGroup"],["formDirective","ngForm"],["color","warn","logincss","",1,"w-100"],["matInput","","placeholder","Cantidad de Personas","formControlName","nmPersons","name","nmPersons","type","number","required",""],["formControlName","idSection","name","idSection","required",""],[3,"value",4,"ngFor","ngForOf"],[1,"row","mx-0"],[1,"col","btn","btn-danger","btn-block","btn-lg","rounded-0","text-uppercase","mr-1","my-2",3,"click"],[1,"col","btn","btn-success","btn-block","btn-lg","rounded-0","text-uppercase","ml-1","my-2",3,"click"],[1,"card-title"],["id","lblNuevoTicket"],[1,"lead"],[1,"card","py-4","my-4"],[1,"text-company"],[1,"my-0",2,"color","darkblue","font-size","1rem","font-weight","400"],[3,"value"]],template:function(t,e){1&t&&(a.Sb(0,"div",0),a.Ac(1,v,32,5,"div",1),a.Sb(2,"div",2),a.Sb(3,"div",3),a.Sb(4,"div",4),a.Sb(5,"span",5),a.Nb(6,"span",6),a.Sb(7,"div"),a.Bc(8,"Volver al buscador"),a.Rb(),a.Rb(),a.Rb(),a.Sb(9,"div",4),a.Sb(10,"span",7),a.Nb(11,"span",8),a.Sb(12,"div"),a.Bc(13,"Ver la pantalla"),a.Rb(),a.Rb(),a.Rb(),a.Rb(),a.Rb(),a.Rb()),2&t&&(a.Ab(1),a.jc("ngIf",e.publicService.company))},directives:[c.j,s.c,u.a,n.n,n.q,n.o,n.h,m.c,m.f,p.b,n.d,n.r,n.f,n.t,h.a,c.i,S.k],styles:[""]}),t})();var R=i("zuHl"),_=i("vrAh");function A(t,e){if(1&t&&(a.Sb(0,"mat-option",20),a.Bc(1),a.Rb()),2&t){const t=e.$implicit;a.jc("value",t),a.Ab(1),a.Dc(" ",t.tx_company_name," ")}}function x(t,e){if(1&t){const t=a.Tb();a.Sb(0,"div",4),a.Sb(1,"h2"),a.Bc(2,"Ingrese la empresa"),a.Rb(),a.Nb(3,"span",5),a.Nb(4,"span",6),a.Nb(5,"span",7),a.Nb(6,"span",8),a.Nb(7,"span",9),a.Nb(8,"hr"),a.Sb(9,"p"),a.Bc(10,'La empresa debe estar registrada, por ejemplo "Pizza Taz". Si desea registrar un comercio haga click '),a.Sb(11,"a",10),a.Bc(12,"aqu\xed"),a.Rb(),a.Rb(),a.Sb(13,"div",11),a.Sb(14,"mat-form-field",12),a.Sb(15,"mat-label"),a.Bc(16,"Ingrese la empresa aqu\xed"),a.Rb(),a.Sb(17,"input",13,14),a.Zb("keyup",function(){a.sc(t);const e=a.rc(18);return a.dc().findCompany(e)}),a.Rb(),a.Sb(19,"span",15),a.Zb("click",function(){a.sc(t);const e=a.rc(18);return a.dc().cleanInput(e)}),a.Nb(20,"i",16),a.Rb(),a.Rb(),a.Sb(21,"mat-autocomplete",17,18),a.Zb("optionSelected",function(e){return a.sc(t),a.dc().setCompany(e.option.value)}),a.Ac(23,A,2,2,"mat-option",19),a.Rb(),a.Rb(),a.Rb()}if(2&t){const t=a.rc(22),e=a.dc();a.Ab(17),a.jc("matAutocomplete",t)("value",null==e.companySelected?null:e.companySelected.tx_company_name),a.Ab(6),a.jc("ngForOf",e.companies)}}function w(t,e){if(1&t){const t=a.Tb();a.Sb(0,"div",21),a.Sb(1,"p",22),a.Bc(2," Usted esta por ir hacia la recepci\xf3n de turnos de "),a.Rb(),a.Sb(3,"div",23),a.Sb(4,"p",24),a.Bc(5),a.Rb(),a.Sb(6,"p",25),a.Bc(7),a.Rb(),a.Rb(),a.Sb(8,"button",26),a.Zb("click",function(){return a.sc(t),a.dc().goToCompany()}),a.Bc(9),a.Rb(),a.Rb()}if(2&t){const t=a.dc();a.Ab(5),a.Dc(" ",t.companySelected.tx_company_name," "),a.Ab(2),a.Fc(" ",t.companySelected.tx_address_street," ",t.companySelected.tx_address_number," ",t.companySelected.cd_city," "),a.Ab(2),a.Dc("Ir a ",t.companySelected.tx_company_name," ")}}let I=(()=>{class t{constructor(t,e,i){this.router=t,this.publicService=e,this.sharedService=i,this.companies=[]}ngOnInit(){}ngAfterViewInit(){document.getElementById("inputCompany").focus()}findCompany(t){t.value.length>1&&this.publicService.findCompany(t.value).subscribe(e=>{e.ok?this.companies=e.companies:(t.value="",this.sharedService.snack("No existen resultados.",2e3,null))},()=>{this.sharedService.snack("Error al obtener las empresas",2e3,null)})}goToCompany(){this.companySelected&&(localStorage.setItem("company",JSON.stringify(this.companySelected)),this.publicService.company=this.companySelected,this.router.navigate(["/public/",this.companySelected.tx_public_name]))}setCompany(t){this.companySelected=t}cleanInput(t){t.value=null}}return t.\u0275fac=function(e){return new(e||t)(a.Mb(s.b),a.Mb(l.a),a.Mb(R.a))},t.\u0275cmp=a.Gb({type:t,selectors:[["app-search"]],decls:5,vars:2,consts:[[1,"saturno-card","saturno-bg-white","shadow-box","animated","fadeIn"],["class","jumbotron text-dark",4,"ngIf"],["class","animated fadeIn jumbotron",4,"ngIf"],["routerLink","/",2,"cursor","pointer"],[1,"jumbotron","text-dark"],[1,"mdi","mdi-domain","icon-search-company"],[1,"mdi","mdi-store","icon-search-company"],[1,"mdi","mdi-hospital-building","icon-search-company"],[1,"mdi","mdi-storefront-outline","icon-search-company"],[1,"mdi","mdi-office-building","icon-search-company"],["routerLink","/register"],[1,"my-2"],["color","warn","logincss","",1,"w-100"],["id","inputCompany","matInput","","placeholder","Empresa S.A.",3,"matAutocomplete","value","keyup"],["inputCompany",""],[1,"input-icon",3,"click"],[1,"mdi","mdi-close"],[3,"optionSelected"],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"animated","fadeIn","jumbotron"],[1,"lead"],[1,"card","py-4","my-4"],[1,"text-company"],[1,"my-0",2,"color","darkblue","font-size","1rem","font-weight","400"],[1,"btn","btn-success","btn-lg","btn-block",3,"click"]],template:function(t,e){1&t&&(a.Sb(0,"div",0),a.Ac(1,x,24,3,"div",1),a.Ac(2,w,10,5,"div",2),a.Sb(3,"div",3),a.Bc(4," Volver al inicio "),a.Rb(),a.Rb()),2&t&&(a.Ab(1),a.jc("ngIf",!e.companySelected),a.Ab(1),a.jc("ngIf",e.companySelected))},directives:[c.j,s.c,s.d,m.c,m.f,p.b,_.c,_.a,c.i,S.k],styles:[""]}),t})();var T=i("AIE+"),j=i("AXWi"),C=i("mrSG"),B=i("XNiG"),P=i("l5mm"),N=i("wd/R"),O=i.n(N);function M(t,e){if(1&t&&(a.Sb(0,"span"),a.Bc(1),a.Rb()),2&t){const t=a.dc(2);a.Ab(1),a.Dc(" ",t.averageToAtt," ")}}function z(t,e){if(1&t&&(a.Sb(0,"span"),a.Bc(1),a.Rb()),2&t){const t=a.dc(2);a.Ab(1),a.Dc(" Pase a la mesa ",null==t.ticket||null==t.ticket.id_session?null:t.ticket.id_session.id_tables[0].nm_table," ")}}function D(t,e){if(1&t&&(a.Sb(0,"span"),a.Bc(1),a.Rb()),2&t){const t=e.$implicit;a.Ab(1),a.Dc(" ",t.nm_table," ")}}function E(t,e){if(1&t&&(a.Sb(0,"span"),a.Bc(1," Pase a las mesas "),a.Ac(2,D,2,1,"span",8),a.Rb()),2&t){const t=a.dc(2);a.Ab(2),a.jc("ngForOf",null==t.ticket||null==t.ticket.id_session?null:t.ticket.id_session.id_tables)}}const F=function(t){return{"screen-myticket-text-alert":t}};function Z(t,e){if(1&t&&(a.Sb(0,"div",11),a.Sb(1,"div",12),a.Bc(2," SU TURNO "),a.Rb(),a.Sb(3,"div",13),a.Bc(4),a.Rb(),a.Sb(5,"div",14),a.Ac(6,M,2,1,"span",7),a.Ac(7,z,2,1,"span",7),a.Ac(8,E,3,1,"span",7),a.Rb(),a.Rb()),2&t){const t=a.dc();a.Ab(3),a.jc("ngClass",a.mc(5,F,t.showAlert)),a.Ab(1),a.Dc(" ",null==t.ticket?null:t.ticket.id_position," "),a.Ab(2),a.jc("ngIf",!(null!=t.ticket&&t.ticket.id_session)),a.Ab(1),a.jc("ngIf",(null==t.ticket?null:t.ticket.id_session)&&1===(null==t.ticket||null==t.ticket.id_session||null==t.ticket.id_session.id_tables?null:t.ticket.id_session.id_tables.length)),a.Ab(1),a.jc("ngIf",(null==t.ticket?null:t.ticket.id_session)&&(null==t.ticket||null==t.ticket.id_session||null==t.ticket.id_session.id_tables?null:t.ticket.id_session.id_tables.length)>1)}}const U=function(t){return{"screen-icon-star-on":t}};function $(t,e){if(1&t){const t=a.Tb();a.Sb(0,"tr"),a.Sb(1,"td",22),a.Bc(2),a.Rb(),a.Sb(3,"td",23),a.Sb(4,"span",24),a.Zb("click",function(){a.sc(t);const i=e.$implicit;return a.dc(2).setScore(i._id,1)}),a.Rb(),a.Rb(),a.Sb(5,"td",23),a.Sb(6,"span",24),a.Zb("click",function(){a.sc(t);const i=e.$implicit;return a.dc(2).setScore(i._id,2)}),a.Rb(),a.Rb(),a.Sb(7,"td",23),a.Sb(8,"span",24),a.Zb("click",function(){a.sc(t);const i=e.$implicit;return a.dc(2).setScore(i._id,3)}),a.Rb(),a.Rb(),a.Sb(9,"td",23),a.Sb(10,"span",24),a.Zb("click",function(){a.sc(t);const i=e.$implicit;return a.dc(2).setScore(i._id,4)}),a.Rb(),a.Rb(),a.Sb(11,"td",23),a.Sb(12,"span",24),a.Zb("click",function(){a.sc(t);const i=e.$implicit;return a.dc(2).setScore(i._id,5)}),a.Rb(),a.Rb(),a.Rb()}if(2&t){const t=e.$implicit,i=a.dc(2);a.Ab(2),a.Dc(" ",t.tx_item," "),a.Ab(2),a.jc("ngClass",a.mc(6,U,i.scores.get(t._id)>=1)),a.Ab(2),a.jc("ngClass",a.mc(8,U,i.scores.get(t._id)>=2)),a.Ab(2),a.jc("ngClass",a.mc(10,U,i.scores.get(t._id)>=3)),a.Ab(2),a.jc("ngClass",a.mc(12,U,i.scores.get(t._id)>=4)),a.Ab(2),a.jc("ngClass",a.mc(14,U,i.scores.get(t._id)>=5))}}function L(t,e){if(1&t&&(a.Sb(0,"div",15),a.Sb(1,"div",16),a.Bc(2,"SU OPINION"),a.Rb(),a.Sb(3,"div",17),a.Sb(4,"div",18),a.Bc(5,"\xa1Su turno ha finalizado!"),a.Rb(),a.Sb(6,"div",19),a.Bc(7," \xbfPodr\xeda dejarnos su opini\xf3n? "),a.Rb(),a.Sb(8,"div",20),a.Sb(9,"table",21),a.Ac(10,$,13,16,"tr",8),a.Rb(),a.Rb(),a.Rb(),a.Rb()),2&t){const t=a.dc();a.Ab(10),a.jc("ngForOf",t.scoreItems)}}function G(t,e){1&t&&(a.Sb(0,"tr"),a.Sb(1,"td"),a.Bc(2,"--"),a.Rb(),a.Sb(3,"td"),a.Bc(4,"--"),a.Rb(),a.Sb(5,"td"),a.Bc(6,"--"),a.Rb(),a.Rb())}function V(t,e){1&t&&(a.Sb(0,"span",30),a.Nb(1,"span",31),a.Rb())}function q(t,e){1&t&&(a.Sb(0,"span",32),a.Nb(1,"span",33),a.Rb())}function J(t,e){1&t&&(a.Sb(0,"span",34),a.Nb(1,"span",35),a.Rb())}function W(t,e){if(1&t&&(a.Sb(0,"tr"),a.Sb(1,"td",25),a.Bc(2),a.Rb(),a.Sb(3,"td",25),a.Bc(4),a.Rb(),a.Sb(5,"td",26),a.Ac(6,V,2,0,"span",27),a.Ac(7,q,2,0,"span",28),a.Ac(8,J,2,0,"span",29),a.Rb(),a.Rb()),2&t){const t=e.$implicit;a.Ab(2),a.Dc(" ",t.id_position,""),a.Ab(2),a.Dc(" ",t.id_session.id_tables.nm_table,""),a.Ab(2),a.jc("ngIf",!t.tm_end),a.Ab(1),a.jc("ngIf",t.id_child&&t.tm_end),a.Ab(1),a.jc("ngIf",!t.id_child&&t.tm_end)}}const X=function(t){return{"button-disabled":t}};function H(t,e){if(1&t){const t=a.Tb();a.Sb(0,"div",36),a.Sb(1,"div",37),a.Sb(2,"div",38),a.Sb(3,"button",39),a.Zb("click",function(){return a.sc(t),a.dc().callWaiter("waiter")}),a.Sb(4,"div"),a.Nb(5,"span",40),a.Rb(),a.Sb(6,"div",41),a.Bc(7," Llamar al mozo "),a.Rb(),a.Rb(),a.Rb(),a.Sb(8,"div",38),a.Sb(9,"button",39),a.Zb("click",function(){return a.sc(t),a.dc().enCamino()}),a.Sb(10,"div"),a.Nb(11,"span",42),a.Rb(),a.Sb(12,"div",41),a.Bc(13," \xa1En camino! "),a.Rb(),a.Rb(),a.Rb(),a.Sb(14,"div",38),a.Sb(15,"button",43),a.Zb("click",function(){return a.sc(t),a.dc().callWaiter("account")}),a.Sb(16,"div"),a.Nb(17,"span",44),a.Rb(),a.Sb(18,"div",41),a.Bc(19," Pedir la Cuenta "),a.Rb(),a.Rb(),a.Rb(),a.Sb(20,"div",38),a.Sb(21,"button",45),a.Zb("click",function(){return a.sc(t),a.dc().endTicket()}),a.Sb(22,"div"),a.Nb(23,"span",46),a.Rb(),a.Sb(24,"div",41),a.Bc(25," Cancelar mi Turno "),a.Rb(),a.Rb(),a.Rb(),a.Rb(),a.Rb()}if(2&t){const t=a.dc();a.Ab(3),a.jc("disabled",null==t.ticket?null:t.ticket.tx_call)("ngClass",a.mc(8,X,null==t.ticket?null:t.ticket.tx_call)),a.Ab(6),a.jc("disabled",!(null!=t.ticket&&t.ticket.id_session)||t.coming)("ngClass",a.mc(10,X,!(null!=t.ticket&&t.ticket.id_session)||t.coming)),a.Ab(6),a.jc("disabled",!t.ticket)("ngClass",a.mc(12,X,!t.ticket)),a.Ab(6),a.jc("disabled",!t.ticket)("ngClass",a.mc(14,X,!t.ticket))}}function K(t,e){1&t&&(a.Sb(0,"div",47),a.Sb(1,"div",37),a.Sb(2,"div",48),a.Sb(3,"span",49),a.Nb(4,"span",50),a.Sb(5,"div"),a.Bc(6,"Inicio"),a.Rb(),a.Rb(),a.Rb(),a.Rb(),a.Rb())}const Q=[{path:"tickets",component:y},{path:"myticket",component:(()=>{class t{constructor(t,e,i,c,n){this.wsService=t,this.publicService=e,this.sharedService=i,this.snack=c,this.router=n,this.showAlert=!1,this.coming=!1,this.ticketTmEnd=null,this.tickets=[],this.ticketsTail=[],this.scoreItems=[],this.scores=new Map,this.subjectUpdateTickets$=new B.a}ngOnInit(){if(!this.publicService.ticket)return this.router.navigate(["/public/tickets"]),void this.sharedService.snack("Debe obtener un turno primero.",5e3);this.coming=!1,document.getElementsByTagName("body")[0].classList.remove("container"),this.wsService.updateTicketsClients().subscribe(this.subjectUpdateTickets$),this.subjectUpdateTickets$.subscribe(()=>{this.getTickets()}),this.publicService.company&&this.publicService.ticket?(this.ticket=this.publicService.ticket,this.publicService.getTickets(this.publicService.company._id)):(this.router.navigate(["/public"]),this.snack.open("Por favor ingrese una empresa primero!",null,{duration:5e3})),this.getTickets()}getTickets(){return Object(C.a)(this,void 0,void 0,function*(){this.ticket&&this.publicService.getTickets(this.ticket.id_company).subscribe(t=>{var e;if(t.ok){this.tickets=t.tickets,this.ticketsTail=t.tickets.filter(t=>null!==t.tm_provided).sort((t,e)=>e.tm_provided-t.tm_provided).slice(0,10),this.pickMyTicket(),(null===(e=this.ticket)||void 0===e?void 0:e.id_session)&&!this.timer?this.timer=Object(P.a)(500).subscribe(t=>{this.showAlert=!this.showAlert}):(this.timer&&this.timer.unsubscribe(),this.showAlert=!1),this.ticket&&null===this.ticket.tm_provided&&this.calculateTimeToAtt();const i=new Audio;i.src="../../assets/bell.wav",i.load(),i.play()}})})}pickMyTicket(){const t=this.tickets.filter(t=>t._id===this.ticket._id)[0];t&&(null!==t.tm_end?this.getScoreItems().then(()=>{this.ticketTmEnd=t.tm_end,this.publicService.clearPublicSession()}):(this.ticket=t,this.publicService.ticket=t,localStorage.setItem("ticket",JSON.stringify(this.ticket))))}calculateTimeToAtt(){let t=this.tickets.filter(t=>null!==t.tm_end),e=this.tickets.filter(t=>null===t.tm_end),i=t.sort((t,e)=>e.tm_end-t.tm_end).slice(0,10).filter(t=>null!==t.tm_att);if(0===i.length)return void(this.averageToAtt="Sin datos todav\xeda");t.sort((t,e)=>e.id_session>t.id_session?-1:1).slice(0,10);let c=0;for(let b of i)c+=b.tm_end-b.tm_att;let n=0,s=null;for(let b of i){let t=0,e=0;b.id_session===s?(t=b.tm_end,n+=b.tm_att-b.tm_att,e=0,t=0):e=b.tm_att,s=b._id,0===n&&(e=b.tm_att)}let o=0;for(let b of e){if(b._id===this.ticket._id)break;o++}this.ticketsAhead=o;let r=c/i.length,a=n/i.length;this.averageToAtt="Su mesa estar\xe1 lista en "+O.a.duration((r+a)*this.ticketsAhead+(r+a)/4).humanize()}toggle(t){t.toggle()}enCamino(){this.coming=!0,this.wsService.emit("cliente-en-camino",this.publicService.ticket.id_socket_waiter)}callWaiter(t){this.publicService.callWaiter(this.ticket._id,t).subscribe(t=>{t.ok&&(this.ticket.tx_call=t.ticket.tx_call,this.snack.open(t.msg,"ACEPTAR",{duration:2e3}))})}endTicket(){return new Promise(t=>{this.sharedService.snack("Esta acci\xf3n finalizara su turno",5e3,"TERMINAR").then(e=>{e&&this.publicService.endTicket(this.ticket._id).subscribe(e=>{e.ok&&(t(),this.snack.open(e.msg,"ACEPTAR",{duration:2e3}),this.publicService.clearPublicSession(),this.router.navigate(["/public"]))})})})}getScoreItems(){return new Promise(t=>{this.publicService.getScoreItems(this.ticket.id_section._id).subscribe(e=>{this.scoreItems=e.scoreitems,t()})})}setScore(t,e){if(this.scores.set(t,e),this.scores.size===this.scoreItems.length){let t=this.ticket._id,e=[];this.scores.forEach(function(i,c,n){e.push({id_ticket:t,id_scoreitem:c,cd_score:i})}),this.publicService.sendScores(e).subscribe(t=>{t.ok&&delete this.ticket}),r.a.mixin({toast:!0,position:"center",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,onOpen:t=>{t.addEventListener("mouseenter",r.a.stopTimer),t.addEventListener("mouseleave",r.a.resumeTimer)}}).fire({icon:"success",title:"\xa1Gracias!"}).then(t=>{t.isDismissed&&this.publicService.clearPublicSessionComplete()})}}ngOnDestroy(){this.subjectUpdateTickets$.complete(),this.timer&&this.timer.unsubscribe()}}return t.\u0275fac=function(e){return new(e||t)(a.Mb(b.a),a.Mb(l.a),a.Mb(R.a),a.Mb(d.a),a.Mb(s.b))},t.\u0275cmp=a.Gb({type:t,selectors:[["app-myticket"]],decls:17,vars:6,consts:[[1,"saturno-bg-tile-1","h-100"],[1,"saturno-card","m-0"],["class","screen-myticket-container shadow-box my-3",4,"ngIf"],["class","card text-white bg-danger my-4",4,"ngIf"],[1,"card","shadow-box","p-2","my-4"],[1,"w-100","table-sm","text-center"],[1,"screen-history-title"],[4,"ngIf"],[4,"ngFor","ngForOf"],["class","container bg-light fixed-bottom shadow-box no-radius text-center py-1",4,"ngIf"],["class","saturno-footer",4,"ngIf"],[1,"screen-myticket-container","shadow-box","my-3"],[1,"screen-myticket-text-header"],[1,"screen-myticket-text",3,"ngClass"],[1,"screen-myticket-text-footer","mt-3",2,"line-height","normal"],[1,"card","text-white","bg-danger","my-4"],[1,"card-header","screen-text-title"],[1,"banner-content","p-3",2,"background-color","rgb(141, 51, 51)"],[1,"xl"],[1,"md"],[1,"text-white","my-4","table-responsive-sm"],[1,"table","table-sm","text-white"],[1,"xl","py-2",2,"width","50%","text-align","left"],[1,"p-0","py-2"],[1,"mdi","mdi-star","screen-icon-star",3,"ngClass","click"],[1,"screen-history-text",2,"text-align","center"],[2,"padding","0","vertical-align","middle"],["style","color: blueviolet",4,"ngIf"],["style","color: red",4,"ngIf"],["style","color: green",4,"ngIf"],[2,"color","blueviolet"],[1,"mdi","mdi-contactless-payment-circle-outline","screen-history-icon"],[2,"color","red"],[1,"mdi","mdi-arrow-left-circle-outline","screen-history-icon"],[2,"color","green"],[1,"mdi","mdi-check-circle-outline","screen-history-icon"],[1,"container","bg-light","fixed-bottom","shadow-box","no-radius","text-center","py-1"],[1,"row"],[1,"col-6","button-content"],[1,"btn","btn-success","button",3,"disabled","ngClass","click"],[1,"mdi","mdi-silverware-fork-knife","xxl"],[1,"button-inner"],[1,"mdi","mdi-walk","xxl"],[1,"btn","btn-danger","button",3,"disabled","ngClass","click"],[1,"mdi","mdi-file-document-edit-outline","xxl"],[1,"btn","btn-dark","button",3,"disabled","ngClass","click"],[1,"mdi","mdi-power","xxl"],[1,"saturno-footer"],[1,"col"],["routerLink","/home",1,"footer-icon-menu"],[1,"mdi","mdi-home","xl"]],template:function(t,e){1&t&&(a.Sb(0,"div",0),a.Sb(1,"div",1),a.Ac(2,Z,9,7,"div",2),a.Ac(3,L,11,1,"div",3),a.Sb(4,"div",4),a.Sb(5,"table",5),a.Sb(6,"tr"),a.Sb(7,"td",6),a.Bc(8," TURNO "),a.Rb(),a.Sb(9,"td",6),a.Bc(10," MESA"),a.Rb(),a.Sb(11,"td",6),a.Bc(12," ESTADO "),a.Rb(),a.Rb(),a.Ac(13,G,7,0,"tr",7),a.Ac(14,W,9,5,"tr",8),a.Rb(),a.Rb(),a.Rb(),a.Rb(),a.Ac(15,H,26,16,"div",9),a.Ac(16,K,7,0,"div",10)),2&t&&(a.Ab(2),a.jc("ngIf",null===e.ticketTmEnd),a.Ab(1),a.jc("ngIf",null!==e.ticketTmEnd),a.Ab(10),a.jc("ngIf",0===e.ticketsTail.length),a.Ab(1),a.jc("ngForOf",e.ticketsTail),a.Ab(1),a.jc("ngIf",e.ticket),a.Ab(1),a.jc("ngIf",!e.ticket))},directives:[c.j,c.i,c.h,s.c],styles:[".screen-icon-star[_ngcontent-%COMP%]{cursor:pointer;transform:scale(2);color:#b64444;top:3px;position:relative;font-size:xx-large}.screen-icon-star-on[_ngcontent-%COMP%]{color:orange}.screen-myticket-container[_ngcontent-%COMP%]{padding:2em;width:13em;height:13em;line-height:3em;border-radius:50%;color:#2f4f4f;background-color:#fcfcfc}.screen-myticket-text-header[_ngcontent-%COMP%]{font-size:1.2em;color:grey}.screen-myticket-text[_ngcontent-%COMP%]{font-size:3.5em;color:red}.screen-myticket-text-alert[_ngcontent-%COMP%]{opacity:.1}.screen-myticket-text-footer[_ngcontent-%COMP%]{font-size:1em;color:grey}.screen-history-title[_ngcontent-%COMP%]{font-size:calc(.8em + .8vw);color:grey}.screen-history-text[_ngcontent-%COMP%]{font-size:calc(1em + .8vw)}.screen-history-icon[_ngcontent-%COMP%]{font-size:calc(1.2em + .8vw)}"]}),t})()},{path:"",component:I},{path:":company",component:j.a},{path:"**",component:T.a}];let Y=(()=>{class t{}return t.\u0275mod=a.Kb({type:t}),t.\u0275inj=a.Jb({factory:function(e){return new(e||t)},imports:[[s.e.forChild(Q)],s.e]}),t})();var tt=i("1+r1"),et=i("j1ZV"),it=i("iTUp");let ct=(()=>{class t{}return t.\u0275mod=a.Kb({type:t}),t.\u0275inj=a.Jb({factory:function(e){return new(e||t)},imports:[[c.b,n.s,n.i,tt.a,et.a,Y,it.a]]}),t})()}}]);