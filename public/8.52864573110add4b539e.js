(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{T8Xv:function(t,e,i){"use strict";i.r(e),i.d(e,"PublicModule",(function(){return bt}));var c=i("SVse"),n=i("s7LF"),s=i("iInd"),o=i("PSD3"),r=i.n(o),a=i("8Y7J"),l=i("Gyf/"),b=i("7AsR"),d=i("zHaW"),u=i("jMqV");function m(t,e){1&t&&(a.Tb(0,"h5",22),a.Tb(1,"span",23),a.yc(2," Cargando... "),a.Sb(),a.Sb())}function p(t,e){if(1&t&&(a.Tb(0,"div"),a.Tb(1,"p",24),a.yc(2," \xa1Bienvenido! Usted esta por sacar un turno para ser atendido en "),a.Sb(),a.Tb(3,"div",25),a.Tb(4,"p",26),a.yc(5),a.Sb(),a.Tb(6,"p",27),a.yc(7),a.Sb(),a.Sb(),a.Sb()),2&t){const t=a.ec(2);a.Ab(5),a.Ac(" ",t.publicService.company.tx_company_name," "),a.Ab(2),a.Cc(" ",t.publicService.company.tx_address_street," ",t.publicService.company.tx_address_number," ",t.publicService.company.cd_city," ")}}function h(t,e){if(1&t){const t=a.Ub();a.Tb(0,"button",28),a.ac("click",(function(){a.rc(t);const i=e.$implicit;return a.ec(2).createTicket(i._id,!1)})),a.yc(1),a.Sb()}if(2&t){const t=e.$implicit;a.Ab(1),a.Ac(" ",t.tx_skill," ")}}function k(t,e){if(1&t){const t=a.Ub();a.Tb(0,"div"),a.xc(1,m,3,0,"h5",9),a.xc(2,p,8,4,"div",1),a.Tb(3,"div",10),a.Tb(4,"div",11),a.Tb(5,"div",12),a.Tb(6,"div"),a.Ob(7,"span",13),a.Ob(8,"span",14),a.Sb(),a.Tb(9,"div"),a.Ob(10,"span",15),a.Ob(11,"span",16),a.Sb(),a.Sb(),a.Tb(12,"div",17),a.Tb(13,"p",18),a.yc(14,"Prioritario"),a.Sb(),a.Tb(15,"mat-slide-toggle",19),a.ac("ngModelChange",(function(e){return a.rc(t),a.ec().blPriority=e})),a.Sb(),a.Sb(),a.Sb(),a.Sb(),a.xc(16,h,2,1,"button",20),a.Tb(17,"button",21),a.ac("click",(function(){return a.rc(t),a.ec().salir()})),a.yc(18," Salir "),a.Sb(),a.Sb()}if(2&t){const t=a.ec();a.Ab(1),a.kc("ngIf",t.loading),a.Ab(1),a.kc("ngIf",!t.loading),a.Ab(13),a.kc("ngModel",t.blPriority),a.Ab(1),a.kc("ngForOf",t.skills)}}let g=(()=>{class t{constructor(t,e,i,c){this.wsService=t,this.publicService=e,this.router=i,this.snack=c,this.loading=!1,this.blPriority=!1}ngOnInit(){if(this.publicService.ticket)this.snack.open("Usted ya tiene un turno!",null,{duration:2e3}),this.router.navigate(["/public/myticket"]);else if(this.publicService.company){let t=this.publicService.company._id;this.wsService.emit("enterCompany",t),this.publicService.readSkills(t).subscribe(t=>{this.skills=t.skills})}else this.snack.open("Por favor ingrese una empresa primero.",null,{duration:2e3}),this.router.navigate(["/public"])}createTicket(t){localStorage.getItem("user")?r.a.fire({icon:"error",title:"Tiene una sesi\xf3n de usuario activa",text:"Usted est\xe1 en una p\xe1gina de acceso al p\xfablico pero tiene una sesi\xf3n de usuario activa. Para obtener un turno debe cerrar la sesi\xf3n de usuario o abrir una pesta\xf1a en modo inc\xf3gnito."}):(this.loading=!0,this.publicService.createTicket(t,this.wsService.idSocket,this.blPriority).subscribe(t=>{t.ok&&(localStorage.setItem("ticket",JSON.stringify(t.ticket)),this.publicService.ticket=t.ticket,this.loading=!1,this.router.navigate(["/public/myticket"]))}))}salir(){this.publicService.clearPublicSession(),this.router.navigate(["/home"])}}return t.\u0275fac=function(e){return new(e||t)(a.Nb(l.a),a.Nb(b.a),a.Nb(s.b),a.Nb(d.a))},t.\u0275cmp=a.Hb({type:t,selectors:[["app-tickets"]],decls:14,vars:1,consts:[[1,"saturno-card","shadow-box","animated","fadeIn"],[4,"ngIf"],[1,"saturno-footer"],[1,"row"],[1,"col"],["routerLink","/public/search",1,"footer-icon-menu"],[1,"mdi","mdi-magnify","xl"],["routerLink","/public/screen",1,"footer-icon-menu"],[1,"mdi","mdi-monitor-dashboard","xl"],["class","card-title",4,"ngIf"],[1,"container"],[1,"row","rounded","border","border-success","mb-3"],[1,"col","bg-success","text-white","p-2"],[1,"mdi","mdi-human-wheelchair","m-2",2,"font-size","xx-large"],[1,"mdi","mdi-human-pregnant","m-2",2,"font-size","xx-large"],[1,"mdi","mdi-baby-carriage","m-2",2,"font-size","xx-large"],[1,"mdi","mdi-human-cane","m-2",2,"font-size","xx-large"],[1,"col","m-3"],[1,"text-uppercase","mx-2","font-weight-bold"],[3,"ngModel","ngModelChange"],["class","btn btn-primary btn-block btn-lg rounded-0 text-uppercase",3,"click",4,"ngFor","ngForOf"],[1,"btn","btn-danger","btn-block","btn-lg","rounded-0","text-uppercase",3,"click"],[1,"card-title"],["id","lblNuevoTicket"],[1,"lead"],[1,"card","py-4","my-4"],[1,"text-company"],[1,"my-0",2,"color","darkblue","font-size","1rem","font-weight","400"],[1,"btn","btn-primary","btn-block","btn-lg","rounded-0","text-uppercase",3,"click"]],template:function(t,e){1&t&&(a.Tb(0,"div",0),a.xc(1,k,19,4,"div",1),a.Tb(2,"div",2),a.Tb(3,"div",3),a.Tb(4,"div",4),a.Tb(5,"span",5),a.Ob(6,"span",6),a.Tb(7,"div"),a.yc(8,"Volver al buscador"),a.Sb(),a.Sb(),a.Sb(),a.Tb(9,"div",4),a.Tb(10,"span",7),a.Ob(11,"span",8),a.Tb(12,"div"),a.yc(13,"Ver la pantalla"),a.Sb(),a.Sb(),a.Sb(),a.Sb(),a.Sb(),a.Sb()),2&t&&(a.Ab(1),a.kc("ngIf",e.publicService.company))},directives:[c.j,s.c,u.a,n.o,n.r,c.i],styles:[""]}),t})();var f=i("XNiG");function y(t,e){1&t&&(a.Tb(0,"div"),a.Tb(1,"span",13),a.yc(2," -- -- "),a.Sb(),a.Sb())}function T(t,e){if(1&t&&(a.Tb(0,"span",14),a.yc(1),a.Sb()),2&t){const t=a.ec();a.Ab(1),a.Bc(" ",null==t.lastTicket||null==t.lastTicket.id_skill?null:t.lastTicket.id_skill.cd_skill," ",null==t.lastTicket?null:t.lastTicket.id_position," ")}}function S(t,e){1&t&&(a.Tb(0,"tr"),a.Tb(1,"td"),a.yc(2,"--"),a.Sb(),a.Tb(3,"td"),a.yc(4,"--"),a.Sb(),a.Tb(5,"td"),a.yc(6,"--"),a.Sb(),a.Sb())}function v(t,e){1&t&&(a.Tb(0,"span",21),a.Ob(1,"span",22),a.Sb())}function _(t,e){1&t&&(a.Tb(0,"span",23),a.Ob(1,"span",24),a.Sb())}function x(t,e){1&t&&(a.Tb(0,"span",25),a.Ob(1,"span",26),a.Sb())}function A(t,e){if(1&t&&(a.Tb(0,"tr",15),a.Tb(1,"td",16),a.yc(2),a.Sb(),a.Tb(3,"td",16),a.yc(4),a.Sb(),a.Tb(5,"td",17),a.xc(6,v,2,0,"span",18),a.xc(7,_,2,0,"span",19),a.xc(8,x,2,0,"span",20),a.Sb(),a.Sb()),2&t){const t=e.$implicit;a.Ab(2),a.Bc("",null==t.id_skill?null:t.id_skill.cd_skill,"",t.id_position,""),a.Ab(2),a.zc(t.id_session.id_desktop.cd_desktop),a.Ab(2),a.kc("ngIf",!t.tm_end),a.Ab(1),a.kc("ngIf",t.id_child&&t.tm_end),a.Ab(1),a.kc("ngIf",!t.id_child&&t.tm_end)}}let O=(()=>{class t{constructor(t,e){this.wsService=t,this.publicService=e,this.ticketsCalled=[],this.ticketsTail=[],this.subjectUpdateTickets$=new f.a}ngOnInit(){document.getElementsByTagName("body")[0].classList.remove("container"),this.wsService.escucharUpdatePublic().subscribe(this.subjectUpdateTickets$);let t=this.publicService.company._id;this.subjectUpdateTickets$.subscribe(()=>{this.getTickets(t)}),this.getTickets(t)}getTickets(t){this.publicService.getTickets(t).subscribe(t=>{if(t.ok){this.ticketsCalled=t.tickets.filter(t=>null!==t.tm_att),this.ticketsTail=[...this.ticketsCalled].sort((t,e)=>e.tm_att-t.tm_att).slice(0,4),this.lastTicket=this.ticketsTail[0];const e=new Audio;e.src="../../assets/bell.wav",e.load(),e.play()}})}ngOnDestroy(){this.subjectUpdateTickets$.complete()}}return t.\u0275fac=function(e){return new(e||t)(a.Nb(l.a),a.Nb(b.a))},t.\u0275cmp=a.Hb({type:t,selectors:[["app-screen"]],decls:26,vars:4,consts:[[1,"container-fluid"],[1,"row"],[1,"col-sm-6"],[1,"card","rounded-0","text-white","bg-danger","my-2"],[1,"card-header","screen-text-title"],[1,"banner-content","bg-light","text-danger",2,"background-color","rgb(141, 51, 51)"],[4,"ngIf"],["class","screen-text-big",4,"ngIf"],[1,"card","rounded-0","text-white","bg-primary","my-2"],[1,"banner-content","bg-light","text-primary"],[1,"w-100","table-sm","text-center"],[1,"screen-text-subtitled"],["class","screen-text-history",4,"ngFor","ngForOf"],[1,"xxxxl"],[1,"screen-text-big"],[1,"screen-text-history"],[2,"text-align","center"],[2,"padding","0","vertical-align","middle"],["style","color: blueviolet",4,"ngIf"],["style","color: red",4,"ngIf"],["style","color: green",4,"ngIf"],[2,"color","blueviolet"],[1,"mdi","mdi-contactless-payment-circle-outline","screen-icons"],[2,"color","red"],[1,"mdi","mdi-arrow-left-circle-outline","screen-icons"],[2,"color","green"],[1,"mdi","mdi-check-circle-outline","screen-icons"]],template:function(t,e){1&t&&(a.Tb(0,"div",0),a.Tb(1,"div",1),a.Tb(2,"div",2),a.Tb(3,"div",3),a.Tb(4,"div",4),a.yc(5,"ULTIMO TURNO"),a.Sb(),a.Tb(6,"div",5),a.xc(7,y,3,0,"div",6),a.Tb(8,"div"),a.xc(9,T,2,2,"span",7),a.Sb(),a.Sb(),a.Sb(),a.Ob(10,"div"),a.Sb(),a.Tb(11,"div",2),a.Tb(12,"div",8),a.Tb(13,"div",4),a.yc(14,"HISTORIAL"),a.Sb(),a.Tb(15,"div",9),a.Tb(16,"table",10),a.Tb(17,"tr"),a.Tb(18,"td",11),a.yc(19," TURNO "),a.Sb(),a.Tb(20,"td",11),a.yc(21," ESCRITORIO"),a.Sb(),a.Tb(22,"td",11),a.yc(23," ESTADO "),a.Sb(),a.Sb(),a.xc(24,S,7,0,"tr",6),a.xc(25,A,9,6,"tr",12),a.Sb(),a.Sb(),a.Sb(),a.Sb(),a.Sb(),a.Sb()),2&t&&(a.Ab(7),a.kc("ngIf",!e.lastTicket),a.Ab(2),a.kc("ngIf",e.lastTicket),a.Ab(15),a.kc("ngIf",0===e.ticketsTail.length),a.Ab(1),a.kc("ngForOf",e.ticketsTail))},directives:[c.j,c.i],styles:[".example-button-container[_ngcontent-%COMP%]{display:flex;justify-content:right;width:120px}.screen-icon-star[_ngcontent-%COMP%]{cursor:pointer;transform:scale(2);color:#b64444;top:3px;position:relative;font-size:xx-large}.screen-icon-star-on[_ngcontent-%COMP%]{color:orange}.button-disabled[_ngcontent-%COMP%]{background-color:#f1f1f1;color:#c7c7c7}.screen-text-title[_ngcontent-%COMP%]{font-size:calc(.7em + 1.5vw)}.screen-myticket-container[_ngcontent-%COMP%]{padding:1.5em;width:12em;height:12em;line-height:3em;border-radius:50%;color:#2f4f4f;background-color:#fcfcfc}.screen-myticket-text-header[_ngcontent-%COMP%]{font-size:1.2em}.screen-myticket-text[_ngcontent-%COMP%]{font-size:3em}.screen-myticket-text-alert[_ngcontent-%COMP%]{opacity:0}.screen-myticket-text-footer[_ngcontent-%COMP%]{font-size:1em}.screen-text-big[_ngcontent-%COMP%]{font-weight:500;font-size:calc(3em + 5vw)}.screen-text-history[_ngcontent-%COMP%]{font-size:calc(1.5em + 1.5vw);border-top:1px solid rgba(98,98,214,.2)}.screen-text-subtitled[_ngcontent-%COMP%]{color:#2f4f4f;border-top:none;font-size:calc(.5em + .8vw)}.screen-icons[_ngcontent-%COMP%]{font-size:calc(.8em + .8vw)}"]}),t})();var w=i("zuHl"),I=i("Q2Ze"),C=i("e6WT"),P=i("vrAh"),M=i("UhP/");function z(t,e){if(1&t&&(a.Tb(0,"mat-option",20),a.yc(1),a.Sb()),2&t){const t=e.$implicit;a.kc("value",t),a.Ab(1),a.Ac(" ",t.tx_company_name," ")}}function N(t,e){if(1&t){const t=a.Ub();a.Tb(0,"div",4),a.Tb(1,"h2"),a.yc(2,"Ingrese la empresa"),a.Sb(),a.Ob(3,"span",5),a.Ob(4,"span",6),a.Ob(5,"span",7),a.Ob(6,"span",8),a.Ob(7,"span",9),a.Ob(8,"hr"),a.Tb(9,"p"),a.yc(10,'La empresa debe estar registrada, por ejemplo "Pizza Taz". Si desea registrar un comercio haga click '),a.Tb(11,"a",10),a.yc(12,"aqu\xed"),a.Sb(),a.Sb(),a.Tb(13,"div",11),a.Tb(14,"mat-form-field",12),a.Tb(15,"mat-label"),a.yc(16,"Ingrese la empresa aqu\xed"),a.Sb(),a.Tb(17,"input",13,14),a.ac("keyup",(function(){a.rc(t);const e=a.qc(18);return a.ec().findCompany(e)})),a.Sb(),a.Tb(19,"span",15),a.ac("click",(function(){a.rc(t);const e=a.qc(18);return a.ec().cleanInput(e)})),a.Ob(20,"i",16),a.Sb(),a.Sb(),a.Tb(21,"mat-autocomplete",17,18),a.ac("optionSelected",(function(e){return a.rc(t),a.ec().setCompany(e.option.value)})),a.xc(23,z,2,2,"mat-option",19),a.Sb(),a.Sb(),a.Sb()}if(2&t){const t=a.qc(22),e=a.ec();a.Ab(17),a.kc("matAutocomplete",t)("value",null==e.companySelected?null:e.companySelected.tx_company_name),a.Ab(6),a.kc("ngForOf",e.companies)}}function U(t,e){if(1&t){const t=a.Ub();a.Tb(0,"div",21),a.Tb(1,"p",22),a.yc(2," Usted esta por ir hacia la recepci\xf3n de turnos de "),a.Sb(),a.Tb(3,"div",23),a.Tb(4,"p",24),a.yc(5),a.Sb(),a.Tb(6,"p",25),a.yc(7),a.Sb(),a.Sb(),a.Tb(8,"button",26),a.ac("click",(function(){return a.rc(t),a.ec().goToCompany()})),a.yc(9),a.Sb(),a.Sb()}if(2&t){const t=a.ec();a.Ab(5),a.Ac(" ",t.companySelected.tx_company_name," "),a.Ab(2),a.Cc(" ",t.companySelected.tx_address_street," ",t.companySelected.tx_address_number," ",t.companySelected.cd_city," "),a.Ab(2),a.Ac("Ir a ",t.companySelected.tx_company_name," ")}}let j=(()=>{class t{constructor(t,e,i){this.router=t,this.publicService=e,this.sharedService=i,this.companies=[]}ngOnInit(){}ngAfterViewInit(){document.getElementById("inputCompany").focus()}findCompany(t){t.value.length>1&&this.publicService.findCompany(t.value).subscribe(e=>{e.ok?this.companies=e.companies:(t.value="",this.sharedService.snackShow("No existen resultados.",2e3,null))},()=>{this.sharedService.snackShow("Error al obtener las empresas",2e3,null)})}goToCompany(){this.companySelected&&(localStorage.setItem("company",JSON.stringify(this.companySelected)),this.publicService.company=this.companySelected,this.router.navigate(["/public/",this.companySelected.tx_public_name]))}setCompany(t){this.companySelected=t}cleanInput(t){t.value=null}}return t.\u0275fac=function(e){return new(e||t)(a.Nb(s.b),a.Nb(b.a),a.Nb(w.a))},t.\u0275cmp=a.Hb({type:t,selectors:[["app-search"]],decls:5,vars:2,consts:[[1,"saturno-card","saturno-bg-white","shadow-box","animated","fadeIn"],["class","jumbotron text-dark",4,"ngIf"],["class","animated fadeIn jumbotron",4,"ngIf"],["routerLink","/",2,"cursor","pointer"],[1,"jumbotron","text-dark"],[1,"mdi","mdi-domain","icon-search-company"],[1,"mdi","mdi-store","icon-search-company"],[1,"mdi","mdi-hospital-building","icon-search-company"],[1,"mdi","mdi-storefront-outline","icon-search-company"],[1,"mdi","mdi-office-building","icon-search-company"],["routerLink","/register"],[1,"my-2"],["color","warn","logincss","",1,"w-100"],["id","inputCompany","matInput","","placeholder","Empresa S.A.",3,"matAutocomplete","value","keyup"],["inputCompany",""],[1,"input-icon",3,"click"],[1,"mdi","mdi-close"],[3,"optionSelected"],["auto","matAutocomplete"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"animated","fadeIn","jumbotron"],[1,"lead"],[1,"card","py-4","my-4"],[1,"text-company"],[1,"my-0",2,"color","darkblue","font-size","1rem","font-weight","400"],[1,"btn","btn-success","btn-lg","btn-block",3,"click"]],template:function(t,e){1&t&&(a.Tb(0,"div",0),a.xc(1,N,24,3,"div",1),a.xc(2,U,10,5,"div",2),a.Tb(3,"div",3),a.yc(4," Volver al inicio "),a.Sb(),a.Sb()),2&t&&(a.Ab(1),a.kc("ngIf",!e.companySelected),a.Ab(1),a.kc("ngIf",e.companySelected))},directives:[c.j,s.c,s.d,I.c,I.f,C.b,P.c,P.a,c.i,M.l],styles:[""]}),t})();var E=i("AIE+"),$=i("AXWi"),L=i("mrSG"),F=i("l5mm"),R=i("wd/R"),B=i.n(R);function D(t,e){if(1&t&&(a.Tb(0,"span"),a.yc(1),a.Sb()),2&t){const t=a.ec(3);a.Ab(1),a.Ac(" ",t.averageToAtt," ")}}function H(t,e){if(1&t&&(a.Tb(0,"span"),a.yc(1),a.Sb()),2&t){const t=a.ec(3);a.Ab(1),a.Ac(" Pase por el escritorio ",null==t.myTicket||null==t.myTicket.id_session||null==t.myTicket.id_session.id_desktop?null:t.myTicket.id_session.id_desktop.cd_desktop," ")}}function V(t,e){if(1&t&&(a.Tb(0,"div",15),a.xc(1,D,2,1,"span",7),a.xc(2,H,2,1,"span",7),a.Sb()),2&t){const t=a.ec(2);a.Ab(1),a.kc("ngIf",!(null!=t.myTicket&&t.myTicket.id_session)),a.Ab(1),a.kc("ngIf",null==t.myTicket?null:t.myTicket.id_session)}}const q=function(t){return{"screen-myticket-text-alert":t}};function J(t,e){if(1&t&&(a.Tb(0,"div",11),a.Tb(1,"div",12),a.yc(2," SU TURNO "),a.Sb(),a.Tb(3,"div",13),a.yc(4),a.Sb(),a.xc(5,V,3,2,"div",14),a.Sb()),2&t){const t=a.ec();a.Ab(3),a.kc("ngClass",a.nc(4,q,t.showAlert)),a.Ab(1),a.Bc(" ",null==t.myTicket?null:t.myTicket.id_skill.cd_skill," ",null==t.myTicket?null:t.myTicket.id_position," "),a.Ab(1),a.kc("ngIf",t.averageToAtt)}}function W(t,e){1&t&&(a.Tb(0,"div",23),a.yc(1,"\xbfPodr\xeda dejarnos su opini\xf3n sobre la calidad de atenci\xf3n?"),a.Sb())}const G=function(t){return{"screen-icon-star-on":t}};function X(t,e){if(1&t){const t=a.Ub();a.Tb(0,"tr"),a.Tb(1,"td",24),a.yc(2),a.Sb(),a.Tb(3,"td",25),a.Tb(4,"span",26),a.ac("click",(function(){a.rc(t);const i=e.$implicit;return a.ec(2).setScore(i._id,1)})),a.Sb(),a.Sb(),a.Tb(5,"td",25),a.Tb(6,"span",26),a.ac("click",(function(){a.rc(t);const i=e.$implicit;return a.ec(2).setScore(i._id,2)})),a.Sb(),a.Sb(),a.Tb(7,"td",25),a.Tb(8,"span",26),a.ac("click",(function(){a.rc(t);const i=e.$implicit;return a.ec(2).setScore(i._id,3)})),a.Sb(),a.Sb(),a.Tb(9,"td",25),a.Tb(10,"span",26),a.ac("click",(function(){a.rc(t);const i=e.$implicit;return a.ec(2).setScore(i._id,4)})),a.Sb(),a.Sb(),a.Tb(11,"td",25),a.Tb(12,"span",26),a.ac("click",(function(){a.rc(t);const i=e.$implicit;return a.ec(2).setScore(i._id,5)})),a.Sb(),a.Sb(),a.Sb()}if(2&t){const t=e.$implicit,i=a.ec(2);a.Ab(2),a.Ac(" ",null==t.id_skill?null:t.id_skill.tx_skill," "),a.Ab(2),a.kc("ngClass",a.nc(6,G,i.scores.get(t._id)>=1)),a.Ab(2),a.kc("ngClass",a.nc(8,G,i.scores.get(t._id)>=2)),a.Ab(2),a.kc("ngClass",a.nc(10,G,i.scores.get(t._id)>=3)),a.Ab(2),a.kc("ngClass",a.nc(12,G,i.scores.get(t._id)>=4)),a.Ab(2),a.kc("ngClass",a.nc(14,G,i.scores.get(t._id)>=5))}}function K(t,e){if(1&t&&(a.Tb(0,"div",16),a.Tb(1,"div",17),a.yc(2,"SU OPINION"),a.Sb(),a.Tb(3,"div",18),a.Tb(4,"div",19),a.yc(5,"\xa1Su turno ha finalizado!"),a.Sb(),a.xc(6,W,2,0,"div",20),a.Tb(7,"div",21),a.Tb(8,"table",22),a.xc(9,X,13,16,"tr",8),a.Sb(),a.Sb(),a.Sb(),a.Sb()),2&t){const t=a.ec();a.Ab(6),a.kc("ngIf",t.allMytickets.length>0),a.Ab(3),a.kc("ngForOf",t.allMytickets)}}function Z(t,e){1&t&&(a.Tb(0,"tr"),a.Tb(1,"td"),a.yc(2,"--"),a.Sb(),a.Tb(3,"td"),a.yc(4,"--"),a.Sb(),a.Tb(5,"td"),a.yc(6,"--"),a.Sb(),a.Sb())}function Q(t,e){1&t&&(a.Tb(0,"span",32),a.Ob(1,"span",33),a.Sb())}function Y(t,e){1&t&&(a.Tb(0,"span",34),a.Ob(1,"span",35),a.Sb())}function tt(t,e){1&t&&(a.Tb(0,"span",36),a.Ob(1,"span",37),a.Sb())}function et(t,e){if(1&t&&(a.Tb(0,"tr"),a.Tb(1,"td",27),a.yc(2),a.Sb(),a.Tb(3,"td",27),a.yc(4),a.Sb(),a.Tb(5,"td",28),a.xc(6,Q,2,0,"span",29),a.xc(7,Y,2,0,"span",30),a.xc(8,tt,2,0,"span",31),a.Sb(),a.Sb()),2&t){const t=e.$implicit;a.Ab(2),a.Bc(" ",null==t.id_skill?null:t.id_skill.cd_skill,"",t.id_position,""),a.Ab(2),a.Ac(" ",t.id_session.id_desktop.cd_desktop,""),a.Ab(2),a.kc("ngIf",!t.tm_end),a.Ab(1),a.kc("ngIf",t.id_child&&t.tm_end),a.Ab(1),a.kc("ngIf",!t.id_child&&t.tm_end)}}const it=function(t){return{"button-disabled":t}};function ct(t,e){if(1&t){const t=a.Ub();a.Tb(0,"div",38),a.Tb(1,"div",39),a.Tb(2,"div",40),a.Tb(3,"button",41),a.ac("click",(function(){return a.rc(t),a.ec().cancelTicket()})),a.Tb(4,"div"),a.Ob(5,"span",42),a.Sb(),a.Tb(6,"div",43),a.yc(7," Cancelar Turno "),a.Sb(),a.Sb(),a.Sb(),a.Tb(8,"div",40),a.Tb(9,"button",44),a.ac("click",(function(){return a.rc(t),a.ec().enCamino()})),a.Tb(10,"div"),a.Ob(11,"span",45),a.Sb(),a.Tb(12,"div",43),a.yc(13," \xa1En camino! "),a.Sb(),a.Sb(),a.Sb(),a.Sb(),a.Sb()}if(2&t){const t=a.ec();a.Ab(3),a.kc("disabled",!t.myTicket)("ngClass",a.nc(4,it,!t.myTicket)),a.Ab(6),a.kc("disabled",!(null!=t.myTicket&&t.myTicket.id_session)||t.coming)("ngClass",a.nc(6,it,!(null!=t.myTicket&&t.myTicket.id_session)||t.coming))}}function nt(t,e){1&t&&(a.Tb(0,"div",46),a.Tb(1,"div",39),a.Tb(2,"div",47),a.Tb(3,"span",48),a.Ob(4,"span",49),a.Tb(5,"div"),a.yc(6,"Inicio"),a.Sb(),a.Sb(),a.Sb(),a.Sb(),a.Sb())}const st=[{path:"tickets",component:g},{path:"myticket",component:(()=>{class t{constructor(t,e,i,c,n){this.wsService=t,this.publicService=e,this.sharedService=i,this.snack=c,this.router=n,this.showAlert=!1,this.coming=!1,this.scores=new Map,this.allMytickets=[],this.ticketTmEnd=null,this.ticketsAll=[],this.ticketsCalled=[],this.ticketsTail=[],this.ticketsEnd=[],this.ticketsWaiting=[],this.subjectUpdateTickets$=new f.a}ngOnInit(){if(!this.publicService.ticket)return this.router.navigate(["/public/tickets"]),void this.sharedService.snackShow("Debe obtener un turno primero.",5e3);this.coming=!1,document.getElementsByTagName("body")[0].classList.remove("container"),this.wsService.escucharUpdatePublic().subscribe(this.subjectUpdateTickets$),this.subjectUpdateTickets$.subscribe(()=>{this.getTickets()}),this.publicService.company&&this.publicService.ticket?(this.myTicket=this.publicService.ticket,this.publicService.getTickets(this.publicService.company._id)):(this.router.navigate(["/public"]),this.snack.open("Por favor ingrese una empresa primero!",null,{duration:5e3})),this.getTickets()}getTickets(){return Object(L.a)(this,void 0,void 0,(function*(){this.myTicket&&this.publicService.getTickets(this.myTicket.id_company).subscribe(t=>{var e;if(t.ok){this.ticketsAll=t.tickets,this.ticketsEnd=t.tickets.filter(t=>null!==t.tm_end),this.ticketsWaiting=t.tickets.filter(t=>null===t.tm_end),this.ticketsCalled=t.tickets.filter(t=>null!==t.tm_att),this.ticketsTail=[...this.ticketsCalled].sort((t,e)=>e.tm_att-t.tm_att).slice(0,10),this.lastTicket=this.ticketsTail[0],this.updateMyTicket(),(null===(e=this.myTicket)||void 0===e?void 0:e.id_session)?this.timer=Object(F.a)(500).subscribe(t=>{this.showAlert=!this.showAlert}):(this.timer&&this.timer.unsubscribe(),this.showAlert=!1),this.myTicket&&this.calculateTimeToAtt();const i=new Audio;i.src="../../assets/bell.wav",i.load(),i.play()}})}))}calculateTimeToAtt(){let t=this.ticketsEnd.sort((t,e)=>e.tm_end-t.tm_end).slice(0,10).filter(t=>t.id_skill._id===this.myTicket.id_skill._id&&null!==t.tm_att);if(0===t.length)return void(this.averageToAtt="Sin datos todav\xeda");this.ticketsEnd.sort((t,e)=>e.id_session>t.id_session?-1:1).slice(0,10).filter(t=>t.id_skill._id===this.myTicket.id_skill._id);let e=0;for(let r of t)e+=r.tm_end-r.tm_att;let i=0,c=null;for(let r of t){let t=0,e=0;r.id_session===c?(t=r.tm_end,i+=r.tm_att-r.tm_att,e=0,t=0):e=r.tm_att,c=r._id,0===i&&(e=r.tm_att)}let n=0;for(let r of this.ticketsWaiting){if(r._id===this.myTicket._id)break;n++}this.ticketsAhead=n;let s=e/t.length,o=i/t.length;this.averageToAtt="Ser\xe1 atendido en "+B.a.duration((s+o)*this.ticketsAhead+(s+o)/4).humanize()}updateMyTicket(){if(this.myTicket){const t=this.ticketsAll.filter(t=>t.id_root===this.myTicket.id_root&&null===t.id_child)[0];t&&(null!==t.tm_end&&null===t.id_child?(this.myTicket=null,this.ticketTmEnd=t.tm_end,this.publicService.clearPublicSession()):(this.myTicket=t,this.publicService.ticket=t,localStorage.setItem("ticket",JSON.stringify(this.myTicket)),this.allMytickets=this.ticketsAll.filter(e=>e.id_root===t.id_root)))}}toggle(t){t.toggle()}enCamino(){this.coming=!0,this.wsService.emit("cliente-en-camino",this.publicService.ticket.id_socket_desk)}cancelTicket(){this.snack.open("Desea cancelar el turno?","SI, CANCELAR",{duration:1e4}).afterDismissed().subscribe(t=>{t.dismissedByAction&&this.publicService.cancelTicket(this.myTicket._id).subscribe(t=>{t.ok&&(this.snack.open(t.msg,"ACEPTAR",{duration:2e3}),this.publicService.clearPublicSession(),this.router.navigate(["/public"]))})})}setScore(t,e){if(this.scores.set(t,e),this.allMytickets.length===this.scores.size){let t=[];this.scores.forEach((function(e,i,c){t.push({id_ticket:i,cd_score:e})})),this.publicService.sendScores(t).subscribe(t=>{}),r.a.mixin({toast:!0,position:"center",showConfirmButton:!1,timer:3e3,timerProgressBar:!0,onOpen:t=>{t.addEventListener("mouseenter",r.a.stopTimer),t.addEventListener("mouseleave",r.a.resumeTimer)}}).fire({icon:"success",title:"\xa1Gracias!"}).then(t=>{t.isDismissed&&this.publicService.clearPublicSessionComplete()})}}ngOnDestroy(){this.subjectUpdateTickets$.complete(),this.timer&&this.timer.unsubscribe()}}return t.\u0275fac=function(e){return new(e||t)(a.Nb(l.a),a.Nb(b.a),a.Nb(w.a),a.Nb(d.a),a.Nb(s.b))},t.\u0275cmp=a.Hb({type:t,selectors:[["app-myticket"]],decls:17,vars:6,consts:[[1,"saturno-bg-tile-1","h-100"],[1,"saturno-card","m-0"],["class","screen-myticket-container shadow-box my-3",4,"ngIf"],["class","card text-white bg-danger my-4",4,"ngIf"],[1,"card","shadow-box","p-2","my-4"],[1,"w-100","table-sm","text-center"],[1,"screen-history-title"],[4,"ngIf"],[4,"ngFor","ngForOf"],["class","container bg-light fixed-bottom shadow-box no-radius text-center py-1",4,"ngIf"],["class","saturno-footer",4,"ngIf"],[1,"screen-myticket-container","shadow-box","my-3"],[1,"screen-myticket-text-header"],[1,"screen-myticket-text",3,"ngClass"],["class","screen-myticket-text-footer mt-3","style","line-height: normal;",4,"ngIf"],[1,"screen-myticket-text-footer","mt-3",2,"line-height","normal"],[1,"card","text-white","bg-danger","my-4"],[1,"card-header","screen-text-title"],[1,"banner-content","p-3",2,"background-color","rgb(141, 51, 51)"],[1,"xl"],["class","md",4,"ngIf"],[1,"text-white","my-4","table-responsive-sm"],[1,"table","table-sm","text-white"],[1,"md"],[1,"xl","py-2",2,"width","50%","text-align","left"],[1,"p-0","py-2"],[1,"mdi","mdi-star","screen-icon-star",3,"ngClass","click"],[1,"screen-history-text",2,"text-align","center"],[2,"padding","0","vertical-align","middle"],["style","color: blueviolet",4,"ngIf"],["style","color: red",4,"ngIf"],["style","color: green",4,"ngIf"],[2,"color","blueviolet"],[1,"mdi","mdi-contactless-payment-circle-outline","screen-history-icon"],[2,"color","red"],[1,"mdi","mdi-arrow-left-circle-outline","screen-history-icon"],[2,"color","green"],[1,"mdi","mdi-check-circle-outline","screen-history-icon"],[1,"container","bg-light","fixed-bottom","shadow-box","no-radius","text-center","py-1"],[1,"row"],[1,"col-6","button-content"],[1,"btn","btn-danger","button",3,"disabled","ngClass","click"],[1,"mdi","mdi-power","xxl"],[1,"button-inner"],[1,"btn","btn-success","button",3,"disabled","ngClass","click"],[1,"mdi","mdi-walk","xxl"],[1,"saturno-footer"],[1,"col"],["routerLink","/home",1,"footer-icon-menu"],[1,"mdi","mdi-home","xl"]],template:function(t,e){1&t&&(a.Tb(0,"div",0),a.Tb(1,"div",1),a.xc(2,J,6,6,"div",2),a.xc(3,K,10,2,"div",3),a.Tb(4,"div",4),a.Tb(5,"table",5),a.Tb(6,"tr"),a.Tb(7,"td",6),a.yc(8," TURNO "),a.Sb(),a.Tb(9,"td",6),a.yc(10," ESCRITORIO"),a.Sb(),a.Tb(11,"td",6),a.yc(12," ESTADO "),a.Sb(),a.Sb(),a.xc(13,Z,7,0,"tr",7),a.xc(14,et,9,6,"tr",8),a.Sb(),a.Sb(),a.Sb(),a.Sb(),a.xc(15,ct,14,8,"div",9),a.xc(16,nt,7,0,"div",10)),2&t&&(a.Ab(2),a.kc("ngIf",e.myTicket),a.Ab(1),a.kc("ngIf",null===e.myTicket&&null!==e.ticketTmEnd),a.Ab(10),a.kc("ngIf",0===e.ticketsTail.length),a.Ab(1),a.kc("ngForOf",e.ticketsTail),a.Ab(1),a.kc("ngIf",e.myTicket),a.Ab(1),a.kc("ngIf",!e.myTicket))},directives:[c.j,c.i,c.h,s.c],styles:[".screen-icon-star[_ngcontent-%COMP%]{cursor:pointer;transform:scale(2);color:#b64444;top:3px;position:relative;font-size:xx-large}.screen-icon-star-on[_ngcontent-%COMP%]{color:orange}.button-disabled[_ngcontent-%COMP%]{background-color:#f1f1f1;color:grey;border:1px solid grey}.screen-myticket-container[_ngcontent-%COMP%]{padding:2em;width:13em;height:13em;line-height:3em;border-radius:50%;color:#2f4f4f;background-color:#fcfcfc}.screen-myticket-text-header[_ngcontent-%COMP%]{font-size:1.2em;color:grey}.screen-myticket-text[_ngcontent-%COMP%]{font-size:3.5em;color:red}.screen-myticket-text-alert[_ngcontent-%COMP%]{opacity:.1}.screen-myticket-text-footer[_ngcontent-%COMP%]{font-size:1em;color:grey}.screen-history-title[_ngcontent-%COMP%]{font-size:calc(.8em + .8vw);color:grey}.screen-history-text[_ngcontent-%COMP%]{font-size:calc(1em + .8vw)}.screen-history-icon[_ngcontent-%COMP%]{font-size:calc(1.2em + .8vw)}"]}),t})()},{path:"screen",component:O},{path:"",component:j},{path:":company",component:$.a},{path:"**",component:E.a}];let ot=(()=>{class t{}return t.\u0275mod=a.Lb({type:t}),t.\u0275inj=a.Kb({factory:function(e){return new(e||t)},imports:[[s.e.forChild(st)],s.e]}),t})();var rt=i("1+r1"),at=i("j1ZV"),lt=i("iTUp");let bt=(()=>{class t{}return t.\u0275mod=a.Lb({type:t}),t.\u0275inj=a.Kb({factory:function(e){return new(e||t)},imports:[[c.b,n.s,n.i,rt.a,at.a,ot,lt.a]]}),t})()}}]);