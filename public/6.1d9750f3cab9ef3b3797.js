(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{dQ6A:function(t,e,i){"use strict";i.r(e),i.d(e,"AssistantModule",(function(){return kt}));var s=i("SVse"),n=i("s7LF"),c=i("iInd"),a=i("AIE+"),o=i("mrSG"),r=i("XNiG"),b=i("l5mm"),d=i("lJxs"),l=i("IzEk"),u=i("vkgz"),h=i("1G5W"),k=i("8Y7J"),S=i("EFyh"),g=i("oIKw"),v=i("Gyf/"),m=i("zHaW"),p=i("jMqV"),T=i("pu8Q"),f=i("zQhy");function y(t,e){1&t&&(k.Tb(0,"div",18),k.Ob(1,"mat-spinner"),k.Sb())}function A(t,e){1&t&&(k.Tb(0,"span"),k.Ob(1,"span",36),k.Sb())}function x(t,e){if(1&t&&(k.Tb(0,"div"),k.Tb(1,"div"),k.yc(2," Atendiendo turno "),k.Sb(),k.Tb(3,"div",37),k.Tb(4,"div",38),k.yc(5),k.Sb(),k.Sb(),k.Sb()),2&t){const t=k.ec(2);k.Ab(5),k.Bc(" ",null==t.assistantService.ticket.id_skill?null:t.assistantService.ticket.id_skill.cd_skill," ",t.assistantService.ticket.id_position," ")}}function _(t,e){if(1&t&&(k.Tb(0,"div"),k.yc(1),k.Sb()),2&t){const t=k.ec(2);k.Ab(1),k.Ac(" ",t.message," ")}}const w=function(){return["/admin/assistants"]};function I(t,e){1&t&&(k.Tb(0,"div",39),k.Tb(1,"p"),k.yc(2," Usted no tiene habilidades asignadas. Debe ir al administrador de asistentes, luego seleccionar el asistente y all\xed asignarle skills / habilidades. "),k.Tb(3,"button",40),k.yc(4,"ADMINISTRADOR DE ASISTENTES"),k.Sb(),k.Sb(),k.Sb()),2&t&&(k.Ab(3),k.kc("routerLink",k.mc(1,w)))}function C(t,e){1&t&&k.Ob(0,"span",45)}function O(t,e){if(1&t&&(k.Tb(0,"span"),k.Ob(1,"mat-radio-button",46),k.Sb()),2&t){const t=k.ec().$implicit;k.Ab(1),k.kc("value",t.id)}}function D(t,e){if(1&t&&(k.Tb(0,"tr"),k.Tb(1,"td",41),k.xc(2,C,1,0,"span",42),k.xc(3,O,2,1,"span",22),k.Sb(),k.Tb(4,"td",43),k.yc(5),k.Sb(),k.Tb(6,"td",44),k.yc(7),k.Sb(),k.Sb()),2&t){const t=e.$implicit,i=k.ec(2);k.Ab(2),k.kc("ngIf",t.assigned),k.Ab(1),k.kc("ngIf",!t.assigned&&!i.waitForClient&&i.assistantService.ticket),k.Ab(2),k.Ac(" ",t.tx_skill," "),k.Ab(2),k.Ac(" ",t.tickets.length," ")}}function F(t,e){if(1&t){const t=k.Ub();k.Tb(0,"div",19),k.Tb(1,"div",20),k.Tb(2,"div",21),k.Tb(3,"span"),k.yc(4),k.Sb(),k.xc(5,A,2,0,"span",22),k.Sb(),k.Tb(6,"div",23),k.Tb(7,"div",24),k.xc(8,x,6,2,"div",22),k.xc(9,_,2,1,"div",22),k.Sb(),k.Sb(),k.Tb(10,"div",25),k.Tb(11,"div",5),k.Tb(12,"div",26),k.Tb(13,"div"),k.yc(14,"TE"),k.Sb(),k.Tb(15,"div"),k.yc(16),k.Sb(),k.Sb(),k.Tb(17,"div",26),k.Tb(18,"div"),k.yc(19,"TA"),k.Sb(),k.Tb(20,"div"),k.yc(21),k.Sb(),k.Sb(),k.Tb(22,"div",26),k.Tb(23,"div"),k.yc(24,"Tm"),k.Sb(),k.Tb(25,"div"),k.yc(26),k.Sb(),k.Sb(),k.Tb(27,"div",26),k.Tb(28,"div"),k.yc(29,"TC"),k.Sb(),k.Tb(30,"div"),k.yc(31),k.Sb(),k.Sb(),k.Sb(),k.Sb(),k.Sb(),k.xc(32,I,5,2,"div",27),k.Tb(33,"div",28),k.Tb(34,"div",29),k.Tb(35,"mat-radio-group",30),k.ac("ngModelChange",(function(e){return k.rc(t),k.ec().skillSelected=e})),k.Tb(36,"table",31),k.Tb(37,"tr",32),k.Ob(38,"td",33),k.Tb(39,"td",33),k.yc(40,"Skill"),k.Sb(),k.Tb(41,"td",34),k.yc(42," En espera "),k.Sb(),k.Sb(),k.xc(43,D,8,4,"tr",35),k.Sb(),k.Sb(),k.Sb(),k.Sb(),k.Sb()}if(2&t){const t=k.ec();k.Ab(4),k.Ac(" ESCRITORIO ",null==t.assistantService.desktop?null:t.assistantService.desktop.cd_desktop," "),k.Ab(1),k.kc("ngIf",t.comingClient),k.Ab(3),k.kc("ngIf",t.assistantService.ticket),k.Ab(1),k.kc("ngIf",t.message),k.Ab(7),k.zc(t.tmWaitingStr),k.Ab(5),k.zc(t.tmAttention),k.Ab(5),k.zc(t.timerCount),k.Ab(5),k.zc(t.pendingTicketsCount),k.Ab(1),k.kc("ngIf",0===t.skillsAssistantThisCompany.length),k.Ab(3),k.kc("ngModel",t.skillSelected),k.Ab(8),k.kc("ngForOf",t.pendingTicketsBySkill)}}const j=function(t){return{"button-disabled":t}};let N=(()=>{class t{constructor(t,e,i,s,n){this.loginService=t,this.assistantService=e,this.wsService=i,this.snack=s,this.router=n,this.loading=!1,this.waitForClient=!1,this.comingClient=!1,this.pendingTicketsCount=0,this.pendingTicketsBySkill=[],this.timerCount=2,this.tmWaitingStr="--:--:--",this.tmAttention="--:--:--",this.message="",this.skills=[],this.skillsAssistantThisCompany=[],this.skillSelected="",this.blPriority=!1,this.subjectUpdateTickets$=new r.a,this.subjectTurnoCancelado$=new r.a}ngOnInit(){return Object(o.a)(this,void 0,void 0,(function*(){this.loading=!0,this.assistantService.desktop?(yield this.readSkills().then(t=>{this.skills=t}).catch(()=>{this.snack.open("Error al obtener los skills",null,{duration:2e3})}),yield this.getTickets(),this.wsService.escucharUpdateDesktops().subscribe(this.subjectUpdateTickets$),this.subjectUpdateTickets$.subscribe(()=>{this.getTickets()}),this.wsService.escucharTicketCancelled().subscribe(this.subjectTurnoCancelado$),this.subjectTurnoCancelado$.subscribe(t=>{var e;t===(null===(e=this.assistantService.ticket)||void 0===e?void 0:e._id)&&(this.snack.open("El turno fue cancelado por el cliente",null,{duration:1e4}),this.clearTicketSession(),this.getTickets())}),this.loading=!1):this.router.navigate(["/assistant/home"])}))}getTickets(){var t;return Object(o.a)(this,void 0,void 0,(function*(){let e=null===(t=this.loginService.user.id_company)||void 0===t?void 0:t._id;return this.assistantService.getTickets(e).subscribe(t=>{const e=t.tickets.filter(t=>{var e,i;return(null===(e=t.id_session)||void 0===e?void 0:e.id_desktop._id)===this.assistantService.desktop.id_session.id_desktop._id&&void 0!==(null===(i=t.id_session)||void 0===i?void 0:i.id_desktop._id)&&null!==t.tm_att&&null===t.tm_end&&null===t.id_child})[0];e?(this.message="Existe un ticket pendiente de resoluci\xf3n",this.assistantService.ticket=e,localStorage.setItem("ticket",JSON.stringify(e))):delete this.assistantService.ticket;let i=this.skills,s=[];this.loginService.user.id_skills.forEach(t=>s.push(t._id));const n=t.tickets.filter(t=>{var e;return null===t.tm_end&&s.includes(null===(e=t.id_skill)||void 0===e?void 0:e._id)}),c=t.tickets.filter(t=>null===t.tm_end);this.pendingTicketsCount=n.length,this.message=n.length>0?`Hay ${n.length} turnos en espera`:"No hay turnos pendientes.",this.pendingTicketsBySkill=[];for(let a of i)s.includes(a._id)&&this.skillsAssistantThisCompany.push(a),this.pendingTicketsBySkill.push({id:a._id,assigned:s.includes(a._id),cd_skill:a.cd_skill,tx_skill:a.tx_skill,tickets:c.filter(t=>{var e;return(null===(e=t.id_skill)||void 0===e?void 0:e._id)===a._id&&null===t.tm_end})});this.loading=!1})}))}clearTicketSession(){delete this.assistantService.ticket,delete this.assistantService.chatMessages,localStorage.getItem("ticket")&&localStorage.removeItem("ticket"),this.tmWaitingStr="--:--:--",this.tmAttention="--:--:--",this.timerCount=2,this.waitForClient=!1,this.tmWaitingSub&&this.tmWaitingSub.unsubscribe(),this.tmExtraTimeSub&&this.tmExtraTimeSub.unsubscribe(),this.tmRunSub&&this.tmRunSub.unsubscribe(),this.getTickets()}clearDesktopSession(){delete this.assistantService.desktop,localStorage.getItem("desktop")&&localStorage.removeItem("desktop"),this.router.navigate(["assistant/home"])}releaseDesktop(){return Object(o.a)(this,void 0,void 0,(function*(){if(this.assistantService.ticket){let t="Tiene una sesi\xf3n de turno activa. \xbfDesea finalizarla?";return yield this.askForContinue(t).then(()=>{this.assistantService.endTicket(this.assistantService.ticket._id).subscribe(t=>{if(t.ok){let e=this.assistantService.ticket._id;this.clearTicketSession(),this.assistantService.releaseDesktop(e).subscribe(e=>{e.ok?this.clearDesktopSession():this.message=t.msg})}})}).catch(()=>{})}this.assistantService.releaseDesktop(this.assistantService.desktop._id).subscribe(t=>{t.ok&&this.clearDesktopSession()})}))}readSkills(){return new Promise((t,e)=>{var i;let s=null===(i=this.loginService.user.id_company)||void 0===i?void 0:i._id;this.assistantService.readSkills(s).subscribe(i=>{i.ok?t(i.skills):e([])})})}askForContinue(t){return new Promise((e,i)=>{this.snack.open(t,"ACEPTAR",{duration:5e3}).afterDismissed().subscribe(t=>{t.dismissedByAction?e():i()})})}takeTicket(){return Object(o.a)(this,void 0,void 0,(function*(){this.assistantService.ticket||this.assistantService.takeTicket(this.assistantService.desktop.id_session._id,this.wsService.idSocket).subscribe(t=>{if(this.snack.open(t.msg,null,{duration:2e3}),t.ok){this.waitForClient=!0,this.message="",this.assistantService.ticket=t.ticket,localStorage.setItem("ticket",JSON.stringify(t.ticket)),this.tmWaitingStr=this.assistantService.getTimeInterval(t.ticket.tm_start,t.ticket.tm_att);const e=this.wsService.escucharEnCamino(),i=Object(b.a)(1e3).pipe(Object(d.a)(t=>t+1),Object(l.a)(2));let s=!1;this.tmWaitingSub=i.pipe(Object(u.a)(t=>this.timerCount=2-t),Object(h.a)(e)).subscribe(t=>{t>=1&&(s=!0)},void 0,()=>{new Promise(t=>{if(s)this.waitForClient=!1,this.comingClient=!1,t();else{this.waitForClient=!0,this.comingClient=!0;const e=Object(b.a)(1e3).pipe(Object(d.a)(t=>t+1),Object(l.a)(5));this.tmExtraTimeSub=e.subscribe(t=>this.timerCount=5-t,void 0,()=>{this.waitForClient=!1,this.comingClient=!1,t()})}}).then(()=>{const t=Object(b.a)(1e3),e=(new Date).getTime();this.tmRunSub=t.subscribe(t=>{this.tmAttention=this.assistantService.getTimeInterval(e,+new Date)})})})}else this.waitForClient=!1,this.message=t.msg}),this.getTickets()}))}releaseTicket(){return Object(o.a)(this,void 0,void 0,(function*(){if(this.assistantService.ticket){let t="Desea soltar el ticket y devolverlo a su estado anterior?";yield this.askForContinue(t).then(()=>{this.assistantService.releaseTicket(this.assistantService.ticket._id).subscribe(t=>{t.ok&&(delete this.assistantService.ticket,this.clearTicketSession(),this.message=t.msg)})}).catch(()=>{})}}))}reassignTicket(){return Object(o.a)(this,void 0,void 0,(function*(){if(this.assistantService.ticket){let t="Desea enviar el ticket al skill seleccionado?";yield this.askForContinue(t).then(()=>{var t;let e=null===(t=this.assistantService.ticket)||void 0===t?void 0:t._id,i=this.skillSelected;e&&i&&this.assistantService.reassignTicket(e,i,this.blPriority).subscribe(t=>{t.ok&&(this.blPriority=!1,this.clearTicketSession(),this.message=t.msg)})}).catch(()=>{})}}))}endTicket(){return Object(o.a)(this,void 0,void 0,(function*(){if(this.assistantService.ticket){let t="Desea finalizar el ticket actual?";yield this.askForContinue(t).then(()=>{this.assistantService.endTicket(this.assistantService.ticket._id).subscribe(t=>{t.ok&&(this.clearTicketSession(),this.message=t.msg)})}).catch(()=>{})}}))}ngOnDestroy(){this.subjectUpdateTickets$.complete(),this.subjectTurnoCancelado$.complete()}}return t.\u0275fac=function(e){return new(e||t)(k.Nb(S.a),k.Nb(g.a),k.Nb(v.a),k.Nb(m.a),k.Nb(c.b))},t.\u0275cmp=k.Hb({type:t,selectors:[["app-desktop"]],decls:39,vars:24,consts:[[1,"saturno-bg-tile-1"],[1,"saturno-card","saturno-bg-grey-5","shadow-box","animated","fadeIn"],["class","mt-5 animated fadeIn",4,"ngIf"],["class","animated fadeIn",4,"ngIf"],[1,"container","bg-light","fixed-bottom","shadow-box","no-radius","text-center","py-1"],[1,"row"],[1,"col-4","col-sm-2","button-content"],[1,"mx-2","my-1",3,"ngModel","disabled","ngModelChange"],[1,"mdi","mdi-human-wheelchair","xl","mx-1"],[1,"btn","btn-success","button",3,"ngClass","disabled","click"],[1,"mdi","mdi-list-status","xl"],[1,"button-inner"],[1,"btn","btn-success","button",3,"disabled","ngClass","click"],[1,"mdi","mdi-chevron-right","xl"],[1,"mdi","mdi-replay","xl"],[1,"mdi","mdi-close","xl"],[1,"btn","btn-danger","button",3,"disabled","ngClass","click"],[1,"mdi","mdi-power","xl"],[1,"mt-5","animated","fadeIn"],[1,"animated","fadeIn"],[1,"card","bg-light","mb-4"],[1,"card-header","banner-title"],[4,"ngIf"],[1,"card-body"],[1,"container"],[1,"card-footer"],[1,"col","p-0"],["class","card bg-danger text-white p-3 mb-4",4,"ngIf"],[1,"card","bg-secondary","mb-4"],[1,"card-content","table-responsive-sm","p-2"],[3,"ngModel","ngModelChange"],[1,"table","table-sm","text-white","text-center"],[2,"border-top","0px","color","yellow"],[2,"text-align","left","border","none"],[2,"text-align","right","border","none"],[4,"ngFor","ngForOf"],[1,"mdi","mdi-walk",2,"float","right","color","green","font-size","x-large"],[1,"banner-content","xxxxl"],[1,"xxxl"],[1,"card","bg-danger","text-white","p-3","mb-4"],[1,"btn","btn-danger","btn-block","btn-sm","my-2",3,"routerLink"],[2,"padding","0","vertical-align","middle","font-size","16px"],["class","mdi mdi-check","style","color: greenyellow",4,"ngIf"],[2,"text-align","left"],[2,"text-align","right"],[1,"mdi","mdi-check",2,"color","greenyellow"],[2,"position","relative","left","4px","top","4px",3,"value"]],template:function(t,e){1&t&&(k.Tb(0,"div",0),k.Tb(1,"div",1),k.xc(2,y,2,0,"div",2),k.xc(3,F,44,11,"div",3),k.Sb(),k.Sb(),k.Tb(4,"div",4),k.Tb(5,"div",5),k.Tb(6,"div",6),k.Tb(7,"mat-slide-toggle",7),k.ac("ngModelChange",(function(t){return e.blPriority=t})),k.Ob(8,"span",8),k.Sb(),k.Sb(),k.Tb(9,"div",6),k.Tb(10,"button",9),k.ac("click",(function(){return e.reassignTicket()})),k.Tb(11,"div"),k.Ob(12,"div",10),k.Sb(),k.Tb(13,"div",11),k.yc(14," Asignar "),k.Sb(),k.Sb(),k.Sb(),k.Tb(15,"div",6),k.Tb(16,"button",12),k.ac("click",(function(){return e.takeTicket()})),k.Tb(17,"div"),k.Ob(18,"div",13),k.Sb(),k.Tb(19,"div",11),k.yc(20," Siguiente "),k.Sb(),k.Sb(),k.Sb(),k.Tb(21,"div",6),k.Tb(22,"button",12),k.ac("click",(function(){return e.releaseTicket()})),k.Tb(23,"div"),k.Ob(24,"div",14),k.Sb(),k.Tb(25,"div",11),k.yc(26," Soltar "),k.Sb(),k.Sb(),k.Sb(),k.Tb(27,"div",6),k.Tb(28,"button",12),k.ac("click",(function(){return e.endTicket()})),k.Tb(29,"div"),k.Ob(30,"div",15),k.Sb(),k.Tb(31,"div",11),k.yc(32," Finalizar "),k.Sb(),k.Sb(),k.Sb(),k.Tb(33,"div",6),k.Tb(34,"button",16),k.ac("click",(function(){return e.releaseDesktop()})),k.Tb(35,"div"),k.Ob(36,"div",17),k.Sb(),k.Tb(37,"div",11),k.yc(38," Salir "),k.Sb(),k.Sb(),k.Sb(),k.Sb(),k.Sb()),2&t&&(k.Ab(2),k.kc("ngIf",e.loading),k.Ab(1),k.kc("ngIf",!e.loading),k.Ab(4),k.kc("ngModel",e.blPriority)("disabled",e.waitForClient||!e.assistantService.ticket||""===e.skillSelected),k.Ab(3),k.kc("ngClass",k.nc(14,j,e.waitForClient||!e.assistantService.ticket||""===e.skillSelected))("disabled",e.waitForClient||!e.assistantService.ticket||""===e.skillSelected),k.Ab(6),k.kc("disabled",e.waitForClient||e.assistantService.ticket)("ngClass",k.nc(16,j,e.waitForClient||e.assistantService.ticket)),k.Ab(6),k.kc("disabled",e.waitForClient||!e.assistantService.ticket)("ngClass",k.nc(18,j,e.waitForClient||!e.assistantService.ticket)),k.Ab(6),k.kc("disabled",e.waitForClient||!e.assistantService.ticket)("ngClass",k.nc(20,j,e.waitForClient||!e.assistantService.ticket)),k.Ab(6),k.kc("disabled",e.waitForClient)("ngClass",k.nc(22,j,e.waitForClient)))},directives:[s.j,p.a,n.o,n.r,s.h,T.b,f.b,s.i,c.c,f.a],styles:[".button-disabled[_ngcontent-%COMP%]{background-color:#f1f1f1;color:#c7c7c7}"]}),t})();var M=i("zuHl"),E=i("Q2Ze"),z=i("ZTz/"),$=i("UhP/");function U(t,e){1&t&&(k.Tb(0,"div",6),k.Ob(1,"mat-spinner"),k.Sb())}function H(t,e){1&t&&(k.Tb(0,"div",10),k.yc(1," No tiene asignada ning\xfana empresa. Debe seleccionarla desde el men\xfa prinicipal. "),k.Sb())}function P(t,e){1&t&&(k.Tb(0,"div",10),k.yc(1," No tiene escritorios creados. Debe darlos de alta desde el Men\xfa de Administrador. "),k.Sb())}function R(t,e){if(1&t){const t=k.Ub();k.Tb(0,"div",22),k.Tb(1,"div",23),k.Tb(2,"div",24),k.yc(3),k.Sb(),k.Sb(),k.Tb(4,"div",23),k.Tb(5,"div",24),k.Tb(6,"button",25),k.ac("click",(function(){k.rc(t);const e=k.ec(3);return e.takeDesktop(e.myDesktop)})),k.yc(7," Ingresar "),k.Sb(),k.Sb(),k.Tb(8,"div",24),k.Tb(9,"button",26),k.ac("click",(function(){k.rc(t);const e=k.ec(3);return e.releaseDesktop(e.myDesktop)})),k.yc(10," Cerrar "),k.Sb(),k.Sb(),k.Sb(),k.Sb()}if(2&t){const t=k.ec(3);k.Ab(3),k.Ac(" Usted tiene tomado el escritorio ",t.myDesktop.cd_desktop," ")}}function W(t,e){1&t&&(k.Tb(0,"div",28),k.yc(1," Todos los escritorios estan tomados. "),k.Sb())}function J(t,e){if(1&t&&(k.Tb(0,"mat-option",34),k.yc(1),k.Sb()),2&t){const t=e.$implicit;k.kc("value",t),k.Ab(1),k.Ac(" ",t.cd_desktop," ")}}function B(t,e){if(1&t){const t=k.Ub();k.Tb(0,"div",3),k.Tb(1,"mat-form-field",29),k.Tb(2,"mat-label"),k.yc(3,"Seleccione un escritorio"),k.Sb(),k.Tb(4,"mat-select",30,31),k.xc(6,J,2,2,"mat-option",32),k.Sb(),k.Sb(),k.Tb(7,"button",33),k.ac("click",(function(){k.rc(t);const e=k.qc(5);return k.ec(4).takeDesktop(null==e?null:e.value)})),k.yc(8," Ingresar "),k.Sb(),k.Sb()}if(2&t){const t=k.ec(4);k.Ab(6),k.kc("ngForOf",t.desktopsAvailable)}}function q(t,e){if(1&t&&(k.Tb(0,"div",3),k.xc(1,W,2,0,"div",27),k.xc(2,B,9,1,"div",12),k.Sb()),2&t){const t=k.ec(3);k.Ab(1),k.kc("ngIf",0===t.desktopsAvailable.length),k.Ab(1),k.kc("ngIf",t.desktopsAvailable.length>0)}}function L(t,e){if(1&t&&(k.Tb(0,"div"),k.yc(1),k.Sb()),2&t){const t=k.ec().$implicit;k.Ab(1),k.Ac(" ",null==t.id_session?null:t.id_session.id_assistant.tx_name," ")}}function G(t,e){1&t&&(k.Tb(0,"div",38),k.yc(1," Disponible "),k.Sb())}function Q(t,e){if(1&t&&(k.Tb(0,"tr"),k.Tb(1,"td",35),k.yc(2),k.Sb(),k.Tb(3,"td",36),k.xc(4,L,2,1,"div",9),k.xc(5,G,2,0,"div",37),k.Sb(),k.Sb()),2&t){const t=e.$implicit;k.Ab(2),k.Ac(" ",t.cd_desktop," "),k.Ab(2),k.kc("ngIf",t.id_session),k.Ab(1),k.kc("ngIf",!t.id_session)}}function K(t,e){if(1&t&&(k.Tb(0,"div"),k.xc(1,R,11,1,"div",11),k.xc(2,q,3,2,"div",12),k.Tb(3,"div",13),k.Tb(4,"div",14),k.Tb(5,"table",15),k.Tb(6,"tr",16),k.Tb(7,"td",17),k.Ob(8,"span",18),k.yc(9," Escritorio "),k.Sb(),k.Tb(10,"td",19),k.Ob(11,"span",20),k.yc(12," Asistente "),k.Sb(),k.Sb(),k.xc(13,Q,6,3,"tr",21),k.Sb(),k.Sb(),k.Sb(),k.Sb()),2&t){const t=k.ec(2);k.Ab(1),k.kc("ngIf",t.myDesktop),k.Ab(1),k.kc("ngIf",!t.myDesktop),k.Ab(11),k.kc("ngForOf",t.desktops)}}function X(t,e){if(1&t&&(k.Tb(0,"div",6),k.Tb(1,"p",7),k.yc(2,"Bienvenido, desde aqu\xed puede tomar escritorios y atender turnos."),k.Sb(),k.xc(3,H,2,0,"div",8),k.xc(4,P,2,0,"div",8),k.xc(5,K,14,3,"div",9),k.Sb()),2&t){const t=k.ec();k.Ab(3),k.kc("ngIf",!t.loginService.user.id_company),k.Ab(1),k.kc("ngIf",0===(null==t.desktops?null:t.desktops.length)),k.Ab(1),k.kc("ngIf",(null==t.desktops?null:t.desktops.length)>0&&(null==t.loginService.user.id_company?null:t.loginService.user.id_company._id))}}let V=(()=>{class t{constructor(t,e,i,s,n){this.router=t,this.loginService=e,this.assistantService=i,this.sharedService=s,this.snack=n,this.loading=!1,this.desktops=[],this.desktopsAvailable=[]}ngOnInit(){var t;if(this.loading=!0,!(null===(t=this.loginService.user.id_company)||void 0===t?void 0:t._id))return this.sharedService.snackShow("No tiene una empresa seleccionada",5e3),void(this.loading=!1);this.readDesktops(this.loginService.user.id_company._id),this.userSuscription=this.loginService.user$.subscribe(t=>{t&&this.readDesktops(t.id_company._id)})}takeDesktop(t){t&&(this.assistantService.desktop?this.router.navigate(["/assistant/desktop"]):this.assistantService.takeDesktop(t._id,this.loginService.user._id).subscribe(t=>{this.snack.open(t.msg,null,{duration:2e3}),t.ok?(this.assistantService.desktop=t.desktop,localStorage.setItem("desktop",JSON.stringify(t.desktop)),this.router.navigate(["/assistant/desktop"])):this.snack.open("No se pudo tomar un escritorio",null,{duration:2e3})}))}readDesktops(t){this.assistantService.readDesktops(t).subscribe(t=>{t.ok&&(this.desktops=t.desktops,this.desktopsAvailable=this.desktops.filter(t=>null===t.id_session),this.myDesktop=this.desktops.filter(t=>{var e;return(null===(e=t.id_session)||void 0===e?void 0:e.id_assistant._id)===this.loginService.user._id})[0]),this.myDesktop?(this.assistantService.desktop=this.myDesktop,localStorage.setItem("desktop",JSON.stringify(this.myDesktop))):(delete this.assistantService.desktop,localStorage.getItem("desktop")&&localStorage.removeItem("desktop"))},()=>{this.loading=!1},()=>{this.loading=!1})}releaseDesktop(t){this.loading=!0;let e=this.loginService.user.id_company._id;this.assistantService.releaseDesktop(t._id).subscribe(t=>{this.readDesktops(e)},()=>{this.loading=!1},()=>{this.loading=!1})}ngOnDestroy(){this.userSuscription&&this.userSuscription.unsubscribe()}}return t.\u0275fac=function(e){return new(e||t)(k.Nb(c.b),k.Nb(S.a),k.Nb(g.a),k.Nb(M.a),k.Nb(m.a))},t.\u0275cmp=k.Hb({type:t,selectors:[["app-home"]],decls:10,vars:2,consts:[[1,"saturno-bg-tile-1"],[1,"saturno-card","saturno-bg-grey-5","shadow-box","animated","fadeIn"],["class","animated fadeIn",4,"ngIf"],[1,"my-4"],["routerLink","/assistant/dashboard","role","button",1,"btn","btn-primary","btn-block"],[1,"mdi","mdi-finance","mx-1"],[1,"animated","fadeIn"],[1,"lead"],["class","card lead bg-danger text-white p-3 my-4","style","line-height: initial;",4,"ngIf"],[4,"ngIf"],[1,"card","lead","bg-danger","text-white","p-3","my-4",2,"line-height","initial"],["class","container-fluid",4,"ngIf"],["class","my-4",4,"ngIf"],[1,"card","bg-secondary","mb-4"],[1,"card-content","table-responsive-sm","p-2"],[1,"table","table-sm","text-white","text-center"],[2,"border-top","0px","color","yellow"],[2,"text-align","left","border","none"],[1,"mdi","mdi-monitor","mx-1"],[2,"text-align","right","border","none"],[1,"mdi","mdi-face-agent","mx-1"],[4,"ngFor","ngForOf"],[1,"container-fluid"],[1,"row","my-4"],[1,"col"],["role","button",1,"btn","btn-success","btn-block","text-uppercase",3,"click"],["role","button",1,"btn","btn-danger","btn-block","text-uppercase",3,"click"],["class","card bg-danger text-white p-2 my-4",4,"ngIf"],[1,"card","bg-danger","text-white","p-2","my-4"],[1,"w-100"],["matNativeControl","","required",""],["selectDesktop",""],[3,"value",4,"ngFor","ngForOf"],["role","button",1,"btn","btn-success","btn-block",3,"click"],[3,"value"],[2,"text-align","left"],[2,"text-align","right"],["style","color: mediumspringgreen;",4,"ngIf"],[2,"color","mediumspringgreen"]],template:function(t,e){1&t&&(k.Tb(0,"div",0),k.Tb(1,"div",1),k.xc(2,U,2,0,"div",2),k.xc(3,X,6,3,"div",2),k.Ob(4,"hr",3),k.Tb(5,"p"),k.yc(6," Recuerde que si se ausenta del escritorio debe finalizar la sesi\xf3n del escritorio. Si usted finaliza la sesi\xf3n de user se finalizar\xe1 tambi\xe9n la sesi\xf3n del escritorio. Si la sesi\xf3n del escritorio ten\xeda asignada una sesi\xf3n de turno, este turno finalizar\xe1. "),k.Sb(),k.Tb(7,"button",4),k.Ob(8,"span",5),k.yc(9," Dashboard "),k.Sb(),k.Sb(),k.Sb()),2&t&&(k.Ab(2),k.kc("ngIf",e.loading),k.Ab(1),k.kc("ngIf",!e.loading))},directives:[s.j,c.c,T.b,s.i,E.c,E.f,z.a,$.l],styles:[""]}),t})();var Z=i("IheW"),Y=i("cxbk");let tt=(()=>{class t{constructor(t,e){this.http=t,this.loginService=e}getUserMetrics(t,e){const i=new Z.c({"turnos-token":this.loginService.token});return this.http.post(Y.a.url+"/m/getusermetrics",{fcSel:t,idUser:e},{headers:i})}}return t.\u0275fac=function(e){return new(e||t)(k.Xb(Z.a),k.Xb(S.a))},t.\u0275prov=k.Jb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var et=i("e6WT"),it=i("TN/R"),st=i("wd/R"),nt=i.n(st);let ct=(()=>{class t{transform(t){return nt()(t).format("H:mm:ss")}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275pipe=k.Mb({name:"timeToHms",type:t,pure:!0}),t})(),at=(()=>{class t{transform(t,e){let i=nt.a.duration(e-t),s=i.hours(),n=i.minutes(),c=i.seconds();return`${s<=9?"0"+s.toString():s.toString()}:${n<=9?"0"+n.toString():n.toString()}:${c<=9?"0"+c.toString():c.toString()}`}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275pipe=k.Mb({name:"intervalToHms",type:t,pure:!0}),t})();function ot(t,e){1&t&&(k.Tb(0,"div",2),k.Ob(1,"mat-spinner"),k.Sb())}function rt(t,e){if(1&t&&(k.Tb(0,"tr"),k.Tb(1,"td",25),k.yc(2),k.Sb(),k.Tb(3,"td",26),k.yc(4),k.fc(5,"timeToHms"),k.Sb(),k.Tb(6,"td",26),k.yc(7),k.fc(8,"intervalToHms"),k.Sb(),k.Tb(9,"td",26),k.yc(10),k.fc(11,"timeToHms"),k.Sb(),k.Tb(12,"td",26),k.yc(13),k.fc(14,"intervalToHms"),k.Sb(),k.Tb(15,"td",27),k.yc(16),k.fc(17,"timeToHms"),k.Sb(),k.Sb()),2&t){const t=e.$implicit;k.Ab(2),k.Bc(" ",t.id_skill.cd_skill," ",t.id_position," "),k.Ab(2),k.Ac(" ",k.gc(5,7,t.tm_start)," "),k.Ab(3),k.Ac(" ",k.hc(8,9,t.tm_start,t.tm_att)," "),k.Ab(3),k.Ac(" ",k.gc(11,12,t.tm_att)," "),k.Ab(3),k.Ac(" ",k.hc(14,14,t.tm_att,t.tm_end)," "),k.Ab(3),k.Ac(" ",k.gc(17,17,t.tm_end)," ")}}function bt(t,e){if(1&t){const t=k.Ub();k.Tb(0,"div"),k.Tb(1,"div",3),k.Tb(2,"div",4),k.Tb(3,"div",5),k.Tb(4,"mat-form-field",6),k.Tb(5,"mat-label"),k.yc(6,"Angular forms"),k.Sb(),k.Tb(7,"input",7),k.ac("dateChange",(function(e){return k.rc(t),k.ec().setDate(e)})),k.Sb(),k.Ob(8,"mat-datepicker-toggle",8),k.Ob(9,"mat-datepicker",null,9),k.Sb(),k.Sb(),k.Sb(),k.Tb(11,"div",10),k.Tb(12,"div",11),k.Tb(13,"div",12),k.Tb(14,"div",13),k.yc(15,"Turnos"),k.Sb(),k.Tb(16,"div",14),k.yc(17),k.Sb(),k.Sb(),k.Sb(),k.Tb(18,"div",11),k.Tb(19,"div",15),k.Tb(20,"div",13),k.yc(21,"Evals"),k.Sb(),k.Tb(22,"div",14),k.yc(23),k.Sb(),k.Sb(),k.Sb(),k.Tb(24,"div",11),k.Tb(25,"div",16),k.Tb(26,"div",13),k.yc(27,"Score"),k.Sb(),k.Tb(28,"div",14),k.yc(29),k.Sb(),k.Sb(),k.Sb(),k.Sb(),k.Tb(30,"div",4),k.Tb(31,"div",11),k.Tb(32,"div",17),k.Tb(33,"div",18),k.Tb(34,"table",19),k.Tb(35,"tr",20),k.Tb(36,"td",21),k.yc(37,"Ticket"),k.Sb(),k.Tb(38,"td",22),k.yc(39,"Start"),k.Sb(),k.Tb(40,"td",22),k.yc(41," - "),k.Sb(),k.Tb(42,"td",22),k.yc(43,"Atteneded"),k.Sb(),k.Tb(44,"td",22),k.yc(45," - "),k.Sb(),k.Tb(46,"td",23),k.yc(47,"End"),k.Sb(),k.Sb(),k.xc(48,rt,18,19,"tr",24),k.Sb(),k.Sb(),k.Sb(),k.Sb(),k.Sb(),k.Sb(),k.Sb()}if(2&t){const t=k.qc(10),e=k.ec();k.Ab(7),k.kc("matDatepicker",t)("value",e.date),k.Ab(1),k.kc("for",t),k.Ab(9),k.Ac(" ",e.metrics.tickets.length," "),k.Ab(6),k.Ac(" ",e.metrics.total," "),k.Ab(6),k.Ac(" ",e.metrics.avg," "),k.Ab(19),k.kc("ngForOf",e.metrics.tickets)}}const dt=[{path:"home",component:V},{path:"desktop",component:N},{path:"dashboard",component:(()=>{class t{constructor(t,e){this.MetricsService=t,this.loginService=e,this.loading=!1,this.metrics={total:0,avg:0,tickets:[]},this.date=new Date}ngOnInit(){let t=(new Date).setHours(0,0,0,0);this.getMetrics(t)}setDate(t){let e=+new Date(t.value);this.date=new Date(e),this.getMetrics(e)}getMetrics(t){this.loading=!0,this.MetricsService.getUserMetrics(t,this.loginService.user._id).subscribe(t=>{this.metrics=t.metrics,this.loading=!1},()=>{this.loading=!1})}}return t.\u0275fac=function(e){return new(e||t)(k.Nb(tt),k.Nb(S.a))},t.\u0275cmp=k.Hb({type:t,selectors:[["app-dashboard"]],decls:2,vars:2,consts:[["class","mt-5 animated fadeIn",4,"ngIf"],[4,"ngIf"],[1,"mt-5","animated","fadeIn"],[1,"saturno-card"],[1,"row"],[1,"col","w-100"],[1,"w-100"],["matInput","",3,"matDatepicker","value","dateChange"],["matSuffix","",3,"for"],["picker1",""],[1,"row","mb-4"],[1,"col"],[1,"card","text-white","bg-success"],[1,"card-header"],[1,"card-body","saturno-card-mini-body"],[1,"card","text-white","bg-danger"],[1,"card","text-white","bg-primary"],[1,"card","bg-secondary","mb-4"],[1,"card-content","table-responsive-sm","p-2"],[1,"table","table-sm","text-white","text-center",2,"font-size","x-small"],[2,"border-top","0px","color","yellow"],[2,"text-align","left","border","none"],[2,"text-align","center","border","none"],[2,"text-align","right","border","none"],[4,"ngFor","ngForOf"],[2,"text-align","left"],[2,"text-align","center"],[2,"text-align","right"]],template:function(t,e){1&t&&(k.xc(0,ot,2,0,"div",0),k.xc(1,bt,49,7,"div",1)),2&t&&(k.kc("ngIf",e.loading),k.Ab(1),k.kc("ngIf",!e.loading))},directives:[s.j,T.b,E.c,E.f,et.b,it.b,it.d,E.g,it.a,s.i],pipes:[ct,at],styles:[""]}),t})()},{path:"",redirectTo:"/assistant/home",pathMatch:"full"},{path:"**",component:a.a}];let lt=(()=>{class t{}return t.\u0275mod=k.Lb({type:t}),t.\u0275inj=k.Kb({factory:function(e){return new(e||t)},imports:[[c.e.forChild(dt)],c.e]}),t})();var ut=i("1+r1"),ht=i("iTUp");let kt=(()=>{class t{}return t.\u0275mod=k.Lb({type:t}),t.\u0275inj=k.Kb({factory:function(e){return new(e||t)},imports:[[n.i,s.b,ut.a,ht.a,lt]]}),t})()}}]);