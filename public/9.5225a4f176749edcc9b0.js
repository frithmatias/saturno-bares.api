(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{rakS:function(t,e,i){"use strict";i.r(e),i.d(e,"WaiterModule",function(){return ae});var s=i("SVse"),n=i("s7LF"),c=i("iInd"),a=i("AIE+"),b=i("mrSG"),l=i("XNiG"),r=i("l5mm"),o=i("8Y7J"),d=i("EFyh"),u=i("d+tV"),m=i("zuHl"),g=i("Gyf/"),S=i("wd/R"),p=i.n(S);let f=(()=>{class t{transform(t,e){if(!t)return"-";e||(e=+new Date);let i=p.a.duration(e-t),s=i.hours(),n=i.minutes(),c=i.seconds();return`${0===s?"":s.toString()+":"}${n<=9?"0"+n.toString()+":":n.toString()+":"}${c<=9?"0"+c.toString():c.toString()}`}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275pipe=o.Lb({name:"intervalToHms",type:t,pure:!0}),t.\u0275prov=o.Ib({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var h=i("pu8Q"),_=i("o4Yh"),v=i("zQhy");function R(t,e){1&t&&o.Nb(0,"span",21)}function x(t,e){if(1&t&&(o.Sb(0,"tr"),o.Sb(1,"td",18),o.Bc(2),o.Ac(3,R,1,0,"span",19),o.Rb(),o.Sb(4,"td",20),o.Bc(5),o.Rb(),o.Sb(6,"td",20),o.Bc(7),o.Rb(),o.Sb(8,"td",20),o.Bc(9),o.Rb(),o.Sb(10,"td",20),o.Bc(11),o.Rb(),o.Sb(12,"td",20),o.Bc(13),o.Rb(),o.Rb()),2&t){const t=e.$implicit,i=o.dc(2);o.Ab(2),o.Dc(" ",t.tx_section," "),o.Ab(1),o.jc("ngIf",i.tablesDataBySection.get(t.tx_section).sectionselected),o.Ab(2),o.Dc(" ",i.tablesDataBySection.get(t.tx_section).busy," "),o.Ab(2),o.Dc(" ",i.tablesDataBySection.get(t.tx_section).idle," "),o.Ab(2),o.Dc(" ",i.tablesDataBySection.get(t.tx_section).paused," "),o.Ab(2),o.Dc(" ",i.ticketsDataBySection.get(t.tx_section).requested," "),o.Ab(2),o.Dc(" ",i.ticketsDataBySection.get(t.tx_section).queued," ")}}function k(t,e){if(1&t&&(o.Sb(0,"table",6),o.Sb(1,"tr"),o.Sb(2,"td",7),o.Bc(3,"Sector"),o.Rb(),o.Sb(4,"td",8),o.Bc(5,"Mesas"),o.Rb(),o.Sb(6,"td",9),o.Bc(7,"Turnos"),o.Rb(),o.Rb(),o.Sb(8,"tr",10),o.Nb(9,"td",11),o.Nb(10,"td",12),o.Nb(11,"td",13),o.Nb(12,"td",14),o.Nb(13,"td",15),o.Nb(14,"td",16),o.Rb(),o.Ac(15,x,14,7,"tr",17),o.Rb()),2&t){const t=o.dc();o.Ab(15),o.jc("ngForOf",t.waiterService.sections)}}let A=(()=>{class t{constructor(t,e){this.loginService=t,this.waiterService=e}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)(o.Mb(d.a),o.Mb(u.a))},t.\u0275cmp=o.Gb({type:t,selectors:[["app-sections"]],inputs:{tablesDataBySection:"tablesDataBySection",ticketsDataBySection:"ticketsDataBySection"},decls:10,vars:3,consts:[[1,"xl","mdi","mdi-select-group","text-success"],[1,"sidenav-title-text","mx-2"],[1,"card","bg-secondary","mb-3"],[1,"card-body","table-responsive-sm","p-2"],[3,"ngModel","ngModelChange"],["class","table table-sm text-white text-center",4,"ngIf"],[1,"table","table-sm","text-white","text-center"],[2,"text-align","left","border","none"],["colspan","3",2,"text-align","center","border","none"],["colspan","2",2,"text-align","center","border","none"],[2,"border-top","3px solid #4fac40","background-color","whitesmoke"],[1,"xl","mdi","mdi-select-group","text-warning",2,"text-align","left","border","none"],[1,"xl","mdi","mdi-minus-circle-outline","text-danger",2,"text-align","center","border","none"],[1,"xl","mdi","mdi-check-circle-outline","text-success",2,"text-align","center","border","none"],[1,"xl","mdi","mdi-pause-circle-outline","text-secondary",2,"text-align","center","border","none"],[1,"xl","mdi","mdi-alert-box","text-danger",2,"text-align","center","border","none"],[1,"xl","mdi","mdi-format-list-numbered","text-primary",2,"text-align","center","border","none"],[4,"ngFor","ngForOf"],[2,"text-align","left"],["class","mdi mdi-check lg text-warning",4,"ngIf"],[2,"text-align","center"],[1,"mdi","mdi-check","lg","text-warning"]],template:function(t,e){1&t&&(o.Sb(0,"mat-expansion-panel"),o.Sb(1,"mat-expansion-panel-header"),o.Sb(2,"mat-panel-title"),o.Nb(3,"span",0),o.Sb(4,"span",1),o.Bc(5),o.Rb(),o.Rb(),o.Rb(),o.Sb(6,"div",2),o.Sb(7,"div",3),o.Sb(8,"mat-radio-group",4),o.Zb("ngModelChange",function(t){return e.waiterService.sectionSelected=t}),o.Ac(9,k,16,1,"table",5),o.Rb(),o.Rb(),o.Rb(),o.Rb()),2&t&&(o.Ab(5),o.Dc("Sectores (",e.waiterService.sections.length,")"),o.Ab(3),o.jc("ngModel",e.waiterService.sectionSelected),o.Ab(1),o.jc("ngIf",e.tablesDataBySection.size>0&&e.ticketsDataBySection.size>0))},directives:[_.c,_.d,_.e,v.a,n.o,n.r,s.j,s.i],styles:[""]}),t})();var w=i("pMoy"),y=i("jMqV");function I(t,e){1&t&&o.Nb(0,"span",28)}function B(t,e){1&t&&o.Nb(0,"span",29)}function j(t,e){1&t&&o.Nb(0,"span",30)}function T(t,e){1&t&&o.Nb(0,"span",31)}function M(t,e){if(1&t&&(o.Sb(0,"span"),o.Bc(1),o.Rb()),2&t){const t=o.dc().$implicit,e=o.dc(2);o.Ab(1),o.Dc(" ",e.busyTablesTimes.get(t.nm_table).tm_provided," ")}}function N(t,e){1&t&&o.Nb(0,"span",32)}function D(t,e){1&t&&o.Nb(0,"span",33)}function C(t,e){1&t&&o.Nb(0,"span",34)}function O(t,e){1&t&&o.Nb(0,"span",35)}function q(t,e){if(1&t&&(o.Sb(0,"span"),o.Bc(1),o.Rb()),2&t){const t=o.dc().$implicit,e=o.dc(2);o.Ab(1),o.Dc(" ",e.busyTablesTimes.get(t.nm_table).tm_call," ")}}const $=function(t,e,i,s){return{"btn-success":t,"btn-danger":e,"btn-secondary":i,"btn-dark":s}};function F(t,e){if(1&t){const t=o.Tb();o.Sb(0,"tr",15),o.Zb("click",function(){o.sc(t);const i=e.$implicit;return o.dc(2).selectTable(i)}),o.Sb(1,"td",16),o.Ac(2,I,1,0,"span",17),o.Ac(3,B,1,0,"span",18),o.Ac(4,j,1,0,"span",19),o.Ac(5,T,1,0,"span",20),o.Sb(6,"span",21),o.Bc(7),o.Rb(),o.Rb(),o.Sb(8,"td",22),o.Zb("click",function(){o.sc(t);const i=e.$implicit;return o.dc(2).selectTable(i)}),o.Bc(9),o.Rb(),o.Sb(10,"td",23),o.Ac(11,M,2,1,"span",5),o.Rb(),o.Sb(12,"td",23),o.Ac(13,N,1,0,"span",24),o.Ac(14,D,1,0,"span",25),o.Ac(15,C,1,0,"span",26),o.Ac(16,O,1,0,"span",27),o.Rb(),o.Sb(17,"td",23),o.Ac(18,q,2,1,"span",5),o.Rb(),o.Rb()}if(2&t){const t=e.$implicit,i=o.dc(2);o.jc("ngClass",o.pc(13,$,"idle"===t.tx_status,"busy"===t.tx_status,"paused"===t.tx_status,"reserved"===t.tx_status)),o.Ab(2),o.jc("ngIf","busy"===t.tx_status),o.Ab(1),o.jc("ngIf","paused"===t.tx_status),o.Ab(1),o.jc("ngIf","idle"===t.tx_status),o.Ab(1),o.jc("ngIf","reserved"===t.tx_status),o.Ab(2),o.Cc(t.nm_table),o.Ab(2),o.Dc(" ",null==t.id_session?null:t.id_session.id_ticket.id_position," "),o.Ab(2),o.jc("ngIf","busy"===t.tx_status&&i.busyTablesTimes.get(t.nm_table)),o.Ab(2),o.jc("ngIf",null===(null==t.id_session?null:t.id_session.id_ticket.tx_call)&&null!==(null==t.id_session?null:t.id_session.id_ticket.tm_provided)),o.Ab(1),o.jc("ngIf","card"===(null==t.id_session?null:t.id_session.id_ticket.tx_call)),o.Ab(1),o.jc("ngIf","waiter"===(null==t.id_session?null:t.id_session.id_ticket.tx_call)),o.Ab(1),o.jc("ngIf","account"===(null==t.id_session?null:t.id_session.id_ticket.tx_call)),o.Ab(2),o.jc("ngIf","busy"===t.tx_status&&i.busyTablesTimes.get(t.nm_table))}}function P(t,e){if(1&t){const t=o.Tb();o.Sb(0,"div",6),o.Sb(1,"div",7),o.Sb(2,"div",8),o.Bc(3),o.Rb(),o.Sb(4,"mat-radio-group",9),o.Zb("ngModelChange",function(e){return o.sc(t),o.dc().tableSelected=e}),o.Sb(5,"table",10),o.Sb(6,"tr",11),o.Sb(7,"td",12),o.Bc(8,"Mesa"),o.Rb(),o.Sb(9,"td",13),o.Bc(10,"Turno"),o.Rb(),o.Sb(11,"td",13),o.Bc(12,"Ocup."),o.Rb(),o.Sb(13,"td",13),o.Bc(14,"Acci\xf3n"),o.Rb(),o.Sb(15,"td",13),o.Bc(16,"Espera"),o.Rb(),o.Rb(),o.Ac(17,F,19,18,"tr",14),o.Rb(),o.Rb(),o.Rb(),o.Rb()}if(2&t){const t=o.dc();o.Ab(3),o.Dc(" Mesas del sector ",t.waiterService.session.id_section.tx_section," "),o.Ab(1),o.jc("ngModel",t.tableSelected),o.Ab(13),o.jc("ngForOf",t.tables)}}function Z(t,e){1&t&&o.Nb(0,"span",46)}function E(t,e){1&t&&o.Nb(0,"span",0)}function W(t,e){1&t&&o.Nb(0,"span",47)}function H(t,e){if(1&t&&(o.Sb(0,"span"),o.Ac(1,Z,1,0,"span",43),o.Ac(2,E,1,0,"span",44),o.Ac(3,W,1,0,"span",45),o.Rb()),2&t){const t=o.dc(2).$implicit;o.Ab(1),o.jc("ngIf","card"===(null==t.id_session?null:t.id_session.id_ticket.tx_call)),o.Ab(1),o.jc("ngIf","waiter"===(null==t.id_session?null:t.id_session.id_ticket.tx_call)),o.Ab(1),o.jc("ngIf","account"===(null==t.id_session?null:t.id_session.id_ticket.tx_call))}}function J(t,e){1&t&&o.Nb(0,"span",49)}function z(t,e){if(1&t&&(o.Sb(0,"span"),o.Ac(1,J,1,0,"span",48),o.Rb()),2&t){const t=o.dc(2).$implicit;o.Ab(1),o.jc("ngIf","busy"===t.tx_status)}}function G(t,e){if(1&t&&(o.Sb(0,"span"),o.Ac(1,H,4,3,"span",5),o.Ac(2,z,2,1,"span",5),o.Rb()),2&t){const t=o.dc().$implicit;o.Ab(1),o.jc("ngIf",null==t.id_session?null:t.id_session.id_ticket.tx_call),o.Ab(1),o.jc("ngIf",!(null!=t.id_session&&t.id_session.id_ticket.tx_call))}}function L(t,e){1&t&&o.Nb(0,"span",53)}function U(t,e){1&t&&o.Nb(0,"span",54)}function Q(t,e){1&t&&o.Nb(0,"span",55)}function V(t,e){if(1&t&&(o.Sb(0,"span"),o.Ac(1,L,1,0,"span",50),o.Ac(2,U,1,0,"span",51),o.Ac(3,Q,1,0,"span",52),o.Rb()),2&t){const t=o.dc().$implicit;o.Ab(1),o.jc("ngIf","paused"===t.tx_status),o.Ab(1),o.jc("ngIf","idle"===t.tx_status),o.Ab(1),o.jc("ngIf","reserved"===t.tx_status)}}function K(t,e){if(1&t){const t=o.Tb();o.Sb(0,"div",38),o.Sb(1,"div",39),o.Zb("click",function(){o.sc(t);const i=e.$implicit;return o.dc(2).selectTable(i)}),o.Sb(2,"table",40),o.Sb(3,"tr"),o.Sb(4,"td",41),o.Sb(5,"span",42),o.Bc(6),o.Rb(),o.Rb(),o.Sb(7,"td"),o.Ac(8,G,3,2,"span",5),o.Ac(9,V,4,3,"span",5),o.Rb(),o.Rb(),o.Rb(),o.Rb(),o.Rb()}if(2&t){const t=e.$implicit;o.Ab(1),o.jc("ngClass",o.pc(4,$,"idle"===t.tx_status,"busy"===t.tx_status,"paused"===t.tx_status,"reserved"===t.tx_status)),o.Ab(5),o.Cc(t.nm_table),o.Ab(2),o.jc("ngIf",t.id_session),o.Ab(1),o.jc("ngIf",!t.id_session)}}function Y(t,e){if(1&t&&(o.Sb(0,"div",36),o.Ac(1,K,10,9,"div",37),o.Rb()),2&t){const t=o.dc();o.Ab(1),o.jc("ngForOf",t.tables)}}function X(t,e){1&t&&(o.Sb(0,"span"),o.Bc(1," Ocupada "),o.Rb())}function tt(t,e){1&t&&(o.Sb(0,"span"),o.Bc(1," Pausada "),o.Rb())}function et(t,e){1&t&&(o.Sb(0,"span"),o.Bc(1," Esperando clientes "),o.Rb())}function it(t,e){1&t&&(o.Sb(0,"span"),o.Bc(1," Reservada "),o.Rb())}function st(t,e){if(1&t&&(o.Sb(0,"div"),o.Sb(1,"table",74),o.Sb(2,"tr"),o.Sb(3,"td",12),o.Bc(4,"Turno"),o.Rb(),o.Sb(5,"td",75),o.Bc(6),o.Rb(),o.Rb(),o.Sb(7,"tr"),o.Sb(8,"td",12),o.Bc(9,"Comensales"),o.Rb(),o.Sb(10,"td",75),o.Bc(11),o.Rb(),o.Rb(),o.Sb(12,"tr"),o.Sb(13,"td",12),o.Bc(14,"Prioridad"),o.Rb(),o.Sb(15,"td",75),o.Bc(16),o.Rb(),o.Rb(),o.Sb(17,"tr"),o.Sb(18,"td",12),o.Bc(19,"Provisi\xf3n"),o.Rb(),o.Sb(20,"td",75),o.Bc(21),o.Rb(),o.Rb(),o.Sb(22,"tr"),o.Sb(23,"td",12),o.Bc(24," Solicitud de asistencia "),o.Rb(),o.Sb(25,"td",75),o.Bc(26),o.Rb(),o.Rb(),o.Rb(),o.Rb()),2&t){const t=o.dc(2);o.Ab(6),o.Dc(" ",null==t.table||null==t.table.id_session?null:t.table.id_session.id_ticket.id_position," "),o.Ab(5),o.Dc(" ",null==t.table||null==t.table.id_session?null:t.table.id_session.id_ticket.nm_persons," "),o.Ab(5),o.Dc(" ",null==t.table||null==t.table.id_session?null:t.table.id_session.id_ticket.bl_priority," "),o.Ab(5),o.Dc(" ",t.busyTablesTimes.get(t.table.nm_table).tm_provided," "),o.Ab(5),o.Dc(" ",t.busyTablesTimes.get(t.table.nm_table).tm_call," ")}}const nt=function(t,e,i,s){return{"bg-success":t,"bg-danger":e,"bg-secondary":i,"bg-dark":s}},ct=function(t,e,i){return{"button-disabled":t,"btn-success":e,"btn-secondary":i}},at=function(t){return{"button-disabled":t}};function bt(t,e){if(1&t){const t=o.Tb();o.Sb(0,"div"),o.Sb(1,"div",56),o.Sb(2,"div",57),o.Bc(3),o.Ac(4,X,2,0,"span",5),o.Ac(5,tt,2,0,"span",5),o.Ac(6,et,2,0,"span",5),o.Ac(7,it,2,0,"span",5),o.Rb(),o.Sb(8,"div",58),o.Ac(9,st,27,5,"div",5),o.Nb(10,"hr"),o.Sb(11,"div",59),o.Sb(12,"div",60),o.Sb(13,"button",61),o.Sb(14,"table",40),o.Sb(15,"tr"),o.Sb(16,"td",62),o.Nb(17,"span",63),o.Rb(),o.Sb(18,"td",64),o.Sb(19,"mat-slide-toggle",65),o.Zb("click",function(){o.sc(t);const e=o.dc();return e.toggleTableStatus(e.table)}),o.Rb(),o.Rb(),o.Rb(),o.Rb(),o.Rb(),o.Rb(),o.Sb(20,"div",60),o.Sb(21,"button",61),o.Sb(22,"table",40),o.Sb(23,"tr"),o.Sb(24,"td",62),o.Nb(25,"span",66),o.Rb(),o.Sb(26,"td",64),o.Sb(27,"mat-slide-toggle",67),o.Zb("ngModelChange",function(e){return o.sc(t),o.dc().blPriority=e}),o.Rb(),o.Rb(),o.Rb(),o.Rb(),o.Rb(),o.Rb(),o.Sb(28,"div",60),o.Sb(29,"button",68),o.Zb("click",function(){o.sc(t);const e=o.dc();return e.reassignTicket(null==e.table.id_session?null:e.table.id_session.id_ticket)}),o.Sb(30,"table",40),o.Sb(31,"tr"),o.Sb(32,"td",62),o.Nb(33,"span",69),o.Rb(),o.Sb(34,"td",64),o.Bc(35,"Mover"),o.Rb(),o.Rb(),o.Rb(),o.Rb(),o.Rb(),o.Sb(36,"div",60),o.Sb(37,"button",68),o.Zb("click",function(){o.sc(t);const e=o.dc();return e.attendedTicket(null==e.table.id_session?null:e.table.id_session.id_ticket)}),o.Sb(38,"table",40),o.Sb(39,"tr"),o.Sb(40,"td",62),o.Nb(41,"span",70),o.Rb(),o.Sb(42,"td",64),o.Bc(43,"Atendido"),o.Rb(),o.Rb(),o.Rb(),o.Rb(),o.Rb(),o.Sb(44,"div",60),o.Sb(45,"button",68),o.Zb("click",function(){o.sc(t);const e=o.dc();return e.releaseTicket(null==e.table.id_session?null:e.table.id_session.id_ticket)}),o.Sb(46,"table",40),o.Sb(47,"tr"),o.Sb(48,"td",62),o.Nb(49,"span",71),o.Rb(),o.Sb(50,"td",64),o.Bc(51,"Soltar"),o.Rb(),o.Rb(),o.Rb(),o.Rb(),o.Rb(),o.Sb(52,"div",60),o.Sb(53,"button",72),o.Zb("click",function(){o.sc(t);const e=o.dc();return e.endTicket(null==e.table.id_session?null:e.table.id_session.id_ticket)}),o.Sb(54,"table",40),o.Sb(55,"tr"),o.Sb(56,"td",62),o.Nb(57,"span",73),o.Rb(),o.Sb(58,"td",64),o.Bc(59,"Finalizar"),o.Rb(),o.Rb(),o.Rb(),o.Rb(),o.Rb(),o.Rb(),o.Rb(),o.Rb(),o.Rb()}if(2&t){const t=o.dc();o.Ab(2),o.jc("ngClass",o.pc(23,nt,"idle"===t.table.tx_status,"busy"===t.table.tx_status,"paused"===t.table.tx_status,"reserved"===t.table.tx_status)),o.Ab(1),o.Dc(" Mesa ",t.table.nm_table,": "),o.Ab(1),o.jc("ngIf","busy"===t.table.tx_status),o.Ab(1),o.jc("ngIf","paused"===t.table.tx_status),o.Ab(1),o.jc("ngIf","idle"===t.table.tx_status),o.Ab(1),o.jc("ngIf","reserved"===t.table.tx_status),o.Ab(2),o.jc("ngIf",null==t.table?null:t.table.id_session),o.Ab(4),o.jc("ngClass",o.oc(28,ct,"busy"===t.table.tx_status,"idle"===t.table.tx_status,"paused"===t.table.tx_status))("disabled","busy"===t.table.tx_status),o.Ab(6),o.jc("checked","paused"!==t.table.tx_status)("disabled","busy"===t.table.tx_status),o.Ab(2),o.jc("ngClass",o.mc(32,at,!t.table.id_session||""===t.waiterService.sectionSelected))("disabled",!t.table.id_session||""===t.waiterService.sectionSelected),o.Ab(6),o.jc("ngModel",t.blPriority)("disabled",!t.table.id_session||""===t.waiterService.sectionSelected),o.Ab(2),o.jc("disabled",!t.table.id_session||""===t.waiterService.sectionSelected)("ngClass",o.mc(34,at,!t.table.id_session||""===t.waiterService.sectionSelected)),o.Ab(8),o.jc("disabled",!(null!=t.table.id_session&&t.table.id_session.id_ticket.tx_call)||"busy"!==t.table.tx_status)("ngClass",o.mc(36,at,!(null!=t.table.id_session&&t.table.id_session.id_ticket.tx_call)||"busy"!==t.table.tx_status)),o.Ab(8),o.jc("disabled","busy"!==t.table.tx_status)("ngClass",o.mc(38,at,"busy"!==t.table.tx_status)),o.Ab(8),o.jc("disabled","busy"!==t.table.tx_status)("ngClass",o.mc(40,at,"busy"!==t.table.tx_status))}}let lt=(()=>{class t{constructor(t,e,i,s){this.loginService=t,this.waiterService=e,this.sharedService=i,this.intervalToHmsPipe=s,this.tables=[],this.tickets=[],this.listmode=!1,this.tableSelected="",this.blPriority=!1,this.selectTable=t=>{this.table=t},this.toggleTableStatus=t=>{"busy"!==t.tx_status&&this.waiterService.toggleTableStatus(t._id).subscribe(e=>{e.ok?(this.tables.filter(t=>t._id===e.table._id)[0].tx_status=e.table.tx_status,t.tx_status=e.table.tx_status):this.sharedService.snack(e.msg,2e3)})},this.releaseTicket=t=>{t?this.sharedService.snack("Desea soltar el ticket y devolverlo a su estado anterior?",5e3,"ACEPTAR").then(e=>{e&&this.waiterService.releaseTicket(t).subscribe(e=>{e.ok&&(this.tickets=this.tickets.filter(t=>t._id!=t._id),this.clearTicketSession(t))})}):this.sharedService.snack("Error. No hay clientes en esta mesa.",5e3)},this.reassignTicket=t=>{t?this.sharedService.snack("Desea enviar el ticket al skill seleccionado?",5e3,"ACEPTAR").then(e=>{if(e){let e=t._id,i=this.waiterService.sectionSelected,s=this.blPriority;e&&i&&this.waiterService.reassignTicket(e,i,s).subscribe(e=>{e.ok&&(this.blPriority=!1,this.clearTicketSession(t))})}}):this.sharedService.snack("Error. No hay clientes en esta mesa.",5e3)},this.endTicket=t=>{t||this.sharedService.snack("Seleccione una mesa primero",3e3);let e=t._id;this.tickets&&this.sharedService.snack("Desea finalizar el ticket actual?",5e3,"ACEPTAR").then(i=>{i&&this.waiterService.endTicket(e).subscribe(e=>{e.ok&&(this.clearTicketSession(t),this.clearTableSession(t))})})},this.attendedTicket=t=>{this.waiterService.attendedTicket(t).subscribe(t=>{t.ok&&(this.tables.filter(e=>{var i;return(null===(i=e.id_session)||void 0===i?void 0:i.id_ticket._id)===t.ticket._id})[0].id_session.id_ticket.tx_call=null)})},this.setListMode=()=>{if(localStorage.getItem("config")){let t=JSON.parse(localStorage.getItem("config"));t.listmode=!this.listmode,localStorage.setItem("config",JSON.stringify(t))}else localStorage.setItem("config",JSON.stringify({listmode:!0}))},this.clearTicketSession=t=>{this.tickets=this.tickets.filter(e=>e._id!==t._id)},this.clearTableSession=t=>{let e=this.tables.filter(e=>{var i;return(null===(i=e.id_session)||void 0===i?void 0:i.id_ticket._id)===t._id})[0];e.tx_status="paused",e.id_session=null}}ngOnInit(){let t=JSON.parse(localStorage.getItem("config"));this.listmode=!!t&&t.listmode}}return t.\u0275fac=function(e){return new(e||t)(o.Mb(d.a),o.Mb(u.a),o.Mb(m.a),o.Mb(f))},t.\u0275cmp=o.Gb({type:t,selectors:[["app-tables"]],inputs:{tables:"tables",tickets:"tickets",busyTablesTimes:"busyTablesTimes"},decls:11,vars:5,consts:[[1,"xl","mdi","mdi-silverware-fork-knife","text-warning"],[1,"sidenav-title-text","mx-2"],[1,"example-margin",3,"ngModel","ngModelChange","click"],["class","card bg-secondary mb-3",4,"ngIf"],["class","container row px-0 mb-4",4,"ngIf"],[4,"ngIf"],[1,"card","bg-secondary","mb-3"],[1,"card-body","table-responsive-sm","p-2"],[1,"text-white","m-3"],[3,"ngModel","ngModelChange"],[1,"table","table-sm","text-white","text-center"],[2,"border-top","0px","color","yellow"],[2,"text-align","left","border","none"],[2,"text-align","center","border","none"],["class","pointer rounded",3,"ngClass","click",4,"ngFor","ngForOf"],[1,"pointer","rounded",3,"ngClass","click"],[2,"padding","0.2rem","text-align","left"],["class","mdi mdi-minus-circle-outline",4,"ngIf"],["class","mdi mdi-pause-circle-outline",4,"ngIf"],["class","mdi mdi-check-circle-outline",4,"ngIf"],["class","mdi mdi-stop-circle-outline",4,"ngIf"],[1,"ml-2"],[2,"padding","0.2rem","text-align","center",3,"click"],[2,"padding","0.2rem","text-align","center"],["class","lg mdi mdi-thumb-up-outline text-warning",4,"ngIf"],["class","lg mdi mdi-book-open-variant text-warning",4,"ngIf"],["class","lg mdi mdi-silverware-fork-knife text-warning",4,"ngIf"],["class","lg mdi mdi-file-document-edit-outline text-warning",4,"ngIf"],[1,"mdi","mdi-minus-circle-outline"],[1,"mdi","mdi-pause-circle-outline"],[1,"mdi","mdi-check-circle-outline"],[1,"mdi","mdi-stop-circle-outline"],[1,"lg","mdi","mdi-thumb-up-outline","text-warning"],[1,"lg","mdi","mdi-book-open-variant","text-warning"],[1,"lg","mdi","mdi-silverware-fork-knife","text-warning"],[1,"lg","mdi","mdi-file-document-edit-outline","text-warning"],[1,"container","row","px-0","mb-4"],["class","col-4 px-0 p-1",4,"ngFor","ngForOf"],[1,"col-4","px-0","p-1"],[1,"btn","btn-block","p-0",3,"ngClass","click"],["width","100%",1,"shadow-minicard"],[1,"rounded-left",2,"background-color","rgba(50, 50, 50, 0.3)"],[1,"xl"],["class","xl mdi mdi-book-open-variant text-warning",4,"ngIf"],["class","xl mdi mdi-silverware-fork-knife text-warning",4,"ngIf"],["class","xl mdi mdi-file-document-edit-outline text-warning",4,"ngIf"],[1,"xl","mdi","mdi-book-open-variant","text-warning"],[1,"xl","mdi","mdi-file-document-edit-outline","text-warning"],["class","xl mdi mdi-minus-circle-outline text-white","style","opacity: 0.8",4,"ngIf"],[1,"xl","mdi","mdi-minus-circle-outline","text-white",2,"opacity","0.8"],["class","xl mdi mdi-pause-circle-outline text-white","style","opacity: 0.8",4,"ngIf"],["class","xl mdi mdi-check-circle-outline text-white","style","opacity: 0.8",4,"ngIf"],["class","xl mdi mdi-stop-circle-outline text-white","style","opacity: 0.8",4,"ngIf"],[1,"xl","mdi","mdi-pause-circle-outline","text-white",2,"opacity","0.8"],[1,"xl","mdi","mdi-check-circle-outline","text-white",2,"opacity","0.8"],[1,"xl","mdi","mdi-stop-circle-outline","text-white",2,"opacity","0.8"],[1,"card","bg-light"],[1,"text-white","card-header",3,"ngClass"],[1,"card-body"],[1,"container","row","px-0"],[1,"col-6","col-sm-6","col-md-4","p-1"],[1,"btn","btn-block","p-0",3,"ngClass","disabled"],[1,"rounded-left","px-1",2,"background-color","rgba(50, 50, 50, 0.3)"],[1,"mdi","mdi-power","xl"],["width","100%"],[2,"color","tomato",3,"checked","disabled","click"],[1,"mdi","mdi-priority-high","xl"],[3,"ngModel","disabled","ngModelChange"],[1,"btn","btn-primary","btn-block","p-0",3,"disabled","ngClass","click"],[1,"mdi","mdi-arrow-right-bold-circle-outline","xl"],[1,"mdi","mdi-bell","xl"],[1,"mdi","mdi-replay","xl"],[1,"btn","btn-danger","btn-block","p-0",3,"disabled","ngClass","click"],[1,"mdi","mdi-close","xl"],[1,"table","table-sm","text-center"],[2,"text-align","right","border","none"]],template:function(t,e){1&t&&(o.Sb(0,"mat-expansion-panel"),o.Sb(1,"mat-expansion-panel-header"),o.Sb(2,"mat-panel-title"),o.Nb(3,"span",0),o.Sb(4,"span",1),o.Bc(5),o.Rb(),o.Rb(),o.Rb(),o.Sb(6,"mat-checkbox",2),o.Zb("ngModelChange",function(t){return e.listmode=t})("click",function(){return e.setListMode()}),o.Bc(7,"Modo Lista"),o.Rb(),o.Ac(8,P,18,3,"div",3),o.Ac(9,Y,2,1,"div",4),o.Ac(10,bt,60,42,"div",5),o.Rb()),2&t&&(o.Ab(5),o.Dc("Mesas (",e.tables.length,")"),o.Ab(1),o.jc("ngModel",e.listmode),o.Ab(2),o.jc("ngIf",e.listmode),o.Ab(1),o.jc("ngIf",!e.listmode),o.Ab(1),o.jc("ngIf",e.table))},directives:[_.c,_.d,_.e,w.a,n.o,n.r,s.j,v.a,s.i,s.h,y.a],styles:[""]}),t})();function rt(t,e){1&t&&(o.Sb(0,"div",4),o.Bc(1," No hay requerimientos de mesas especiales "),o.Rb())}function ot(t,e){1&t&&(o.Sb(0,"div"),o.Nb(1,"span",23),o.Rb())}function dt(t,e){1&t&&(o.Sb(0,"div"),o.Nb(1,"span",24),o.Rb())}function ut(t,e){1&t&&o.Nb(0,"span",31)}function mt(t,e){if(1&t&&(o.Sb(0,"span",32),o.Bc(1),o.Rb()),2&t){const t=o.dc().$implicit;o.Ab(1),o.Cc(t.nm_persons)}}const gt=function(t,e){return{"btn-success":t,"btn-secondary":e}};function St(t,e){if(1&t){const t=o.Tb();o.Sb(0,"div",25),o.Sb(1,"div",26),o.Zb("click",function(){o.sc(t);const i=e.$implicit,s=o.dc().$implicit;return o.dc(2).setReserve(i,s)}),o.Sb(2,"table",16),o.Sb(3,"tr"),o.Sb(4,"td",27),o.Sb(5,"span",28),o.Bc(6),o.Rb(),o.Rb(),o.Sb(7,"td"),o.Ac(8,ut,1,0,"span",29),o.Ac(9,mt,2,1,"span",30),o.Rb(),o.Rb(),o.Rb(),o.Rb(),o.Rb()}if(2&t){const t=e.$implicit,i=o.dc().$implicit;o.Ab(1),o.jc("ngClass",o.nc(4,gt,i.cd_tables.includes(t.nm_table),!i.cd_tables.includes(t.nm_table))),o.Ab(5),o.Cc(t.nm_table),o.Ab(2),o.jc("ngIf",i.cd_tables.includes(t.nm_table)),o.Ab(1),o.jc("ngIf",!i.cd_tables.includes(t.nm_table))}}function pt(t,e){if(1&t){const t=o.Tb();o.Sb(0,"mat-expansion-panel",7),o.Sb(1,"mat-expansion-panel-header"),o.Sb(2,"mat-panel-title"),o.Ac(3,ot,2,0,"div",8),o.Ac(4,dt,2,0,"div",8),o.Bc(5),o.Rb(),o.Rb(),o.Sb(6,"div",9),o.Sb(7,"div",10),o.Sb(8,"div",11),o.Bc(9),o.Rb(),o.Rb(),o.Ac(10,St,10,7,"div",12),o.Rb(),o.Sb(11,"div",13),o.Sb(12,"div",14),o.Sb(13,"button",15),o.Zb("click",function(){o.sc(t);const i=e.$implicit,s=o.dc(2);return s.assignTables(i,s.assignWithPriority)}),o.Sb(14,"table",16),o.Sb(15,"tr"),o.Sb(16,"td",17),o.Nb(17,"span",18),o.Rb(),o.Sb(18,"td",19),o.Bc(19," Asignar "),o.Rb(),o.Rb(),o.Rb(),o.Rb(),o.Rb(),o.Sb(20,"div",14),o.Sb(21,"button",20),o.Sb(22,"table",16),o.Sb(23,"tr"),o.Sb(24,"td",17),o.Nb(25,"span",21),o.Rb(),o.Sb(26,"td",19),o.Sb(27,"mat-slide-toggle",22),o.Zb("ngModelChange",function(e){return o.sc(t),o.dc(2).assignWithPriority=e}),o.Rb(),o.Rb(),o.Rb(),o.Rb(),o.Rb(),o.Rb(),o.Rb(),o.Rb()}if(2&t){const t=e.$implicit,i=o.dc(2);o.Ab(3),o.jc("ngIf",t.cd_tables.length>0),o.Ab(1),o.jc("ngIf",0==t.cd_tables.length),o.Ab(1),o.Ec(" Turno ",t.id_position,": mesa para ",t.nm_persons," "),o.Ab(4),o.Dc(" Por favor seleccion\xe1 las mesas necesarias para aprovisionar este pedido para ",t.nm_persons," personas. "),o.Ab(1),o.jc("ngForOf",i.tables),o.Ab(17),o.jc("ngModel",i.assignWithPriority)}}function ft(t,e){if(1&t&&(o.Sb(0,"mat-accordion",5),o.Ac(1,pt,28,7,"mat-expansion-panel",6),o.Rb()),2&t){const t=o.dc();o.Ab(1),o.jc("ngForOf",t.requested)}}let ht=(()=>{class t{constructor(t,e){this.sharedService=t,this.waiterService=e,this.assignWithPriority=!1,this.setReserve=(t,e)=>{e.cd_tables=e.cd_tables.includes(t.nm_table)?e.cd_tables.filter(e=>e!==t.nm_table):[...e.cd_tables,t.nm_table]},this.assignTables=(t,e)=>{this.waiterService.assignTables(t._id,t.cd_tables,e).subscribe(t=>{this.sharedService.snack(t.ok?"Las mesas fueron reservadas con exito!":"Error al reservar las mesas!",2e3)},()=>{this.sharedService.snack("Error al reservar las mesas!",2e3)})}}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)(o.Mb(m.a),o.Mb(u.a))},t.\u0275cmp=o.Gb({type:t,selectors:[["app-requested"]],inputs:{requested:"requested",tables:"tables"},decls:8,vars:3,consts:[[1,"xl","mdi","mdi-alert-box","text-danger"],[1,"sidenav-title-text","mx-2"],["class","text-dark",4,"ngIf"],["multi","false",4,"ngIf"],[1,"text-dark"],["multi","false"],["class","noshadow",4,"ngFor","ngForOf"],[1,"noshadow"],[4,"ngIf"],[1,"container","row","px-0","mb-4"],[1,"card","bg-danger","text-white","mb-3"],[1,"card-body","p-1"],["class","col-4 px-0 p-1",4,"ngFor","ngForOf"],[1,"container","row"],[1,"col"],[1,"btn","btn-primary","btn-block","p-0",3,"click"],["width","100%",1,"shadow-minicard"],[1,"rounded-left","px-1",2,"background-color","rgba(50, 50, 50, 0.3)"],[1,"mdi","mdi-hand-pointing-right","xl"],["width","100%"],[1,"btn","btn-info","btn-block","p-0"],[1,"mdi","mdi-priority-high","xl"],[3,"ngModel","ngModelChange"],[1,"text-success","xl","mr-2","mdi","mdi-checkbox-marked"],[1,"text-danger","xl","mr-2","mdi","mdi-help-box"],[1,"col-4","px-0","p-1"],[1,"btn","btn-block","p-0",3,"ngClass","click"],[1,"rounded-left",2,"background-color","rgba(50, 50, 50, 0.3)"],[1,"xl"],["class","xl mdi mdi-check-circle text-white",4,"ngIf"],["class","lg mdi mdi-human-male text-warning",4,"ngIf"],[1,"xl","mdi","mdi-check-circle","text-white"],[1,"lg","mdi","mdi-human-male","text-warning"]],template:function(t,e){1&t&&(o.Sb(0,"mat-expansion-panel"),o.Sb(1,"mat-expansion-panel-header"),o.Sb(2,"mat-panel-title"),o.Nb(3,"span",0),o.Sb(4,"span",1),o.Bc(5),o.Rb(),o.Rb(),o.Rb(),o.Ac(6,rt,2,0,"div",2),o.Ac(7,ft,2,1,"mat-accordion",3),o.Rb()),2&t&&(o.Ab(5),o.Dc("Requeridos (",e.requested.length,") "),o.Ab(1),o.jc("ngIf",0==e.requested.length),o.Ab(1),o.jc("ngIf",e.requested.length>0))},directives:[_.c,_.d,_.e,s.j,_.a,s.i,y.a,n.o,n.r,s.h],styles:[""]}),t})();function _t(t,e){1&t&&(o.Sb(0,"div",4),o.Bc(1," No hay clientes esperando mesa "),o.Rb())}function vt(t,e){1&t&&(o.Sb(0,"div"),o.Nb(1,"span",21),o.Rb())}function Rt(t,e){1&t&&(o.Sb(0,"div"),o.Nb(1,"span",22),o.Rb())}function xt(t,e){1&t&&o.Nb(0,"span",29)}function kt(t,e){if(1&t&&(o.Sb(0,"span",30),o.Bc(1),o.Rb()),2&t){const t=o.dc().$implicit;o.Ab(1),o.Cc(t.nm_persons)}}const At=function(t,e){return{"btn-success":t,"btn-secondary":e}};function wt(t,e){if(1&t){const t=o.Tb();o.Sb(0,"div",23),o.Sb(1,"div",24),o.Zb("click",function(){o.sc(t);const i=e.$implicit,s=o.dc().$implicit;return o.dc(2).setReserve(i,s)}),o.Sb(2,"table",14),o.Sb(3,"tr"),o.Sb(4,"td",25),o.Sb(5,"span",26),o.Bc(6),o.Rb(),o.Rb(),o.Sb(7,"td"),o.Ac(8,xt,1,0,"span",27),o.Ac(9,kt,2,1,"span",28),o.Rb(),o.Rb(),o.Rb(),o.Rb(),o.Rb()}if(2&t){const t=e.$implicit,i=o.dc().$implicit;o.Ab(1),o.jc("ngClass",o.nc(4,At,i.cd_tables.includes(t.nm_table),!i.cd_tables.includes(t.nm_table))),o.Ab(5),o.Cc(t.nm_table),o.Ab(2),o.jc("ngIf",i.cd_tables.includes(t.nm_table)),o.Ab(1),o.jc("ngIf",!i.cd_tables.includes(t.nm_table))}}function yt(t,e){if(1&t){const t=o.Tb();o.Sb(0,"mat-expansion-panel",7),o.Sb(1,"mat-expansion-panel-header"),o.Sb(2,"mat-panel-title"),o.Ac(3,vt,2,0,"div",8),o.Ac(4,Rt,2,0,"div",8),o.Bc(5),o.Rb(),o.Rb(),o.Sb(6,"div",9),o.Ac(7,wt,10,7,"div",10),o.Rb(),o.Sb(8,"div",11),o.Sb(9,"div",12),o.Sb(10,"button",13),o.Zb("click",function(){o.sc(t);const i=e.$implicit,s=o.dc(2);return s.assignTables(i,s.assignWithPriority)}),o.Sb(11,"table",14),o.Sb(12,"tr"),o.Sb(13,"td",15),o.Nb(14,"span",16),o.Rb(),o.Sb(15,"td",17),o.Bc(16," Asignar "),o.Rb(),o.Rb(),o.Rb(),o.Rb(),o.Rb(),o.Sb(17,"div",12),o.Sb(18,"button",18),o.Sb(19,"table",14),o.Sb(20,"tr"),o.Sb(21,"td",15),o.Nb(22,"span",19),o.Rb(),o.Sb(23,"td",17),o.Sb(24,"mat-slide-toggle",20),o.Zb("ngModelChange",function(e){return o.sc(t),o.dc(2).assignWithPriority=e}),o.Rb(),o.Rb(),o.Rb(),o.Rb(),o.Rb(),o.Rb(),o.Rb(),o.Rb()}if(2&t){const t=e.$implicit,i=o.dc(2);o.Ab(3),o.jc("ngIf",t.cd_tables.length>0),o.Ab(1),o.jc("ngIf",0==t.cd_tables.length),o.Ab(1),o.Ec(" Turno ",t.id_position,": mesa para ",t.nm_persons," "),o.Ab(2),o.jc("ngForOf",i.tables),o.Ab(17),o.jc("ngModel",i.assignWithPriority)}}function It(t,e){if(1&t&&(o.Sb(0,"mat-accordion",5),o.Ac(1,yt,25,6,"mat-expansion-panel",6),o.Rb()),2&t){const t=o.dc();o.Ab(1),o.jc("ngForOf",t.queued)}}let Bt=(()=>{class t{constructor(t,e){this.sharedService=t,this.waiterService=e,this.setReserve=(t,e)=>{e.cd_tables=e.cd_tables.includes(t.nm_table)?e.cd_tables.filter(e=>e!==t.nm_table):[...e.cd_tables,t.nm_table]},this.assignTables=(t,e)=>{this.waiterService.assignTables(t._id,t.cd_tables,e).subscribe(t=>{this.sharedService.snack(t.ok?"Las mesas fueron reservadas con exito!":"Error al reservar las mesas!",2e3)},()=>{this.sharedService.snack("Error al reservar las mesas!",2e3)})}}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)(o.Mb(m.a),o.Mb(u.a))},t.\u0275cmp=o.Gb({type:t,selectors:[["app-queued"]],inputs:{queued:"queued",tables:"tables"},decls:8,vars:3,consts:[[1,"xl","mdi","mdi-format-list-numbered","text-primary"],[1,"sidenav-title-text","mx-2"],["class","text-dark",4,"ngIf"],["multi","false",4,"ngIf"],[1,"text-dark"],["multi","false"],["class","noshadow",4,"ngFor","ngForOf"],[1,"noshadow"],[4,"ngIf"],[1,"container","row","px-0","mb-4"],["class","col-4 px-0 p-1",4,"ngFor","ngForOf"],[1,"container","row"],[1,"col"],[1,"btn","btn-primary","btn-block","p-0",3,"click"],["width","100%",1,"shadow-minicard"],[1,"rounded-left","px-1",2,"background-color","rgba(50, 50, 50, 0.3)"],[1,"mdi","mdi-hand-pointing-right","xl"],["width","100%"],[1,"btn","btn-info","btn-block","p-0"],[1,"mdi","mdi-priority-high","xl"],[3,"ngModel","ngModelChange"],[1,"text-success","xl","mr-2","mdi","mdi-checkbox-marked"],[1,"text-danger","xl","mr-2","mdi","mdi-alert-box"],[1,"col-4","px-0","p-1"],[1,"btn","btn-block","p-0",3,"ngClass","click"],[1,"rounded-left",2,"background-color","rgba(50, 50, 50, 0.3)"],[1,"xl"],["class","xl mdi mdi-check-circle text-white",4,"ngIf"],["class","lg mdi mdi-human-male text-warning",4,"ngIf"],[1,"xl","mdi","mdi-check-circle","text-white"],[1,"lg","mdi","mdi-human-male","text-warning"]],template:function(t,e){1&t&&(o.Sb(0,"mat-expansion-panel"),o.Sb(1,"mat-expansion-panel-header"),o.Sb(2,"mat-panel-title"),o.Nb(3,"span",0),o.Sb(4,"span",1),o.Bc(5),o.Rb(),o.Rb(),o.Rb(),o.Ac(6,_t,2,0,"div",2),o.Ac(7,It,2,1,"mat-accordion",3),o.Rb()),2&t&&(o.Ab(5),o.Dc("Cola (",e.queued.length,")"),o.Ab(1),o.jc("ngIf",0==e.queued.length),o.Ab(1),o.jc("ngIf",e.queued.length>0))},directives:[_.c,_.d,_.e,s.j,_.a,s.i,y.a,n.o,n.r,s.h],styles:[""]}),t})();function jt(t,e){1&t&&(o.Sb(0,"div",4),o.Nb(1,"mat-spinner"),o.Rb())}function Tt(t,e){if(1&t){const t=o.Tb();o.Sb(0,"div",5),o.Sb(1,"div",6),o.Bc(2),o.Rb(),o.Sb(3,"div",7),o.Sb(4,"button",8),o.Zb("click",function(){return o.sc(t),o.dc(2).releaseSection()}),o.Sb(5,"table",9),o.Sb(6,"tr"),o.Sb(7,"td",10),o.Nb(8,"div",11),o.Rb(),o.Sb(9,"td"),o.Bc(10,"Salir"),o.Rb(),o.Rb(),o.Rb(),o.Rb(),o.Rb(),o.Sb(11,"div"),o.Sb(12,"mat-accordion",12),o.Nb(13,"app-sections",13),o.Nb(14,"app-tables",14),o.Nb(15,"app-requested",15),o.Nb(16,"app-queued",16),o.Rb(),o.Rb(),o.Rb()}if(2&t){const t=o.dc(2);o.Ab(2),o.Dc(" - ",t.waiterService.session.id_section.tx_section," - "),o.Ab(11),o.jc("ticketsDataBySection",t.ticketsDataBySection)("tablesDataBySection",t.tablesDataBySection),o.Ab(1),o.jc("tables",t.tables)("busyTablesTimes",t.busyTablesTimes),o.Ab(1),o.jc("tables",t.tables)("requested",t.requested),o.Ab(1),o.jc("tables",t.tables)("queued",t.queued)}}function Mt(t,e){if(1&t&&(o.Sb(0,"div",1),o.Ac(1,jt,2,0,"div",2),o.Ac(2,Tt,17,9,"div",3),o.Rb()),2&t){const t=o.dc();o.Ab(1),o.jc("ngIf",t.loading),o.Ab(1),o.jc("ngIf",!t.loading)}}let Nt=(()=>{class t{constructor(t,e,i,s,n,c){this.loginService=t,this.waiterService=e,this.sharedService=i,this.wsService=s,this.router=n,this.intervalToHmsPipe=c,this.loading=!1,this.ticketsDataBySection=new Map,this.tablesDataBySection=new Map,this.busyTablesTimes=new Map,this.tickets=[],this.tables=[],this.requested=[],this.queued=[],this.subjectUpdateWaiters$=new l.a,this.readTables=()=>new Promise((t,e)=>{this.waiterService.readTables(this.loginService.user.id_company._id).subscribe(i=>{if(i.ok){this.tables=i.tables.filter(t=>t.id_section===this.waiterService.session.id_section._id);for(let t of this.waiterService.sections)this.tablesDataBySection.set(t.tx_section,{id:t._id,sectionselected:this.waiterService.session.id_section._id===t._id,busy:i.tables.filter(e=>e.id_section===t._id&&"busy"===e.tx_status).length,idle:i.tables.filter(e=>e.id_section===t._id&&"idle"===e.tx_status).length,paused:i.tables.filter(e=>e.id_section===t._id&&"paused"===e.tx_status).length});Object(r.a)(1e3).subscribe(()=>{for(let t of this.tables.filter(t=>{var e;return t.id_section===(null===(e=this.waiterService.session)||void 0===e?void 0:e.id_section._id)&&"busy"===t.tx_status}))t.id_session&&this.busyTablesTimes.set(t.nm_table,{tm_provided:this.intervalToHmsPipe.transform(t.id_session.id_ticket.tm_provided),tm_call:this.intervalToHmsPipe.transform(t.id_session.id_ticket.tm_call)})}),localStorage.setItem("tables",JSON.stringify(i.tables)),t()}else e([])},()=>{localStorage.getItem("tables")&&localStorage.removeItem("tables"),e([])})}),this.readTickets=()=>new Promise(t=>{var e;let i=null===(e=this.loginService.user.id_company)||void 0===e?void 0:e._id;return this.waiterService.readTickets(i).subscribe(e=>{this.tickets=e.tickets,this.requested=this.tickets.filter(t=>t.id_section._id===this.waiterService.session.id_section._id&&null===t.tm_end&&"requested"===t.tx_status),this.queued=this.tickets.filter(t=>t.id_section._id===this.waiterService.session.id_section._id&&null===t.tm_end&&"queued"===t.tx_status);for(let t of this.waiterService.sections)this.ticketsDataBySection.set(t.tx_section,{id:t._id,sectionselected:this.waiterService.session.id_section._id===t._id,queued:e.tickets.filter(e=>e.id_section._id===t._id&&null===e.tm_end&&("queued"===e.tx_status||"assigned"===e.tx_status)).length,requested:e.tickets.filter(e=>e.id_section._id===t._id&&null===e.tm_end&&"requested"===e.tx_status).length});t(e.tickets),this.loading=!1})}),this.releaseSection=()=>{this.waiterService.releaseSection(this.waiterService.session.id_section._id,this.loginService.user._id).subscribe(t=>{t.ok&&(this.waiterService.clearSectionSession(),this.router.navigate(["waiter/home"]))})},this.ngOnDestroy=()=>{this.subjectUpdateWaiters$.complete()}}onClick(t){}ngOnInit(){return Object(b.a)(this,void 0,void 0,function*(){this.waiterService.session?(this.loading=!0,yield this.readTables(),yield this.readTickets(),this.wsService.updateWaiters().subscribe(this.subjectUpdateWaiters$),this.subjectUpdateWaiters$.subscribe(()=>Object(b.a)(this,void 0,void 0,function*(){yield this.readTables(),yield this.readTickets()})),this.loading=!1):this.router.navigate(["/waiter/home"])})}}return t.\u0275fac=function(e){return new(e||t)(o.Mb(d.a),o.Mb(u.a),o.Mb(m.a),o.Mb(g.a),o.Mb(c.b),o.Mb(f))},t.\u0275cmp=o.Gb({type:t,selectors:[["app-section"]],hostBindings:function(t,e){1&t&&o.Zb("click",function(t){return e.onClick(t)})},decls:1,vars:1,consts:[["class","saturno-card animated fadeIn",4,"ngIf"],[1,"saturno-card","animated","fadeIn"],["class","mt-5 animated fadeIn",4,"ngIf"],["class","animated fadeIn",4,"ngIf"],[1,"mt-5","animated","fadeIn"],[1,"animated","fadeIn"],[1,"text-dark","text-uppercase","my-2","p-2"],[1,"my-4"],[1,"btn","btn-danger","p-0","col-4",3,"click"],["width","100%",1,"shadow-minicard"],[1,"rounded-left",2,"background-color","rgba(50, 50, 50, 0.3)"],[1,"mdi","mdi-power","xl"],["multi","true"],[3,"ticketsDataBySection","tablesDataBySection"],[3,"tables","busyTablesTimes"],[3,"tables","requested"],[3,"tables","queued"]],template:function(t,e){1&t&&o.Ac(0,Mt,3,2,"div",0),2&t&&o.jc("ngIf",e.waiterService.session)},directives:[s.j,h.b,_.a,A,lt,ht,Bt],styles:[".company-title[_ngcontent-%COMP%]{font-weight:300;letter-spacing:.2em;text-transform:uppercase;color:#f5f5f5}.saturno-bg-dark[_ngcontent-%COMP%]{background-color:#3a3a3a}"]}),t})();var Dt=i("zHaW"),Ct=i("Q2Ze"),Ot=i("ZTz/"),qt=i("UhP/");function $t(t,e){1&t&&(o.Sb(0,"div",4),o.Nb(1,"mat-spinner"),o.Rb())}function Ft(t,e){1&t&&(o.Sb(0,"div",17),o.Bc(1," No ten\xe9s asignada ning\xfana empresa. Ten\xe9s seleccionarla desde el men\xfa prinicipal. "),o.Rb())}function Pt(t,e){1&t&&(o.Sb(0,"div",17),o.Bc(1," No hay mesas creadas. Ten\xe9s que crearlas desde el Men\xfa de Administrador. "),o.Rb())}function Zt(t,e){if(1&t){const t=o.Tb();o.Sb(0,"div"),o.Sb(1,"div",20),o.Sb(2,"div",21),o.Bc(3),o.Rb(),o.Rb(),o.Sb(4,"div",20),o.Sb(5,"div",21),o.Sb(6,"button",22),o.Zb("click",function(){o.sc(t);const e=o.dc(3);return e.takeSection(e.waiterService.session.id_section)}),o.Bc(7," Ingresar "),o.Rb(),o.Rb(),o.Sb(8,"div",21),o.Sb(9,"button",23),o.Zb("click",function(){o.sc(t);const e=o.dc(3);return e.releaseSection(e.waiterService.session.id_section)}),o.Bc(10," Cerrar "),o.Rb(),o.Rb(),o.Rb(),o.Rb()}if(2&t){const t=o.dc(3);o.Ab(3),o.Dc(" Ten\xe9s tomado el sector ",t.waiterService.session.id_section.tx_section," ")}}function Et(t,e){if(1&t&&(o.Sb(0,"mat-option",30),o.Bc(1),o.Rb()),2&t){const t=e.$implicit;o.jc("value",t),o.Ab(1),o.Dc(" ",t.tx_section," ")}}function Wt(t,e){if(1&t){const t=o.Tb();o.Sb(0,"div"),o.Sb(1,"div",24),o.Sb(2,"mat-form-field",25),o.Sb(3,"mat-label"),o.Bc(4,"Seleccione un sector"),o.Rb(),o.Sb(5,"mat-select",26,27),o.Ac(7,Et,2,2,"mat-option",28),o.Rb(),o.Rb(),o.Sb(8,"button",29),o.Zb("click",function(){o.sc(t);const e=o.rc(6);return o.dc(3).takeSection(null==e?null:e.value)}),o.Bc(9," Ingresar "),o.Rb(),o.Rb(),o.Rb()}if(2&t){const t=o.dc(3);o.Ab(7),o.jc("ngForOf",t.sections)}}function Ht(t,e){if(1&t&&(o.Sb(0,"div",18),o.Ac(1,Zt,11,1,"div",19),o.Ac(2,Wt,10,1,"div",19),o.Rb()),2&t){const t=o.dc(2);o.Ab(1),o.jc("ngIf",t.waiterService.session),o.Ab(1),o.jc("ngIf",!t.waiterService.session)}}function Jt(t,e){if(1&t&&(o.Sb(0,"tr"),o.Sb(1,"td",31),o.Bc(2),o.Rb(),o.Sb(3,"td",32),o.Bc(4),o.Rb(),o.Rb()),2&t){const t=e.$implicit,i=o.dc(2);o.Ab(2),o.Dc(" ",t.tx_section," "),o.Ab(2),o.Dc(" ",i.sessions.get(t.tx_section)," ")}}function zt(t,e){if(1&t&&(o.Sb(0,"div",4),o.Sb(1,"div",5),o.Bc(2,"Bienvenido, desde ac\xe1 pod\xe9s entrar a un sector y comenzar a atender mesas."),o.Rb(),o.Ac(3,Ft,2,0,"div",6),o.Ac(4,Pt,2,0,"div",6),o.Ac(5,Ht,3,2,"div",7),o.Sb(6,"div",8),o.Sb(7,"div",9),o.Sb(8,"table",10),o.Sb(9,"tr",11),o.Sb(10,"td",12),o.Nb(11,"span",13),o.Bc(12," Sector "),o.Rb(),o.Sb(13,"td",14),o.Nb(14,"span",15),o.Bc(15," Camareros "),o.Rb(),o.Rb(),o.Ac(16,Jt,5,2,"tr",16),o.Rb(),o.Rb(),o.Rb(),o.Rb()),2&t){const t=o.dc();o.Ab(3),o.jc("ngIf",!t.loginService.user.id_company),o.Ab(1),o.jc("ngIf",0===(null==t.tables?null:t.tables.length)),o.Ab(1),o.jc("ngIf",t.sections&&(null==t.loginService.user.id_company?null:t.loginService.user.id_company._id)),o.Ab(11),o.jc("ngForOf",t.sections)}}let Gt=(()=>{class t{constructor(t,e,i,s,n){this.router=t,this.loginService=e,this.waiterService=i,this.sharedService=s,this.snack=n,this.loading=!1,this.sections=[],this.sessions=new Map}ngOnInit(){var t;if(this.loading=!0,!(null===(t=this.loginService.user.id_company)||void 0===t?void 0:t._id))return this.sharedService.snack("No tiene una empresa seleccionada",5e3),void(this.loading=!1);{let t=this.loginService.user.id_company._id;this.readSections(t),this.readSessions(t)}this.userSuscription=this.loginService.user$.subscribe(t=>{t&&this.readSections(t.id_company._id)})}takeSection(t){t&&(this.waiterService.session?this.router.navigate(["/waiter/section"]):this.waiterService.takeSection(t._id,this.loginService.user._id).subscribe(t=>{this.snack.open(t.msg,null,{duration:2e3}),t.ok?(this.waiterService.session=t.session,localStorage.setItem("session",JSON.stringify(t.session)),this.router.navigate(["/waiter/section"])):this.snack.open("No se pudo tomar un escritorio",null,{duration:2e3})},()=>{}))}readSections(t){this.waiterService.readSections(t).subscribe(t=>{t.ok?(this.sections=t.sections,this.waiterService.sections=this.sections):(delete this.sections,delete this.waiterService.sections)},()=>{this.loading=!1},()=>{this.loading=!1})}readSessions(t){this.waiterService.readSessions(t).subscribe(t=>{if(t.ok){let e=t.sessions.filter(t=>t.id_waiter===this.loginService.user._id);this.waiterService.session=e[0],localStorage.setItem("session",JSON.stringify(this.waiterService.session));for(let i of this.sections)this.sessions.set(i.tx_section,t.sessions.filter(t=>t.id_section.tx_section===i.tx_section).length)}else delete this.sessions},()=>{this.loading=!1},()=>{this.loading=!1})}releaseSection(t){this.loading=!0,this.waiterService.releaseSection(t._id,this.loginService.user._id).subscribe(t=>{t.ok&&(this.readSessions(this.loginService.user.id_company._id),this.waiterService.clearSectionSession())})}ngOnDestroy(){this.userSuscription&&this.userSuscription.unsubscribe()}}return t.\u0275fac=function(e){return new(e||t)(o.Mb(c.b),o.Mb(d.a),o.Mb(u.a),o.Mb(m.a),o.Mb(Dt.a))},t.\u0275cmp=o.Gb({type:t,selectors:[["app-home"]],decls:6,vars:2,consts:[[1,"saturno-card","shadow-box","mt-sm-4","animated","fadeIn"],["class","animated fadeIn",4,"ngIf"],["routerLink","/waiter/dashboard","role","button",1,"btn","btn-primary","btn-block"],[1,"mdi","mdi-finance","mx-1"],[1,"animated","fadeIn"],[1,"md"],["class","card lead bg-danger text-white p-3 my-4","style","line-height: initial;",4,"ngIf"],["class","mb-4",4,"ngIf"],[1,"card","bg-secondary","mb-4"],[1,"card-content","table-responsive-sm","p-2"],[1,"table","table-sm","text-white","text-center"],[2,"border-top","0px","color","yellow"],[2,"text-align","left","border","none"],[1,"mdi","mdi-select-group","mx-1"],[2,"text-align","right","border","none"],[1,"mdi","mdi-face","mx-1"],[4,"ngFor","ngForOf"],[1,"card","lead","bg-danger","text-white","p-3","my-4",2,"line-height","initial"],[1,"mb-4"],[4,"ngIf"],[1,"row","my-4"],[1,"col"],["role","button",1,"btn","btn-success","btn-block","text-uppercase",3,"click"],["role","button",1,"btn","btn-danger","btn-block","text-uppercase",3,"click"],[1,"my-4"],[1,"w-100"],["matNativeControl","","required",""],["selectSection",""],[3,"value",4,"ngFor","ngForOf"],["role","button",1,"btn","btn-success","btn-block",3,"click"],[3,"value"],[2,"text-align","left"],[2,"text-align","right"]],template:function(t,e){1&t&&(o.Sb(0,"div",0),o.Ac(1,$t,2,0,"div",1),o.Ac(2,zt,17,4,"div",1),o.Sb(3,"button",2),o.Nb(4,"span",3),o.Bc(5," Dashboard "),o.Rb(),o.Rb()),2&t&&(o.Ab(1),o.jc("ngIf",e.loading),o.Ab(1),o.jc("ngIf",!e.loading))},directives:[s.j,c.c,h.b,s.i,Ct.c,Ct.f,Ot.a,qt.k],styles:[""]}),t})();var Lt=i("cxbk"),Ut=i("IheW");let Qt=(()=>{class t{constructor(t){this.http=t}getUserMetrics(t,e){return this.http.post(Lt.a.url+"/metrics/getusermetrics",{fcSel:t,idUser:e})}}return t.\u0275fac=function(e){return new(e||t)(o.Wb(Ut.b))},t.\u0275prov=o.Ib({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var Vt=i("e6WT"),Kt=i("TN/R");let Yt=(()=>{class t{transform(t){return p()(t).format("H:mm:ss")}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275pipe=o.Lb({name:"timeToHms",type:t,pure:!0}),t})();function Xt(t,e){1&t&&(o.Sb(0,"div",2),o.Nb(1,"mat-spinner"),o.Rb())}function te(t,e){if(1&t&&(o.Sb(0,"tr"),o.Sb(1,"td",25),o.Bc(2),o.Rb(),o.Sb(3,"td",26),o.Bc(4),o.ec(5,"timeToHms"),o.Rb(),o.Sb(6,"td",26),o.Bc(7),o.ec(8,"intervalToHms"),o.Rb(),o.Sb(9,"td",26),o.Bc(10),o.ec(11,"timeToHms"),o.Rb(),o.Sb(12,"td",26),o.Bc(13),o.ec(14,"intervalToHms"),o.Rb(),o.Sb(15,"td",27),o.Bc(16),o.ec(17,"timeToHms"),o.Rb(),o.Rb()),2&t){const t=e.$implicit;o.Ab(2),o.Dc(" ",t.id_position," "),o.Ab(2),o.Dc(" ",o.fc(5,6,t.tm_start)," "),o.Ab(3),o.Dc(" ",o.gc(8,8,t.tm_start,t.tm_att)," "),o.Ab(3),o.Dc(" ",o.fc(11,11,t.tm_att)," "),o.Ab(3),o.Dc(" ",o.gc(14,13,t.tm_att,t.tm_end)," "),o.Ab(3),o.Dc(" ",o.fc(17,16,t.tm_end)," ")}}function ee(t,e){if(1&t){const t=o.Tb();o.Sb(0,"div"),o.Sb(1,"div",3),o.Sb(2,"div",4),o.Sb(3,"div",5),o.Sb(4,"mat-form-field",6),o.Sb(5,"mat-label"),o.Bc(6,"Angular forms"),o.Rb(),o.Sb(7,"input",7),o.Zb("dateChange",function(e){return o.sc(t),o.dc().setDate(e)}),o.Rb(),o.Nb(8,"mat-datepicker-toggle",8),o.Nb(9,"mat-datepicker",null,9),o.Rb(),o.Rb(),o.Rb(),o.Sb(11,"div",10),o.Sb(12,"div",11),o.Sb(13,"div",12),o.Sb(14,"div",13),o.Bc(15,"Turnos"),o.Rb(),o.Sb(16,"div",14),o.Bc(17),o.Rb(),o.Rb(),o.Rb(),o.Sb(18,"div",11),o.Sb(19,"div",15),o.Sb(20,"div",13),o.Bc(21,"Evals"),o.Rb(),o.Sb(22,"div",14),o.Bc(23),o.Rb(),o.Rb(),o.Rb(),o.Sb(24,"div",11),o.Sb(25,"div",16),o.Sb(26,"div",13),o.Bc(27,"Score"),o.Rb(),o.Sb(28,"div",14),o.Bc(29),o.Rb(),o.Rb(),o.Rb(),o.Rb(),o.Sb(30,"div",4),o.Sb(31,"div",11),o.Sb(32,"div",17),o.Sb(33,"div",18),o.Sb(34,"table",19),o.Sb(35,"tr",20),o.Sb(36,"td",21),o.Bc(37,"Ticket"),o.Rb(),o.Sb(38,"td",22),o.Bc(39,"Start"),o.Rb(),o.Sb(40,"td",22),o.Bc(41," - "),o.Rb(),o.Sb(42,"td",22),o.Bc(43,"Atteneded"),o.Rb(),o.Sb(44,"td",22),o.Bc(45," - "),o.Rb(),o.Sb(46,"td",23),o.Bc(47,"End"),o.Rb(),o.Rb(),o.Ac(48,te,18,18,"tr",24),o.Rb(),o.Rb(),o.Rb(),o.Rb(),o.Rb(),o.Rb(),o.Rb()}if(2&t){const t=o.rc(10),e=o.dc();o.Ab(7),o.jc("matDatepicker",t)("value",e.date),o.Ab(1),o.jc("for",t),o.Ab(9),o.Dc(" ",e.metrics.tickets.length," "),o.Ab(6),o.Dc(" ",e.metrics.total," "),o.Ab(6),o.Dc(" ",e.metrics.avg," "),o.Ab(19),o.jc("ngForOf",e.metrics.tickets)}}const ie=[{path:"home",component:Gt},{path:"section",component:Nt},{path:"dashboard",component:(()=>{class t{constructor(t,e){this.MetricsService=t,this.loginService=e,this.loading=!1,this.metrics={total:0,avg:0,tickets:[]},this.date=new Date}ngOnInit(){let t=(new Date).setHours(0,0,0,0);this.getMetrics(t)}setDate(t){let e=+new Date(t.value);this.date=new Date(e),this.getMetrics(e)}getMetrics(t){this.loading=!0,this.MetricsService.getUserMetrics(t,this.loginService.user._id).subscribe(t=>{this.metrics=t.metric,this.loading=!1},()=>{this.loading=!1})}}return t.\u0275fac=function(e){return new(e||t)(o.Mb(Qt),o.Mb(d.a))},t.\u0275cmp=o.Gb({type:t,selectors:[["app-dashboard"]],decls:2,vars:2,consts:[["class","mt-5 animated fadeIn",4,"ngIf"],[4,"ngIf"],[1,"mt-5","animated","fadeIn"],[1,"saturno-card"],[1,"row"],[1,"col","w-100"],[1,"w-100"],["matInput","",3,"matDatepicker","value","dateChange"],["matSuffix","",3,"for"],["picker1",""],[1,"row","mb-4"],[1,"col"],[1,"card","text-white","bg-success"],[1,"card-header"],[1,"card-body","saturno-card-mini-body"],[1,"card","text-white","bg-danger"],[1,"card","text-white","bg-primary"],[1,"card","bg-secondary","mb-4"],[1,"card-content","table-responsive-sm","p-2"],[1,"table","table-sm","text-white","text-center",2,"font-size","x-small"],[2,"border-top","0px","color","yellow"],[2,"text-align","left","border","none"],[2,"text-align","center","border","none"],[2,"text-align","right","border","none"],[4,"ngFor","ngForOf"],[2,"text-align","left"],[2,"text-align","center"],[2,"text-align","right"]],template:function(t,e){1&t&&(o.Ac(0,Xt,2,0,"div",0),o.Ac(1,ee,49,7,"div",1)),2&t&&(o.jc("ngIf",e.loading),o.Ab(1),o.jc("ngIf",!e.loading&&e.metrics))},directives:[s.j,h.b,Ct.c,Ct.f,Vt.b,Kt.b,Kt.d,Ct.g,Kt.a,s.i],pipes:[Yt,f],styles:[""]}),t})()},{path:"",redirectTo:"/waiter/home",pathMatch:"full"},{path:"**",component:a.a}];let se=(()=>{class t{}return t.\u0275mod=o.Kb({type:t}),t.\u0275inj=o.Jb({factory:function(e){return new(e||t)},imports:[[c.e.forChild(ie)],c.e]}),t})();var ne=i("1+r1"),ce=i("iTUp");let ae=(()=>{class t{}return t.\u0275mod=o.Kb({type:t}),t.\u0275inj=o.Jb({factory:function(e){return new(e||t)},imports:[[n.j,s.b,ne.a,ce.a,se]]}),t})()}}]);