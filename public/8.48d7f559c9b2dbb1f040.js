(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{rakS:function(e,t,i){"use strict";i.r(t),i.d(t,"WaiterModule",function(){return at});var s=i("SVse"),n=i("s7LF"),c=i("iInd"),a=i("AIE+"),b=i("mrSG"),l=i("XNiG"),r=i("l5mm"),o=i("8Y7J"),d=i("EFyh"),u=i("d+tV"),m=i("zuHl"),g=i("Gyf/"),S=i("wd/R"),p=i.n(S);let f=(()=>{class e{transform(e,t){if(!e)return"-";t||(t=+new Date);let i=p.a.duration(t-e),s=i.hours(),n=i.minutes(),c=i.seconds();return`${0===s?"":s.toString()+":"}${n<=9?"0"+n.toString()+":":n.toString()+":"}${c<=9?"0"+c.toString():c.toString()}`}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275pipe=o.Mb({name:"intervalToHms",type:e,pure:!0}),e.\u0275prov=o.Jb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var h=i("pu8Q"),T=i("o4Yh"),v=i("zQhy");function _(e,t){1&e&&o.Ob(0,"span",21)}function k(e,t){if(1&e&&(o.Tb(0,"tr"),o.Tb(1,"td",18),o.Cc(2),o.Bc(3,_,1,0,"span",19),o.Sb(),o.Tb(4,"td",20),o.Cc(5),o.Sb(),o.Tb(6,"td",20),o.Cc(7),o.Sb(),o.Tb(8,"td",20),o.Cc(9),o.Sb(),o.Tb(10,"td",20),o.Cc(11),o.Sb(),o.Tb(12,"td",20),o.Cc(13),o.Sb(),o.Sb()),2&e){const e=t.$implicit,i=o.ec(2);o.Bb(2),o.Ec(" ",e.tx_section," "),o.Bb(1),o.kc("ngIf",i.tablesDataBySection.get(e.tx_section).sectionselected),o.Bb(2),o.Ec(" ",i.tablesDataBySection.get(e.tx_section).busy," "),o.Bb(2),o.Ec(" ",i.tablesDataBySection.get(e.tx_section).idle," "),o.Bb(2),o.Ec(" ",i.tablesDataBySection.get(e.tx_section).paused," "),o.Bb(2),o.Ec(" ",i.ticketsDataBySection.get(e.tx_section).requested," "),o.Bb(2),o.Ec(" ",i.ticketsDataBySection.get(e.tx_section).queued," ")}}function x(e,t){if(1&e&&(o.Tb(0,"table",6),o.Tb(1,"tr"),o.Tb(2,"td",7),o.Cc(3,"Sector"),o.Sb(),o.Tb(4,"td",8),o.Cc(5,"Mesas"),o.Sb(),o.Tb(6,"td",9),o.Cc(7,"Turnos"),o.Sb(),o.Sb(),o.Tb(8,"tr",10),o.Ob(9,"td",11),o.Ob(10,"td",12),o.Ob(11,"td",13),o.Ob(12,"td",14),o.Ob(13,"td",15),o.Ob(14,"td",16),o.Sb(),o.Bc(15,k,14,7,"tr",17),o.Sb()),2&e){const e=o.ec();o.Bb(15),o.kc("ngForOf",e.waiterService.sections)}}let B=(()=>{class e{constructor(e,t){this.loginService=e,this.waiterService=t}ngOnInit(){}}return e.\u0275fac=function(t){return new(t||e)(o.Nb(d.a),o.Nb(u.a))},e.\u0275cmp=o.Hb({type:e,selectors:[["app-sections"]],inputs:{tablesDataBySection:"tablesDataBySection",ticketsDataBySection:"ticketsDataBySection"},decls:10,vars:3,consts:[[1,"xl","mdi","mdi-select-group","text-success"],[1,"sidenav-title-text","mx-2"],[1,"card","bg-secondary","mb-3"],[1,"card-body","table-responsive-sm","p-2"],[3,"ngModel","ngModelChange"],["class","table table-sm text-white text-center",4,"ngIf"],[1,"table","table-sm","text-white","text-center"],[2,"text-align","left","border","none"],["colspan","3",2,"text-align","center","border","none"],["colspan","2",2,"text-align","center","border","none"],[2,"border-top","3px solid #4fac40","background-color","whitesmoke"],[1,"xl","mdi","mdi-select-group","text-warning",2,"text-align","left","border","none"],[1,"xl","mdi","mdi-minus-circle-outline","text-danger",2,"text-align","center","border","none"],[1,"xl","mdi","mdi-check-circle-outline","text-success",2,"text-align","center","border","none"],[1,"xl","mdi","mdi-pause-circle-outline","text-secondary",2,"text-align","center","border","none"],[1,"xl","mdi","mdi-alert-box","text-danger",2,"text-align","center","border","none"],[1,"xl","mdi","mdi-format-list-numbered","text-primary",2,"text-align","center","border","none"],[4,"ngFor","ngForOf"],[2,"text-align","left"],["class","mdi mdi-check lg text-warning",4,"ngIf"],[2,"text-align","center"],[1,"mdi","mdi-check","lg","text-warning"]],template:function(e,t){1&e&&(o.Tb(0,"mat-expansion-panel"),o.Tb(1,"mat-expansion-panel-header"),o.Tb(2,"mat-panel-title"),o.Ob(3,"span",0),o.Tb(4,"span",1),o.Cc(5),o.Sb(),o.Sb(),o.Sb(),o.Tb(6,"div",2),o.Tb(7,"div",3),o.Tb(8,"mat-radio-group",4),o.ac("ngModelChange",function(e){return t.waiterService.sectionSelected=e}),o.Bc(9,x,16,1,"table",5),o.Sb(),o.Sb(),o.Sb(),o.Sb()),2&e&&(o.Bb(5),o.Ec("Sectores (",t.waiterService.sections.length,")"),o.Bb(3),o.kc("ngModel",t.waiterService.sectionSelected),o.Bb(1),o.kc("ngIf",t.tablesDataBySection.size>0&&t.ticketsDataBySection.size>0))},directives:[T.c,T.d,T.e,v.a,n.p,n.s,s.j,s.i],styles:[""]}),e})();var w=i("pMoy"),y=i("jMqV");function C(e,t){1&e&&o.Ob(0,"span",28)}function I(e,t){1&e&&o.Ob(0,"span",29)}function O(e,t){1&e&&o.Ob(0,"span",30)}function M(e,t){1&e&&o.Ob(0,"span",31)}function E(e,t){if(1&e&&(o.Tb(0,"span"),o.Cc(1),o.Sb()),2&e){const e=o.ec().$implicit,t=o.ec(2);o.Bb(1),o.Ec(" ",t.busyTablesTimes.get(e.nm_table).tm_provided," ")}}function D(e,t){1&e&&o.Ob(0,"span",32)}function q(e,t){1&e&&o.Ob(0,"span",33)}function N(e,t){1&e&&o.Ob(0,"span",34)}function $(e,t){1&e&&o.Ob(0,"span",35)}function F(e,t){if(1&e&&(o.Tb(0,"span"),o.Cc(1),o.Sb()),2&e){const e=o.ec().$implicit,t=o.ec(2);o.Bb(1),o.Ec(" ",t.busyTablesTimes.get(e.nm_table).tm_call," ")}}const P=function(e,t,i,s){return{"btn-success":e,"btn-danger":t,"btn-secondary":i,"btn-dark":s}};function H(e,t){if(1&e){const e=o.Ub();o.Tb(0,"tr",15),o.ac("click",function(){o.tc(e);const i=t.$implicit;return o.ec(2).selectTable(i)}),o.Tb(1,"td",16),o.Bc(2,C,1,0,"span",17),o.Bc(3,I,1,0,"span",18),o.Bc(4,O,1,0,"span",19),o.Bc(5,M,1,0,"span",20),o.Tb(6,"span",21),o.Cc(7),o.Sb(),o.Sb(),o.Tb(8,"td",22),o.ac("click",function(){o.tc(e);const i=t.$implicit;return o.ec(2).selectTable(i)}),o.Cc(9),o.Sb(),o.Tb(10,"td",23),o.Bc(11,E,2,1,"span",5),o.Sb(),o.Tb(12,"td",23),o.Bc(13,D,1,0,"span",24),o.Bc(14,q,1,0,"span",25),o.Bc(15,N,1,0,"span",26),o.Bc(16,$,1,0,"span",27),o.Sb(),o.Tb(17,"td",23),o.Bc(18,F,2,1,"span",5),o.Sb(),o.Sb()}if(2&e){const e=t.$implicit,i=o.ec(2);o.kc("ngClass",o.qc(13,P,"idle"===e.tx_status,"busy"===e.tx_status,"paused"===e.tx_status,"reserved"===e.tx_status)),o.Bb(2),o.kc("ngIf","busy"===e.tx_status),o.Bb(1),o.kc("ngIf","paused"===e.tx_status),o.Bb(1),o.kc("ngIf","idle"===e.tx_status),o.Bb(1),o.kc("ngIf","reserved"===e.tx_status),o.Bb(2),o.Dc(e.nm_table),o.Bb(2),o.Ec(" ",null==e.id_session?null:e.id_session.id_ticket.id_position," "),o.Bb(2),o.kc("ngIf","busy"===e.tx_status&&i.busyTablesTimes.get(e.nm_table)),o.Bb(2),o.kc("ngIf",null===(null==e.id_session?null:e.id_session.id_ticket.tx_call)&&null!==(null==e.id_session?null:e.id_session.id_ticket.tm_provided)),o.Bb(1),o.kc("ngIf","card"===(null==e.id_session?null:e.id_session.id_ticket.tx_call)),o.Bb(1),o.kc("ngIf","waiter"===(null==e.id_session?null:e.id_session.id_ticket.tx_call)),o.Bb(1),o.kc("ngIf","account"===(null==e.id_session?null:e.id_session.id_ticket.tx_call)),o.Bb(2),o.kc("ngIf","busy"===e.tx_status&&i.busyTablesTimes.get(e.nm_table))}}function U(e,t){if(1&e){const e=o.Ub();o.Tb(0,"div",6),o.Tb(1,"div",7),o.Tb(2,"div",8),o.Cc(3),o.Sb(),o.Tb(4,"mat-radio-group",9),o.ac("ngModelChange",function(t){return o.tc(e),o.ec().tableSelected=t}),o.Tb(5,"table",10),o.Tb(6,"tr",11),o.Tb(7,"td",12),o.Cc(8,"Mesa"),o.Sb(),o.Tb(9,"td",13),o.Cc(10,"Turno"),o.Sb(),o.Tb(11,"td",13),o.Cc(12,"Ocup."),o.Sb(),o.Tb(13,"td",13),o.Cc(14,"Acci\xf3n"),o.Sb(),o.Tb(15,"td",13),o.Cc(16,"Espera"),o.Sb(),o.Sb(),o.Bc(17,H,19,18,"tr",14),o.Sb(),o.Sb(),o.Sb(),o.Sb()}if(2&e){const e=o.ec();o.Bb(3),o.Ec(" Mesas del sector ",e.waiterService.session.id_section.tx_section," "),o.Bb(1),o.kc("ngModel",e.tableSelected),o.Bb(13),o.kc("ngForOf",e.tables)}}function j(e,t){1&e&&o.Ob(0,"span",46)}function W(e,t){1&e&&o.Ob(0,"span",0)}function A(e,t){1&e&&o.Ob(0,"span",47)}function J(e,t){if(1&e&&(o.Tb(0,"span"),o.Bc(1,j,1,0,"span",43),o.Bc(2,W,1,0,"span",44),o.Bc(3,A,1,0,"span",45),o.Sb()),2&e){const e=o.ec(2).$implicit;o.Bb(1),o.kc("ngIf","card"===(null==e.id_session?null:e.id_session.id_ticket.tx_call)),o.Bb(1),o.kc("ngIf","waiter"===(null==e.id_session?null:e.id_session.id_ticket.tx_call)),o.Bb(1),o.kc("ngIf","account"===(null==e.id_session?null:e.id_session.id_ticket.tx_call))}}function R(e,t){1&e&&o.Ob(0,"span",49)}function z(e,t){if(1&e&&(o.Tb(0,"span"),o.Bc(1,R,1,0,"span",48),o.Sb()),2&e){const e=o.ec(2).$implicit;o.Bb(1),o.kc("ngIf","busy"===e.tx_status)}}function L(e,t){if(1&e&&(o.Tb(0,"span"),o.Bc(1,J,4,3,"span",5),o.Bc(2,z,2,1,"span",5),o.Sb()),2&e){const e=o.ec().$implicit;o.Bb(1),o.kc("ngIf",null==e.id_session?null:e.id_session.id_ticket.tx_call),o.Bb(1),o.kc("ngIf",!(null!=e.id_session&&e.id_session.id_ticket.tx_call))}}function G(e,t){1&e&&o.Ob(0,"span",53)}function Q(e,t){1&e&&o.Ob(0,"span",54)}function V(e,t){1&e&&o.Ob(0,"span",55)}function K(e,t){if(1&e&&(o.Tb(0,"span"),o.Bc(1,G,1,0,"span",50),o.Bc(2,Q,1,0,"span",51),o.Bc(3,V,1,0,"span",52),o.Sb()),2&e){const e=o.ec().$implicit;o.Bb(1),o.kc("ngIf","paused"===e.tx_status),o.Bb(1),o.kc("ngIf","idle"===e.tx_status),o.Bb(1),o.kc("ngIf","reserved"===e.tx_status)}}function X(e,t){if(1&e){const e=o.Ub();o.Tb(0,"div",38),o.Tb(1,"div",39),o.ac("click",function(){o.tc(e);const i=t.$implicit;return o.ec(2).selectTable(i)}),o.Tb(2,"table",40),o.Tb(3,"tr"),o.Tb(4,"td",41),o.Tb(5,"span",42),o.Cc(6),o.Sb(),o.Sb(),o.Tb(7,"td"),o.Bc(8,L,3,2,"span",5),o.Bc(9,K,4,3,"span",5),o.Sb(),o.Sb(),o.Sb(),o.Sb(),o.Sb()}if(2&e){const e=t.$implicit;o.Bb(1),o.kc("ngClass",o.qc(4,P,"idle"===e.tx_status,"busy"===e.tx_status,"paused"===e.tx_status,"reserved"===e.tx_status)),o.Bb(5),o.Dc(e.nm_table),o.Bb(2),o.kc("ngIf",e.id_session),o.Bb(1),o.kc("ngIf",!e.id_session)}}function Y(e,t){if(1&e&&(o.Tb(0,"div",36),o.Bc(1,X,10,9,"div",37),o.Sb()),2&e){const e=o.ec();o.Bb(1),o.kc("ngForOf",e.tables)}}function Z(e,t){1&e&&(o.Tb(0,"span"),o.Cc(1," Ocupada "),o.Sb())}function ee(e,t){1&e&&(o.Tb(0,"span"),o.Cc(1," Pausada "),o.Sb())}function te(e,t){1&e&&(o.Tb(0,"span"),o.Cc(1," Esperando clientes "),o.Sb())}function ie(e,t){1&e&&(o.Tb(0,"span"),o.Cc(1," Reservada "),o.Sb())}function se(e,t){if(1&e&&(o.Tb(0,"div"),o.Tb(1,"table",73),o.Tb(2,"tr"),o.Tb(3,"td",12),o.Cc(4,"Turno"),o.Sb(),o.Tb(5,"td",74),o.Cc(6),o.Sb(),o.Sb(),o.Tb(7,"tr"),o.Tb(8,"td",12),o.Cc(9,"Comensales"),o.Sb(),o.Tb(10,"td",74),o.Cc(11),o.Sb(),o.Sb(),o.Tb(12,"tr"),o.Tb(13,"td",12),o.Cc(14,"Prioridad"),o.Sb(),o.Tb(15,"td",74),o.Cc(16),o.Sb(),o.Sb(),o.Tb(17,"tr"),o.Tb(18,"td",12),o.Cc(19,"Provisi\xf3n"),o.Sb(),o.Tb(20,"td",74),o.Cc(21),o.Sb(),o.Sb(),o.Tb(22,"tr"),o.Tb(23,"td",12),o.Cc(24," Solicitud de asistencia "),o.Sb(),o.Tb(25,"td",74),o.Cc(26),o.Sb(),o.Sb(),o.Sb(),o.Sb()),2&e){const e=o.ec(2);o.Bb(6),o.Ec(" ",null==e.table||null==e.table.id_session?null:e.table.id_session.id_ticket.id_position," "),o.Bb(5),o.Ec(" ",null==e.table||null==e.table.id_session?null:e.table.id_session.id_ticket.nm_persons," "),o.Bb(5),o.Ec(" ",null==e.table||null==e.table.id_session?null:e.table.id_session.id_ticket.bl_priority," "),o.Bb(5),o.Ec(" ",e.busyTablesTimes.get(e.table.nm_table).tm_provided," "),o.Bb(5),o.Ec(" ",e.busyTablesTimes.get(e.table.nm_table).tm_call," ")}}const ne=function(e,t,i,s){return{"bg-success":e,"bg-danger":t,"bg-secondary":i,"bg-dark":s}},ce=function(e,t,i){return{"button-disabled":e,"btn-success":t,"btn-secondary":i}},ae=function(e){return{"button-disabled":e}};function be(e,t){if(1&e){const e=o.Ub();o.Tb(0,"div"),o.Tb(1,"div",56),o.Tb(2,"div",57),o.Cc(3),o.Bc(4,Z,2,0,"span",5),o.Bc(5,ee,2,0,"span",5),o.Bc(6,te,2,0,"span",5),o.Bc(7,ie,2,0,"span",5),o.Sb(),o.Tb(8,"div",58),o.Bc(9,se,27,5,"div",5),o.Ob(10,"hr"),o.Tb(11,"div",59),o.Tb(12,"div",60),o.Tb(13,"button",61),o.Tb(14,"table",40),o.Tb(15,"tr"),o.Tb(16,"td",62),o.Ob(17,"span",63),o.Sb(),o.Tb(18,"td",40),o.Tb(19,"mat-slide-toggle",64),o.ac("click",function(){o.tc(e);const t=o.ec();return t.toggleTableStatus(t.table)}),o.Sb(),o.Sb(),o.Sb(),o.Sb(),o.Sb(),o.Sb(),o.Tb(20,"div",60),o.Tb(21,"button",61),o.Tb(22,"table",40),o.Tb(23,"tr"),o.Tb(24,"td",62),o.Ob(25,"span",65),o.Sb(),o.Tb(26,"td",40),o.Tb(27,"mat-slide-toggle",66),o.ac("ngModelChange",function(t){return o.tc(e),o.ec().blPriority=t}),o.Sb(),o.Sb(),o.Sb(),o.Sb(),o.Sb(),o.Sb(),o.Tb(28,"div",60),o.Tb(29,"button",67),o.ac("click",function(){o.tc(e);const t=o.ec();return t.reassignTicket(null==t.table.id_session?null:t.table.id_session.id_ticket)}),o.Tb(30,"table",40),o.Tb(31,"tr"),o.Tb(32,"td",62),o.Ob(33,"span",68),o.Sb(),o.Tb(34,"td",40),o.Cc(35,"Mover"),o.Sb(),o.Sb(),o.Sb(),o.Sb(),o.Sb(),o.Tb(36,"div",60),o.Tb(37,"button",67),o.ac("click",function(){o.tc(e);const t=o.ec();return t.attendedTicket(null==t.table.id_session?null:t.table.id_session.id_ticket)}),o.Tb(38,"table",40),o.Tb(39,"tr"),o.Tb(40,"td",62),o.Ob(41,"span",69),o.Sb(),o.Tb(42,"td",40),o.Cc(43,"Atendido"),o.Sb(),o.Sb(),o.Sb(),o.Sb(),o.Sb(),o.Tb(44,"div",60),o.Tb(45,"button",67),o.ac("click",function(){o.tc(e);const t=o.ec();return t.releaseTicket(null==t.table.id_session?null:t.table.id_session.id_ticket)}),o.Tb(46,"table",40),o.Tb(47,"tr"),o.Tb(48,"td",62),o.Ob(49,"span",70),o.Sb(),o.Tb(50,"td",40),o.Cc(51,"Soltar"),o.Sb(),o.Sb(),o.Sb(),o.Sb(),o.Sb(),o.Tb(52,"div",60),o.Tb(53,"button",71),o.ac("click",function(){o.tc(e);const t=o.ec();return t.endTicket(null==t.table.id_session?null:t.table.id_session.id_ticket)}),o.Tb(54,"table",40),o.Tb(55,"tr"),o.Tb(56,"td",62),o.Ob(57,"span",72),o.Sb(),o.Tb(58,"td",40),o.Cc(59,"Finalizar"),o.Sb(),o.Sb(),o.Sb(),o.Sb(),o.Sb(),o.Sb(),o.Sb(),o.Sb(),o.Sb()}if(2&e){const e=o.ec();o.Bb(2),o.kc("ngClass",o.qc(23,ne,"idle"===e.table.tx_status,"busy"===e.table.tx_status,"paused"===e.table.tx_status,"reserved"===e.table.tx_status)),o.Bb(1),o.Ec(" Mesa ",e.table.nm_table,": "),o.Bb(1),o.kc("ngIf","busy"===e.table.tx_status),o.Bb(1),o.kc("ngIf","paused"===e.table.tx_status),o.Bb(1),o.kc("ngIf","idle"===e.table.tx_status),o.Bb(1),o.kc("ngIf","reserved"===e.table.tx_status),o.Bb(2),o.kc("ngIf",null==e.table?null:e.table.id_session),o.Bb(4),o.kc("ngClass",o.pc(28,ce,"busy"===e.table.tx_status,"idle"===e.table.tx_status,"paused"===e.table.tx_status))("disabled","busy"===e.table.tx_status),o.Bb(6),o.kc("checked","paused"!==e.table.tx_status)("disabled","busy"===e.table.tx_status),o.Bb(2),o.kc("ngClass",o.nc(32,ae,!e.table.id_session||""===e.waiterService.sectionSelected))("disabled",!e.table.id_session||""===e.waiterService.sectionSelected),o.Bb(6),o.kc("ngModel",e.blPriority)("disabled",!e.table.id_session||""===e.waiterService.sectionSelected),o.Bb(2),o.kc("disabled",!e.table.id_session||""===e.waiterService.sectionSelected)("ngClass",o.nc(34,ae,!e.table.id_session||""===e.waiterService.sectionSelected)),o.Bb(8),o.kc("disabled",!(null!=e.table.id_session&&e.table.id_session.id_ticket.tx_call)||"busy"!==e.table.tx_status)("ngClass",o.nc(36,ae,!(null!=e.table.id_session&&e.table.id_session.id_ticket.tx_call)||"busy"!==e.table.tx_status)),o.Bb(8),o.kc("disabled","busy"!==e.table.tx_status)("ngClass",o.nc(38,ae,"busy"!==e.table.tx_status)),o.Bb(8),o.kc("disabled","busy"!==e.table.tx_status)("ngClass",o.nc(40,ae,"busy"!==e.table.tx_status))}}let le=(()=>{class e{constructor(e,t,i,s){this.loginService=e,this.waiterService=t,this.sharedService=i,this.intervalToHmsPipe=s,this.tables=[],this.tickets=[],this.listmode=!1,this.tableSelected="",this.blPriority=!1,this.selectTable=e=>{this.table=e},this.toggleTableStatus=e=>{"busy"!==e.tx_status&&this.waiterService.toggleTableStatus(e._id).subscribe(t=>{t.ok?(this.tables.filter(e=>e._id===t.table._id)[0].tx_status=t.table.tx_status,e.tx_status=t.table.tx_status):this.sharedService.snack(t.msg,2e3)})},this.releaseTicket=e=>{e?this.sharedService.snack("Desea soltar el ticket y devolverlo a su estado anterior?",5e3,"ACEPTAR").then(t=>{t&&this.waiterService.releaseTicket(e).subscribe(t=>{t.ok&&(this.tickets=this.tickets.filter(e=>e._id!=e._id),this.clearTicketSession(e))})}):this.sharedService.snack("Error. No hay clientes en esta mesa.",5e3)},this.reassignTicket=e=>{e?this.sharedService.snack("Desea enviar el ticket al skill seleccionado?",5e3,"ACEPTAR").then(t=>{if(t){let t=e._id,i=this.waiterService.sectionSelected,s=this.blPriority;t&&i&&this.waiterService.reassignTicket(t,i,s).subscribe(t=>{t.ok&&(this.blPriority=!1,this.clearTicketSession(e))})}}):this.sharedService.snack("Error. No hay clientes en esta mesa.",5e3)},this.endTicket=e=>{e||this.sharedService.snack("Seleccione una mesa primero",3e3);let t=e._id;this.tickets&&this.sharedService.snack("Desea finalizar el ticket actual?",5e3,"ACEPTAR").then(i=>{i&&this.waiterService.endTicket(t).subscribe(t=>{t.ok&&(this.clearTicketSession(e),this.clearTableSession(e))})})},this.attendedTicket=e=>{this.waiterService.attendedTicket(e).subscribe(e=>{e.ok&&(this.tables.filter(t=>{var i;return(null===(i=t.id_session)||void 0===i?void 0:i.id_ticket._id)===e.ticket._id})[0].id_session.id_ticket.tx_call=null)})},this.setListMode=()=>{if(localStorage.getItem("config")){let e=JSON.parse(localStorage.getItem("config"));e.listmode=!this.listmode,localStorage.setItem("config",JSON.stringify(e))}else localStorage.setItem("config",JSON.stringify({listmode:!0}))},this.clearTicketSession=e=>{this.tickets=this.tickets.filter(t=>t._id!==e._id)},this.clearTableSession=e=>{let t=this.tables.filter(t=>{var i;return(null===(i=t.id_session)||void 0===i?void 0:i.id_ticket._id)===e._id})[0];t.tx_status="paused",t.id_session=null}}ngOnInit(){let e=JSON.parse(localStorage.getItem("config"));this.listmode=!!e&&e.listmode}}return e.\u0275fac=function(t){return new(t||e)(o.Nb(d.a),o.Nb(u.a),o.Nb(m.a),o.Nb(f))},e.\u0275cmp=o.Hb({type:e,selectors:[["app-tables"]],inputs:{tables:"tables",tickets:"tickets",busyTablesTimes:"busyTablesTimes"},decls:11,vars:5,consts:[[1,"xl","mdi","mdi-silverware-fork-knife","text-warning"],[1,"sidenav-title-text","mx-2"],[1,"example-margin",3,"ngModel","ngModelChange","click"],["class","card bg-secondary mb-3",4,"ngIf"],["class","container row px-0 mb-4",4,"ngIf"],[4,"ngIf"],[1,"card","bg-secondary","mb-3"],[1,"card-body","table-responsive-sm","p-2"],[1,"text-white","m-3"],[3,"ngModel","ngModelChange"],[1,"table","table-sm","text-white","text-center"],[2,"border-top","0px","color","yellow"],[2,"text-align","left","border","none"],[2,"text-align","center","border","none"],["class","pointer rounded",3,"ngClass","click",4,"ngFor","ngForOf"],[1,"pointer","rounded",3,"ngClass","click"],[2,"padding","0.2rem","text-align","left"],["class","mdi mdi-minus-circle-outline",4,"ngIf"],["class","mdi mdi-pause-circle-outline",4,"ngIf"],["class","mdi mdi-check-circle-outline",4,"ngIf"],["class","mdi mdi-stop-circle-outline",4,"ngIf"],[1,"ml-2"],[2,"padding","0.2rem","text-align","center",3,"click"],[2,"padding","0.2rem","text-align","center"],["class","lg mdi mdi-thumb-up-outline text-warning",4,"ngIf"],["class","lg mdi mdi-book-open-variant text-warning",4,"ngIf"],["class","lg mdi mdi-silverware-fork-knife text-warning",4,"ngIf"],["class","lg mdi mdi-file-document-edit-outline text-warning",4,"ngIf"],[1,"mdi","mdi-minus-circle-outline"],[1,"mdi","mdi-pause-circle-outline"],[1,"mdi","mdi-check-circle-outline"],[1,"mdi","mdi-stop-circle-outline"],[1,"lg","mdi","mdi-thumb-up-outline","text-warning"],[1,"lg","mdi","mdi-book-open-variant","text-warning"],[1,"lg","mdi","mdi-silverware-fork-knife","text-warning"],[1,"lg","mdi","mdi-file-document-edit-outline","text-warning"],[1,"container","row","px-0","mb-4"],["class","col-4 px-0 p-1",4,"ngFor","ngForOf"],[1,"col-4","px-0","p-1"],[1,"btn","btn-block","p-0",3,"ngClass","click"],["width","100%"],[1,"rounded-left",2,"background-color","rgba(50, 50, 50, 0.3)"],[1,"xl"],["class","xl mdi mdi-book-open-variant text-warning",4,"ngIf"],["class","xl mdi mdi-silverware-fork-knife text-warning",4,"ngIf"],["class","xl mdi mdi-file-document-edit-outline text-warning",4,"ngIf"],[1,"xl","mdi","mdi-book-open-variant","text-warning"],[1,"xl","mdi","mdi-file-document-edit-outline","text-warning"],["class","xl mdi mdi-minus-circle-outline text-white","style","opacity: 0.8",4,"ngIf"],[1,"xl","mdi","mdi-minus-circle-outline","text-white",2,"opacity","0.8"],["class","xl mdi mdi-pause-circle-outline text-white","style","opacity: 0.8",4,"ngIf"],["class","xl mdi mdi-check-circle-outline text-white","style","opacity: 0.8",4,"ngIf"],["class","xl mdi mdi-stop-circle-outline text-white","style","opacity: 0.8",4,"ngIf"],[1,"xl","mdi","mdi-pause-circle-outline","text-white",2,"opacity","0.8"],[1,"xl","mdi","mdi-check-circle-outline","text-white",2,"opacity","0.8"],[1,"xl","mdi","mdi-stop-circle-outline","text-white",2,"opacity","0.8"],[1,"card","bg-light"],[1,"text-white","card-header",3,"ngClass"],[1,"card-body"],[1,"container","row","px-0"],[1,"col-6","col-sm-6","col-md-4","p-1"],[1,"btn","btn-block","p-0",3,"ngClass","disabled"],[1,"rounded-left","px-1",2,"background-color","rgba(50, 50, 50, 0.3)"],[1,"mdi","mdi-power","xl"],[2,"color","tomato",3,"checked","disabled","click"],[1,"mdi","mdi-priority-high","xl"],[3,"ngModel","disabled","ngModelChange"],[1,"btn","btn-primary","btn-block","p-0",3,"disabled","ngClass","click"],[1,"mdi","mdi-arrow-right-bold-circle-outline","xl"],[1,"mdi","mdi-bell","xl"],[1,"mdi","mdi-replay","xl"],[1,"btn","btn-danger","btn-block","p-0",3,"disabled","ngClass","click"],[1,"mdi","mdi-close","xl"],[1,"table","table-sm","text-center"],[2,"text-align","right","border","none"]],template:function(e,t){1&e&&(o.Tb(0,"mat-expansion-panel"),o.Tb(1,"mat-expansion-panel-header"),o.Tb(2,"mat-panel-title"),o.Ob(3,"span",0),o.Tb(4,"span",1),o.Cc(5),o.Sb(),o.Sb(),o.Sb(),o.Tb(6,"mat-checkbox",2),o.ac("ngModelChange",function(e){return t.listmode=e})("click",function(){return t.setListMode()}),o.Cc(7,"Modo Lista"),o.Sb(),o.Bc(8,U,18,3,"div",3),o.Bc(9,Y,2,1,"div",4),o.Bc(10,be,60,42,"div",5),o.Sb()),2&e&&(o.Bb(5),o.Ec("Mesas (",t.tables.length,")"),o.Bb(1),o.kc("ngModel",t.listmode),o.Bb(2),o.kc("ngIf",t.listmode),o.Bb(1),o.kc("ngIf",!t.listmode),o.Bb(1),o.kc("ngIf",t.table))},directives:[T.c,T.d,T.e,w.a,n.p,n.s,s.j,v.a,s.i,s.h,y.a],styles:[""]}),e})();function re(e,t){1&e&&(o.Tb(0,"div"),o.Cc(1," No hay requerimientos de mesas especiales "),o.Sb())}function oe(e,t){1&e&&(o.Tb(0,"div"),o.Ob(1,"span",20),o.Sb())}function de(e,t){1&e&&(o.Tb(0,"div"),o.Ob(1,"span",21),o.Sb())}function ue(e,t){1&e&&o.Ob(0,"span",28)}function me(e,t){if(1&e&&(o.Tb(0,"span",29),o.Cc(1),o.Sb()),2&e){const e=o.ec().$implicit;o.Bb(1),o.Dc(e.nm_persons)}}const ge=function(e,t){return{"btn-success":e,"btn-secondary":t}};function Se(e,t){if(1&e){const e=o.Ub();o.Tb(0,"div",22),o.Tb(1,"div",23),o.ac("click",function(){o.tc(e);const i=t.$implicit,s=o.ec().$implicit;return o.ec(2).setReserve(i,s)}),o.Tb(2,"table",14),o.Tb(3,"tr"),o.Tb(4,"td",24),o.Tb(5,"span",25),o.Cc(6),o.Sb(),o.Sb(),o.Tb(7,"td"),o.Bc(8,ue,1,0,"span",26),o.Bc(9,me,2,1,"span",27),o.Sb(),o.Sb(),o.Sb(),o.Sb(),o.Sb()}if(2&e){const e=t.$implicit,i=o.ec().$implicit;o.Bb(1),o.kc("ngClass",o.oc(4,ge,i.cd_tables.includes(e.nm_table),!i.cd_tables.includes(e.nm_table))),o.Bb(5),o.Dc(e.nm_table),o.Bb(2),o.kc("ngIf",i.cd_tables.includes(e.nm_table)),o.Bb(1),o.kc("ngIf",!i.cd_tables.includes(e.nm_table))}}function pe(e,t){if(1&e){const e=o.Ub();o.Tb(0,"mat-expansion-panel",6),o.Tb(1,"mat-expansion-panel-header"),o.Tb(2,"mat-panel-title"),o.Bc(3,oe,2,0,"div",2),o.Bc(4,de,2,0,"div",2),o.Cc(5),o.Sb(),o.Sb(),o.Tb(6,"div",7),o.Tb(7,"div",8),o.Tb(8,"div",9),o.Cc(9),o.Sb(),o.Sb(),o.Bc(10,Se,10,7,"div",10),o.Sb(),o.Tb(11,"div",11),o.Tb(12,"div",12),o.Tb(13,"button",13),o.ac("click",function(){o.tc(e);const i=t.$implicit,s=o.ec(2);return s.assignTables(i,s.assignWithPriority)}),o.Tb(14,"table",14),o.Tb(15,"tr"),o.Tb(16,"td",15),o.Ob(17,"span",16),o.Sb(),o.Tb(18,"td",14),o.Cc(19," Asignar "),o.Sb(),o.Sb(),o.Sb(),o.Sb(),o.Sb(),o.Tb(20,"div",12),o.Tb(21,"button",17),o.Tb(22,"table",14),o.Tb(23,"tr"),o.Tb(24,"td",15),o.Ob(25,"span",18),o.Sb(),o.Tb(26,"td",14),o.Tb(27,"mat-slide-toggle",19),o.ac("ngModelChange",function(t){return o.tc(e),o.ec(2).assignWithPriority=t}),o.Sb(),o.Sb(),o.Sb(),o.Sb(),o.Sb(),o.Sb(),o.Sb(),o.Sb()}if(2&e){const e=t.$implicit,i=o.ec(2);o.Bb(3),o.kc("ngIf",e.cd_tables.length>0),o.Bb(1),o.kc("ngIf",0==e.cd_tables.length),o.Bb(1),o.Fc(" Turno ",e.id_position,": mesa para ",e.nm_persons," "),o.Bb(4),o.Ec(" Por favor seleccion\xe1 las mesas necesarias para aprovisionar este pedido para ",e.nm_persons," personas. "),o.Bb(1),o.kc("ngForOf",i.tables),o.Bb(17),o.kc("ngModel",i.assignWithPriority)}}function fe(e,t){if(1&e&&(o.Tb(0,"mat-accordion",4),o.Bc(1,pe,28,7,"mat-expansion-panel",5),o.Sb()),2&e){const e=o.ec();o.Bb(1),o.kc("ngForOf",e.requested)}}let he=(()=>{class e{constructor(e,t){this.sharedService=e,this.waiterService=t,this.assignWithPriority=!1,this.setReserve=(e,t)=>{t.cd_tables=t.cd_tables.includes(e.nm_table)?t.cd_tables.filter(t=>t!==e.nm_table):[...t.cd_tables,e.nm_table]},this.assignTables=(e,t)=>{this.waiterService.assignTables(e._id,e.cd_tables,t).subscribe(e=>{this.sharedService.snack(e.ok?"Las mesas fueron reservadas con exito!":"Error al reservar las mesas!",2e3)},()=>{this.sharedService.snack("Error al reservar las mesas!",2e3)})}}ngOnInit(){}}return e.\u0275fac=function(t){return new(t||e)(o.Nb(m.a),o.Nb(u.a))},e.\u0275cmp=o.Hb({type:e,selectors:[["app-requested"]],inputs:{requested:"requested",tables:"tables"},decls:8,vars:3,consts:[[1,"xl","mdi","mdi-alert-box","text-danger"],[1,"sidenav-title-text","mx-2"],[4,"ngIf"],["multi","false",4,"ngIf"],["multi","false"],["class","noshadow",4,"ngFor","ngForOf"],[1,"noshadow"],[1,"container","row","px-0","mb-4"],[1,"card","bg-danger","text-white","mb-3"],[1,"card-body","p-1"],["class","col-4 px-0 p-1",4,"ngFor","ngForOf"],[1,"container","row"],[1,"col"],[1,"btn","btn-primary","btn-block","p-0",3,"click"],["width","100%"],[1,"rounded-left","px-1",2,"background-color","rgba(50, 50, 50, 0.3)"],[1,"mdi","mdi-hand-pointing-right","xl"],[1,"btn","btn-info","btn-block","p-0"],[1,"mdi","mdi-priority-high","xl"],[3,"ngModel","ngModelChange"],[1,"text-success","xl","mr-2","mdi","mdi-checkbox-marked"],[1,"text-danger","xl","mr-2","mdi","mdi-help-box"],[1,"col-4","px-0","p-1"],[1,"btn","btn-block","p-0",3,"ngClass","click"],[1,"rounded-left",2,"background-color","rgba(50, 50, 50, 0.3)"],[1,"xl"],["class","xl mdi mdi-check-circle text-white",4,"ngIf"],["class","lg mdi mdi-human-male text-warning",4,"ngIf"],[1,"xl","mdi","mdi-check-circle","text-white"],[1,"lg","mdi","mdi-human-male","text-warning"]],template:function(e,t){1&e&&(o.Tb(0,"mat-expansion-panel"),o.Tb(1,"mat-expansion-panel-header"),o.Tb(2,"mat-panel-title"),o.Ob(3,"span",0),o.Tb(4,"span",1),o.Cc(5),o.Sb(),o.Sb(),o.Sb(),o.Bc(6,re,2,0,"div",2),o.Bc(7,fe,2,1,"mat-accordion",3),o.Sb()),2&e&&(o.Bb(5),o.Ec("Requeridos (",t.requested.length,") "),o.Bb(1),o.kc("ngIf",0==t.requested.length),o.Bb(1),o.kc("ngIf",t.requested.length>0))},directives:[T.c,T.d,T.e,s.j,T.a,s.i,y.a,n.p,n.s,s.h],styles:[""]}),e})();function Te(e,t){1&e&&(o.Tb(0,"div"),o.Cc(1," No hay clientes esperando mesa "),o.Sb())}function ve(e,t){1&e&&(o.Tb(0,"div"),o.Ob(1,"span",18),o.Sb())}function _e(e,t){1&e&&(o.Tb(0,"div"),o.Ob(1,"span",19),o.Sb())}function ke(e,t){1&e&&o.Ob(0,"span",26)}function xe(e,t){if(1&e&&(o.Tb(0,"span",27),o.Cc(1),o.Sb()),2&e){const e=o.ec().$implicit;o.Bb(1),o.Dc(e.nm_persons)}}const Be=function(e,t){return{"btn-success":e,"btn-secondary":t}};function we(e,t){if(1&e){const e=o.Ub();o.Tb(0,"div",20),o.Tb(1,"div",21),o.ac("click",function(){o.tc(e);const i=t.$implicit,s=o.ec().$implicit;return o.ec(2).setReserve(i,s)}),o.Tb(2,"table",12),o.Tb(3,"tr"),o.Tb(4,"td",22),o.Tb(5,"span",23),o.Cc(6),o.Sb(),o.Sb(),o.Tb(7,"td"),o.Bc(8,ke,1,0,"span",24),o.Bc(9,xe,2,1,"span",25),o.Sb(),o.Sb(),o.Sb(),o.Sb(),o.Sb()}if(2&e){const e=t.$implicit,i=o.ec().$implicit;o.Bb(1),o.kc("ngClass",o.oc(4,Be,i.cd_tables.includes(e.nm_table),!i.cd_tables.includes(e.nm_table))),o.Bb(5),o.Dc(e.nm_table),o.Bb(2),o.kc("ngIf",i.cd_tables.includes(e.nm_table)),o.Bb(1),o.kc("ngIf",!i.cd_tables.includes(e.nm_table))}}function ye(e,t){if(1&e){const e=o.Ub();o.Tb(0,"mat-expansion-panel",6),o.Tb(1,"mat-expansion-panel-header"),o.Tb(2,"mat-panel-title"),o.Bc(3,ve,2,0,"div",2),o.Bc(4,_e,2,0,"div",2),o.Cc(5),o.Sb(),o.Sb(),o.Tb(6,"div",7),o.Bc(7,we,10,7,"div",8),o.Sb(),o.Tb(8,"div",9),o.Tb(9,"div",10),o.Tb(10,"button",11),o.ac("click",function(){o.tc(e);const i=t.$implicit,s=o.ec(2);return s.assignTables(i,s.assignWithPriority)}),o.Tb(11,"table",12),o.Tb(12,"tr"),o.Tb(13,"td",13),o.Ob(14,"span",14),o.Sb(),o.Tb(15,"td",12),o.Cc(16," Asignar "),o.Sb(),o.Sb(),o.Sb(),o.Sb(),o.Sb(),o.Tb(17,"div",10),o.Tb(18,"button",15),o.Tb(19,"table",12),o.Tb(20,"tr"),o.Tb(21,"td",13),o.Ob(22,"span",16),o.Sb(),o.Tb(23,"td",12),o.Tb(24,"mat-slide-toggle",17),o.ac("ngModelChange",function(t){return o.tc(e),o.ec(2).assignWithPriority=t}),o.Sb(),o.Sb(),o.Sb(),o.Sb(),o.Sb(),o.Sb(),o.Sb(),o.Sb()}if(2&e){const e=t.$implicit,i=o.ec(2);o.Bb(3),o.kc("ngIf",e.cd_tables.length>0),o.Bb(1),o.kc("ngIf",0==e.cd_tables.length),o.Bb(1),o.Fc(" Turno ",e.id_position,": mesa para ",e.nm_persons," "),o.Bb(2),o.kc("ngForOf",i.tables),o.Bb(17),o.kc("ngModel",i.assignWithPriority)}}function Ce(e,t){if(1&e&&(o.Tb(0,"mat-accordion",4),o.Bc(1,ye,25,6,"mat-expansion-panel",5),o.Sb()),2&e){const e=o.ec();o.Bb(1),o.kc("ngForOf",e.queued)}}let Ie=(()=>{class e{constructor(e,t){this.sharedService=e,this.waiterService=t,this.setReserve=(e,t)=>{t.cd_tables=t.cd_tables.includes(e.nm_table)?t.cd_tables.filter(t=>t!==e.nm_table):[...t.cd_tables,e.nm_table]},this.assignTables=(e,t)=>{this.waiterService.assignTables(e._id,e.cd_tables,t).subscribe(e=>{this.sharedService.snack(e.ok?"Las mesas fueron reservadas con exito!":"Error al reservar las mesas!",2e3)},()=>{this.sharedService.snack("Error al reservar las mesas!",2e3)})}}ngOnInit(){}}return e.\u0275fac=function(t){return new(t||e)(o.Nb(m.a),o.Nb(u.a))},e.\u0275cmp=o.Hb({type:e,selectors:[["app-queued"]],inputs:{queued:"queued",tables:"tables"},decls:8,vars:3,consts:[[1,"xl","mdi","mdi-format-list-numbered","text-primary"],[1,"sidenav-title-text","mx-2"],[4,"ngIf"],["multi","false",4,"ngIf"],["multi","false"],["class","noshadow",4,"ngFor","ngForOf"],[1,"noshadow"],[1,"container","row","px-0","mb-4"],["class","col-4 px-0 p-1",4,"ngFor","ngForOf"],[1,"container","row"],[1,"col"],[1,"btn","btn-primary","btn-block","p-0",3,"click"],["width","100%"],[1,"rounded-left","px-1",2,"background-color","rgba(50, 50, 50, 0.3)"],[1,"mdi","mdi-hand-pointing-right","xl"],[1,"btn","btn-info","btn-block","p-0"],[1,"mdi","mdi-priority-high","xl"],[3,"ngModel","ngModelChange"],[1,"text-success","xl","mr-2","mdi","mdi-checkbox-marked"],[1,"text-danger","xl","mr-2","mdi","mdi-alert-box"],[1,"col-4","px-0","p-1"],[1,"btn","btn-block","p-0",3,"ngClass","click"],[1,"rounded-left",2,"background-color","rgba(50, 50, 50, 0.3)"],[1,"xl"],["class","xl mdi mdi-check-circle text-white",4,"ngIf"],["class","lg mdi mdi-human-male text-warning",4,"ngIf"],[1,"xl","mdi","mdi-check-circle","text-white"],[1,"lg","mdi","mdi-human-male","text-warning"]],template:function(e,t){1&e&&(o.Tb(0,"mat-expansion-panel"),o.Tb(1,"mat-expansion-panel-header"),o.Tb(2,"mat-panel-title"),o.Ob(3,"span",0),o.Tb(4,"span",1),o.Cc(5),o.Sb(),o.Sb(),o.Sb(),o.Bc(6,Te,2,0,"div",2),o.Bc(7,Ce,2,1,"mat-accordion",3),o.Sb()),2&e&&(o.Bb(5),o.Ec("Cola (",t.queued.length,")"),o.Bb(1),o.kc("ngIf",0==t.queued.length),o.Bb(1),o.kc("ngIf",t.queued.length>0))},directives:[T.c,T.d,T.e,s.j,T.a,s.i,y.a,n.p,n.s,s.h],styles:[""]}),e})();function Oe(e,t){1&e&&(o.Tb(0,"div",4),o.Ob(1,"mat-spinner"),o.Sb())}function Me(e,t){if(1&e){const e=o.Ub();o.Tb(0,"div",5),o.Tb(1,"div",6),o.Cc(2),o.Sb(),o.Tb(3,"div",7),o.Tb(4,"button",8),o.ac("click",function(){return o.tc(e),o.ec(2).releaseSection()}),o.Tb(5,"table",9),o.Tb(6,"tr"),o.Tb(7,"td",10),o.Ob(8,"div",11),o.Sb(),o.Tb(9,"td"),o.Cc(10,"Salir"),o.Sb(),o.Sb(),o.Sb(),o.Sb(),o.Sb(),o.Tb(11,"div"),o.Tb(12,"mat-accordion",12),o.Ob(13,"app-sections",13),o.Ob(14,"app-tables",14),o.Ob(15,"app-requested",15),o.Ob(16,"app-queued",16),o.Sb(),o.Sb(),o.Sb()}if(2&e){const e=o.ec(2);o.Bb(2),o.Ec(" - SECTOR ",e.waiterService.session.id_section.tx_section," - "),o.Bb(11),o.kc("ticketsDataBySection",e.ticketsDataBySection)("tablesDataBySection",e.tablesDataBySection),o.Bb(1),o.kc("tables",e.tables)("busyTablesTimes",e.busyTablesTimes),o.Bb(1),o.kc("tables",e.tables)("requested",e.requested),o.Bb(1),o.kc("tables",e.tables)("queued",e.queued)}}function Ee(e,t){if(1&e&&(o.Tb(0,"div",1),o.Bc(1,Oe,2,0,"div",2),o.Bc(2,Me,17,9,"div",3),o.Sb()),2&e){const e=o.ec();o.Bb(1),o.kc("ngIf",e.loading),o.Bb(1),o.kc("ngIf",!e.loading)}}let De=(()=>{class e{constructor(e,t,i,s,n,c){this.loginService=e,this.waiterService=t,this.sharedService=i,this.wsService=s,this.router=n,this.intervalToHmsPipe=c,this.loading=!1,this.ticketsDataBySection=new Map,this.tablesDataBySection=new Map,this.busyTablesTimes=new Map,this.tickets=[],this.tables=[],this.requested=[],this.queued=[],this.subjectUpdateWaiters$=new l.a,this.readTables=()=>new Promise((e,t)=>{this.waiterService.readTables(this.loginService.user.id_company._id).subscribe(i=>{if(i.ok){this.tables=i.tables.filter(e=>e.id_section===this.waiterService.session.id_section._id);for(let e of this.waiterService.sections)this.tablesDataBySection.set(e.tx_section,{id:e._id,sectionselected:this.waiterService.session.id_section._id===e._id,busy:i.tables.filter(t=>t.id_section===e._id&&"busy"===t.tx_status).length,idle:i.tables.filter(t=>t.id_section===e._id&&"idle"===t.tx_status).length,paused:i.tables.filter(t=>t.id_section===e._id&&"paused"===t.tx_status).length});Object(r.a)(1e3).subscribe(()=>{for(let e of this.tables.filter(e=>{var t;return e.id_section===(null===(t=this.waiterService.session)||void 0===t?void 0:t.id_section._id)&&"busy"===e.tx_status}))e.id_session&&this.busyTablesTimes.set(e.nm_table,{tm_provided:this.intervalToHmsPipe.transform(e.id_session.id_ticket.tm_provided),tm_call:this.intervalToHmsPipe.transform(e.id_session.id_ticket.tm_call)})}),localStorage.setItem("tables",JSON.stringify(i.tables)),e()}else t([])},()=>{localStorage.getItem("tables")&&localStorage.removeItem("tables"),t([])})}),this.readTickets=()=>new Promise(e=>{var t;let i=null===(t=this.loginService.user.id_company)||void 0===t?void 0:t._id;return this.waiterService.readTickets(i).subscribe(t=>{this.tickets=t.tickets,this.requested=this.tickets.filter(e=>{var t;return(null===(t=e.id_section)||void 0===t?void 0:t._id)===this.waiterService.session.id_section._id&&null===e.tm_end&&"requested"===e.tx_status}),this.queued=this.tickets.filter(e=>{var t;return(null===(t=e.id_section)||void 0===t?void 0:t._id)===this.waiterService.session.id_section._id&&null===e.tm_end&&"queued"===e.tx_status});for(let e of this.waiterService.sections)this.ticketsDataBySection.set(e.tx_section,{id:e._id,sectionselected:this.waiterService.session.id_section._id===e._id,queued:t.tickets.filter(t=>{var i;return(null===(i=t.id_section)||void 0===i?void 0:i._id)===e._id&&null===t.tm_end&&("queued"===t.tx_status||"assigned"===t.tx_status)}).length,requested:t.tickets.filter(t=>{var i;return(null===(i=t.id_section)||void 0===i?void 0:i._id)===e._id&&null===t.tm_end&&"requested"===t.tx_status}).length});e(t.tickets),this.loading=!1})}),this.releaseSection=()=>{this.waiterService.releaseSection(this.waiterService.session.id_section._id,this.loginService.user._id).subscribe(e=>{e.ok&&(this.waiterService.clearSectionSession(),this.router.navigate(["waiter/home"]))})},this.ngOnDestroy=()=>{this.subjectUpdateWaiters$.complete()}}onClick(e){}ngOnInit(){return Object(b.a)(this,void 0,void 0,function*(){this.waiterService.session?(this.loading=!0,yield this.readTables(),yield this.readTickets(),this.wsService.updateWaiters().subscribe(this.subjectUpdateWaiters$),this.subjectUpdateWaiters$.subscribe(()=>Object(b.a)(this,void 0,void 0,function*(){yield this.readTables(),yield this.readTickets()})),this.loading=!1):this.router.navigate(["/waiter/home"])})}}return e.\u0275fac=function(t){return new(t||e)(o.Nb(d.a),o.Nb(u.a),o.Nb(m.a),o.Nb(g.a),o.Nb(c.b),o.Nb(f))},e.\u0275cmp=o.Hb({type:e,selectors:[["app-section"]],hostBindings:function(e,t){1&e&&o.ac("click",function(e){return t.onClick(e)})},decls:1,vars:1,consts:[["class","saturno-card animated fadeIn",4,"ngIf"],[1,"saturno-card","animated","fadeIn"],["class","mt-5 animated fadeIn",4,"ngIf"],["class","animated fadeIn",4,"ngIf"],[1,"mt-5","animated","fadeIn"],[1,"animated","fadeIn"],[1,"text-uppercase","xxl","my-2","p-2"],[1,"my-4"],[1,"btn","btn-danger","p-0","col-4",3,"click"],["width","100%"],[1,"rounded-left",2,"background-color","rgba(50, 50, 50, 0.3)"],[1,"mdi","mdi-power","xl"],["multi","true"],[3,"ticketsDataBySection","tablesDataBySection"],[3,"tables","busyTablesTimes"],[3,"tables","requested"],[3,"tables","queued"]],template:function(e,t){1&e&&o.Bc(0,Ee,3,2,"div",0),2&e&&o.kc("ngIf",t.waiterService.session)},directives:[s.j,h.b,T.a,B,le,he,Ie],styles:[".company-title[_ngcontent-%COMP%]{font-weight:300;letter-spacing:.2em;text-transform:uppercase;color:#f5f5f5}"]}),e})();var qe=i("zHaW"),Ne=i("Q2Ze"),$e=i("ZTz/"),Fe=i("UhP/");function Pe(e,t){1&e&&(o.Tb(0,"div",4),o.Ob(1,"mat-spinner"),o.Sb())}function He(e,t){1&e&&(o.Tb(0,"div",17),o.Cc(1," No ten\xe9s asignada ning\xfana empresa. Ten\xe9s seleccionarla desde el men\xfa prinicipal. "),o.Sb())}function Ue(e,t){1&e&&(o.Tb(0,"div",17),o.Cc(1," No hay mesas creadas. Ten\xe9s que crearlas desde el Men\xfa de Administrador. "),o.Sb())}function je(e,t){if(1&e){const e=o.Ub();o.Tb(0,"div"),o.Tb(1,"div",20),o.Tb(2,"div",21),o.Cc(3),o.Sb(),o.Sb(),o.Tb(4,"div",20),o.Tb(5,"div",21),o.Tb(6,"button",22),o.ac("click",function(){o.tc(e);const t=o.ec(3);return t.takeSection(t.waiterService.session.id_section)}),o.Cc(7," Ingresar "),o.Sb(),o.Sb(),o.Tb(8,"div",21),o.Tb(9,"button",23),o.ac("click",function(){o.tc(e);const t=o.ec(3);return t.releaseSection(t.waiterService.session.id_section)}),o.Cc(10," Cerrar "),o.Sb(),o.Sb(),o.Sb(),o.Sb()}if(2&e){const e=o.ec(3);o.Bb(3),o.Ec(" Ten\xe9s tomado el sector ",e.waiterService.session.id_section.tx_section," ")}}function We(e,t){if(1&e&&(o.Tb(0,"mat-option",30),o.Cc(1),o.Sb()),2&e){const e=t.$implicit;o.kc("value",e),o.Bb(1),o.Ec(" ",e.tx_section," ")}}function Ae(e,t){if(1&e){const e=o.Ub();o.Tb(0,"div"),o.Tb(1,"div",24),o.Tb(2,"mat-form-field",25),o.Tb(3,"mat-label"),o.Cc(4,"Seleccione un sector"),o.Sb(),o.Tb(5,"mat-select",26,27),o.Bc(7,We,2,2,"mat-option",28),o.Sb(),o.Sb(),o.Tb(8,"button",29),o.ac("click",function(){o.tc(e);const t=o.sc(6);return o.ec(3).takeSection(null==t?null:t.value)}),o.Cc(9," Ingresar "),o.Sb(),o.Sb(),o.Sb()}if(2&e){const e=o.ec(3);o.Bb(7),o.kc("ngForOf",e.sections)}}function Je(e,t){if(1&e&&(o.Tb(0,"div",18),o.Bc(1,je,11,1,"div",19),o.Bc(2,Ae,10,1,"div",19),o.Sb()),2&e){const e=o.ec(2);o.Bb(1),o.kc("ngIf",e.waiterService.session),o.Bb(1),o.kc("ngIf",!e.waiterService.session)}}function Re(e,t){if(1&e&&(o.Tb(0,"tr"),o.Tb(1,"td",31),o.Cc(2),o.Sb(),o.Tb(3,"td",32),o.Cc(4),o.Sb(),o.Sb()),2&e){const e=t.$implicit,i=o.ec(2);o.Bb(2),o.Ec(" ",e.tx_section," "),o.Bb(2),o.Ec(" ",i.sessions.get(e.tx_section)," ")}}function ze(e,t){if(1&e&&(o.Tb(0,"div",4),o.Tb(1,"div",5),o.Cc(2,"Bienvenido, desde ac\xe1 pod\xe9s entrar a un sector y comenzar a atender mesas."),o.Sb(),o.Bc(3,He,2,0,"div",6),o.Bc(4,Ue,2,0,"div",6),o.Bc(5,Je,3,2,"div",7),o.Tb(6,"div",8),o.Tb(7,"div",9),o.Tb(8,"table",10),o.Tb(9,"tr",11),o.Tb(10,"td",12),o.Ob(11,"span",13),o.Cc(12," Sector "),o.Sb(),o.Tb(13,"td",14),o.Ob(14,"span",15),o.Cc(15," Camareros "),o.Sb(),o.Sb(),o.Bc(16,Re,5,2,"tr",16),o.Sb(),o.Sb(),o.Sb(),o.Sb()),2&e){const e=o.ec();o.Bb(3),o.kc("ngIf",!e.loginService.user.id_company),o.Bb(1),o.kc("ngIf",0===(null==e.tables?null:e.tables.length)),o.Bb(1),o.kc("ngIf",e.sections&&(null==e.loginService.user.id_company?null:e.loginService.user.id_company._id)),o.Bb(11),o.kc("ngForOf",e.sections)}}let Le=(()=>{class e{constructor(e,t,i,s,n){this.router=e,this.loginService=t,this.waiterService=i,this.sharedService=s,this.snack=n,this.loading=!1,this.sections=[],this.sessions=new Map}ngOnInit(){var e;if(this.loading=!0,!(null===(e=this.loginService.user.id_company)||void 0===e?void 0:e._id))return this.sharedService.snack("No tiene una empresa seleccionada",5e3),void(this.loading=!1);{let e=this.loginService.user.id_company._id;this.readSections(e),this.readSessions(e)}this.userSuscription=this.loginService.user$.subscribe(e=>{e&&this.readSections(e.id_company._id)})}takeSection(e){e&&(this.waiterService.session?this.router.navigate(["/waiter/section"]):this.waiterService.takeSection(e._id,this.loginService.user._id).subscribe(e=>{this.snack.open(e.msg,null,{duration:2e3}),e.ok?(this.waiterService.session=e.session,localStorage.setItem("session",JSON.stringify(e.session)),this.router.navigate(["/waiter/section"])):this.snack.open("No se pudo tomar un escritorio",null,{duration:2e3})},()=>{}))}readSections(e){this.waiterService.readSections(e).subscribe(e=>{e.ok?(this.sections=e.sections,this.waiterService.sections=this.sections):(delete this.sections,delete this.waiterService.sections)},()=>{this.loading=!1},()=>{this.loading=!1})}readSessions(e){this.waiterService.readSessions(e).subscribe(e=>{if(e.ok){let t=e.sessions.filter(e=>e.id_waiter===this.loginService.user._id);this.waiterService.session=t[0],localStorage.setItem("session",JSON.stringify(this.waiterService.session));for(let i of this.sections)this.sessions.set(i.tx_section,e.sessions.filter(e=>e.id_section.tx_section===i.tx_section).length)}else delete this.sessions},()=>{this.loading=!1},()=>{this.loading=!1})}releaseSection(e){this.loading=!0,this.waiterService.releaseSection(e._id,this.loginService.user._id).subscribe(e=>{e.ok&&(this.readSessions(this.loginService.user.id_company._id),this.waiterService.clearSectionSession())})}ngOnDestroy(){this.userSuscription&&this.userSuscription.unsubscribe()}}return e.\u0275fac=function(t){return new(t||e)(o.Nb(c.b),o.Nb(d.a),o.Nb(u.a),o.Nb(m.a),o.Nb(qe.a))},e.\u0275cmp=o.Hb({type:e,selectors:[["app-home"]],decls:6,vars:2,consts:[[1,"saturno-card","mt-sm-4","animated","fadeIn"],["class","animated fadeIn",4,"ngIf"],["routerLink","/waiter/dashboard","role","button",1,"btn","btn-primary","btn-block"],[1,"mdi","mdi-finance","mx-1"],[1,"animated","fadeIn"],[1,"md"],["class","card lead bg-danger text-white p-3 my-4","style","line-height: initial;",4,"ngIf"],["class","mb-4",4,"ngIf"],[1,"card","bg-secondary","mb-4"],[1,"card-content","table-responsive-sm","p-2"],[1,"table","table-sm","text-white","text-center"],[2,"border-top","0px","color","yellow"],[2,"text-align","left","border","none"],[1,"mdi","mdi-select-group","mx-1"],[2,"text-align","right","border","none"],[1,"mdi","mdi-face","mx-1"],[4,"ngFor","ngForOf"],[1,"card","lead","bg-danger","text-white","p-3","my-4",2,"line-height","initial"],[1,"mb-4"],[4,"ngIf"],[1,"row","my-4"],[1,"col"],["role","button",1,"btn","btn-success","btn-block","text-uppercase",3,"click"],["role","button",1,"btn","btn-danger","btn-block","text-uppercase",3,"click"],[1,"my-4"],[1,"w-100"],["matNativeControl","","required",""],["selectSection",""],[3,"value",4,"ngFor","ngForOf"],["role","button",1,"btn","btn-success","btn-block",3,"click"],[3,"value"],[2,"text-align","left"],[2,"text-align","right"]],template:function(e,t){1&e&&(o.Tb(0,"div",0),o.Bc(1,Pe,2,0,"div",1),o.Bc(2,ze,17,4,"div",1),o.Tb(3,"button",2),o.Ob(4,"span",3),o.Cc(5," Dashboard "),o.Sb(),o.Sb()),2&e&&(o.Bb(1),o.kc("ngIf",t.loading),o.Bb(1),o.kc("ngIf",!t.loading))},directives:[s.j,c.c,h.b,s.i,Ne.c,Ne.f,$e.a,Fe.l],styles:[""]}),e})();var Ge=i("cxbk"),Qe=i("IheW");let Ve=(()=>{class e{constructor(e){this.http=e}getUserMetrics(e,t){return this.http.post(Ge.a.url+"/metrics/getusermetrics",{fcSel:e,idUser:t})}}return e.\u0275fac=function(t){return new(t||e)(o.Xb(Qe.b))},e.\u0275prov=o.Jb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var Ke=i("e6WT"),Xe=i("TN/R");let Ye=(()=>{class e{transform(e){return p()(e).format("H:mm:ss")}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275pipe=o.Mb({name:"timeToHms",type:e,pure:!0}),e})();function Ze(e,t){1&e&&(o.Tb(0,"div",2),o.Ob(1,"mat-spinner"),o.Sb())}function et(e,t){if(1&e&&(o.Tb(0,"tr"),o.Tb(1,"td",25),o.Cc(2),o.Sb(),o.Tb(3,"td",26),o.Cc(4),o.fc(5,"timeToHms"),o.Sb(),o.Tb(6,"td",26),o.Cc(7),o.fc(8,"intervalToHms"),o.Sb(),o.Tb(9,"td",26),o.Cc(10),o.fc(11,"timeToHms"),o.Sb(),o.Tb(12,"td",26),o.Cc(13),o.fc(14,"intervalToHms"),o.Sb(),o.Tb(15,"td",27),o.Cc(16),o.fc(17,"timeToHms"),o.Sb(),o.Sb()),2&e){const e=t.$implicit;o.Bb(2),o.Ec(" ",e.id_position," "),o.Bb(2),o.Ec(" ",o.gc(5,6,e.tm_start)," "),o.Bb(3),o.Ec(" ",o.hc(8,8,e.tm_start,e.tm_att)," "),o.Bb(3),o.Ec(" ",o.gc(11,11,e.tm_att)," "),o.Bb(3),o.Ec(" ",o.hc(14,13,e.tm_att,e.tm_end)," "),o.Bb(3),o.Ec(" ",o.gc(17,16,e.tm_end)," ")}}function tt(e,t){if(1&e){const e=o.Ub();o.Tb(0,"div"),o.Tb(1,"div",3),o.Tb(2,"div",4),o.Tb(3,"div",5),o.Tb(4,"mat-form-field",6),o.Tb(5,"mat-label"),o.Cc(6,"Angular forms"),o.Sb(),o.Tb(7,"input",7),o.ac("dateChange",function(t){return o.tc(e),o.ec().setDate(t)}),o.Sb(),o.Ob(8,"mat-datepicker-toggle",8),o.Ob(9,"mat-datepicker",null,9),o.Sb(),o.Sb(),o.Sb(),o.Tb(11,"div",10),o.Tb(12,"div",11),o.Tb(13,"div",12),o.Tb(14,"div",13),o.Cc(15,"Turnos"),o.Sb(),o.Tb(16,"div",14),o.Cc(17),o.Sb(),o.Sb(),o.Sb(),o.Tb(18,"div",11),o.Tb(19,"div",15),o.Tb(20,"div",13),o.Cc(21,"Evals"),o.Sb(),o.Tb(22,"div",14),o.Cc(23),o.Sb(),o.Sb(),o.Sb(),o.Tb(24,"div",11),o.Tb(25,"div",16),o.Tb(26,"div",13),o.Cc(27,"Score"),o.Sb(),o.Tb(28,"div",14),o.Cc(29),o.Sb(),o.Sb(),o.Sb(),o.Sb(),o.Tb(30,"div",4),o.Tb(31,"div",11),o.Tb(32,"div",17),o.Tb(33,"div",18),o.Tb(34,"table",19),o.Tb(35,"tr",20),o.Tb(36,"td",21),o.Cc(37,"Ticket"),o.Sb(),o.Tb(38,"td",22),o.Cc(39,"Start"),o.Sb(),o.Tb(40,"td",22),o.Cc(41," - "),o.Sb(),o.Tb(42,"td",22),o.Cc(43,"Atteneded"),o.Sb(),o.Tb(44,"td",22),o.Cc(45," - "),o.Sb(),o.Tb(46,"td",23),o.Cc(47,"End"),o.Sb(),o.Sb(),o.Bc(48,et,18,18,"tr",24),o.Sb(),o.Sb(),o.Sb(),o.Sb(),o.Sb(),o.Sb(),o.Sb()}if(2&e){const e=o.sc(10),t=o.ec();o.Bb(7),o.kc("matDatepicker",e)("value",t.date),o.Bb(1),o.kc("for",e),o.Bb(9),o.Ec(" ",t.metrics.tickets.length," "),o.Bb(6),o.Ec(" ",t.metrics.total," "),o.Bb(6),o.Ec(" ",t.metrics.avg," "),o.Bb(19),o.kc("ngForOf",t.metrics.tickets)}}const it=[{path:"home",component:Le},{path:"section",component:De},{path:"dashboard",component:(()=>{class e{constructor(e,t){this.MetricsService=e,this.loginService=t,this.loading=!1,this.metrics={total:0,avg:0,tickets:[]},this.date=new Date}ngOnInit(){let e=(new Date).setHours(0,0,0,0);this.getMetrics(e)}setDate(e){let t=+new Date(e.value);this.date=new Date(t),this.getMetrics(t)}getMetrics(e){this.loading=!0,this.MetricsService.getUserMetrics(e,this.loginService.user._id).subscribe(e=>{this.metrics=e.metric,this.loading=!1},()=>{this.loading=!1})}}return e.\u0275fac=function(t){return new(t||e)(o.Nb(Ve),o.Nb(d.a))},e.\u0275cmp=o.Hb({type:e,selectors:[["app-dashboard"]],decls:2,vars:2,consts:[["class","mt-5 animated fadeIn",4,"ngIf"],[4,"ngIf"],[1,"mt-5","animated","fadeIn"],[1,"saturno-card"],[1,"row"],[1,"col","w-100"],[1,"w-100"],["matInput","",3,"matDatepicker","value","dateChange"],["matSuffix","",3,"for"],["picker1",""],[1,"row","mb-4"],[1,"col"],[1,"card","text-white","bg-success"],[1,"card-header"],[1,"card-body","saturno-card-mini-body"],[1,"card","text-white","bg-danger"],[1,"card","text-white","bg-primary"],[1,"card","bg-secondary","mb-4"],[1,"card-content","table-responsive-sm","p-2"],[1,"table","table-sm","text-white","text-center",2,"font-size","x-small"],[2,"border-top","0px","color","yellow"],[2,"text-align","left","border","none"],[2,"text-align","center","border","none"],[2,"text-align","right","border","none"],[4,"ngFor","ngForOf"],[2,"text-align","left"],[2,"text-align","center"],[2,"text-align","right"]],template:function(e,t){1&e&&(o.Bc(0,Ze,2,0,"div",0),o.Bc(1,tt,49,7,"div",1)),2&e&&(o.kc("ngIf",t.loading),o.Bb(1),o.kc("ngIf",!t.loading&&t.metrics))},directives:[s.j,h.b,Ne.c,Ne.f,Ke.b,Xe.b,Xe.d,Ne.g,Xe.a,s.i],pipes:[Ye,f],styles:[""]}),e})()},{path:"",redirectTo:"/waiter/home",pathMatch:"full"},{path:"**",component:a.a}];let st=(()=>{class e{}return e.\u0275mod=o.Lb({type:e}),e.\u0275inj=o.Kb({factory:function(t){return new(t||e)},imports:[[c.e.forChild(it)],c.e]}),e})();var nt=i("1+r1"),ct=i("iTUp");let at=(()=>{class e{}return e.\u0275mod=o.Lb({type:e}),e.\u0275inj=o.Kb({factory:function(t){return new(t||e)},imports:[[n.k,s.b,nt.a,ct.a,st]]}),e})()}}]);